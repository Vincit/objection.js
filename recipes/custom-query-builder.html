<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Custom query builder (extending the query builder) | Objection.js</title>
    <meta name="description" content="An SQL friendly ORM for node.js">
    
    
    <link rel="preload" href="/objection.js/assets/css/0.styles.6be6f8e1.css" as="style"><link rel="preload" href="/objection.js/assets/js/app.50db977b.js" as="script"><link rel="preload" href="/objection.js/assets/js/6.4413d797.js" as="script"><link rel="preload" href="/objection.js/assets/js/7.e45d78f3.js" as="script"><link rel="preload" href="/objection.js/assets/js/38.ebdc7e7e.js" as="script"><link rel="prefetch" href="/objection.js/assets/js/1.8568135f.js"><link rel="prefetch" href="/objection.js/assets/js/10.a0acad2a.js"><link rel="prefetch" href="/objection.js/assets/js/11.48ede96a.js"><link rel="prefetch" href="/objection.js/assets/js/12.145e20d1.js"><link rel="prefetch" href="/objection.js/assets/js/13.7f59027c.js"><link rel="prefetch" href="/objection.js/assets/js/14.3093d3dc.js"><link rel="prefetch" href="/objection.js/assets/js/15.0e4a111e.js"><link rel="prefetch" href="/objection.js/assets/js/16.41397331.js"><link rel="prefetch" href="/objection.js/assets/js/17.18995f92.js"><link rel="prefetch" href="/objection.js/assets/js/18.e6bfa412.js"><link rel="prefetch" href="/objection.js/assets/js/19.0c5338f3.js"><link rel="prefetch" href="/objection.js/assets/js/2.7cb69d9f.js"><link rel="prefetch" href="/objection.js/assets/js/20.a35a8262.js"><link rel="prefetch" href="/objection.js/assets/js/21.0e13efe2.js"><link rel="prefetch" href="/objection.js/assets/js/22.cb91282c.js"><link rel="prefetch" href="/objection.js/assets/js/23.0a9e7541.js"><link rel="prefetch" href="/objection.js/assets/js/24.ecbd06e3.js"><link rel="prefetch" href="/objection.js/assets/js/25.62d08c0f.js"><link rel="prefetch" href="/objection.js/assets/js/26.2c0469e7.js"><link rel="prefetch" href="/objection.js/assets/js/27.29c4399d.js"><link rel="prefetch" href="/objection.js/assets/js/28.feba1975.js"><link rel="prefetch" href="/objection.js/assets/js/29.65f53557.js"><link rel="prefetch" href="/objection.js/assets/js/3.1a8b2396.js"><link rel="prefetch" href="/objection.js/assets/js/30.d14356a5.js"><link rel="prefetch" href="/objection.js/assets/js/31.c210fa2c.js"><link rel="prefetch" href="/objection.js/assets/js/32.85422331.js"><link rel="prefetch" href="/objection.js/assets/js/33.efb00802.js"><link rel="prefetch" href="/objection.js/assets/js/34.b2771a6e.js"><link rel="prefetch" href="/objection.js/assets/js/35.1d97b8c9.js"><link rel="prefetch" href="/objection.js/assets/js/36.3d918e2e.js"><link rel="prefetch" href="/objection.js/assets/js/37.871bef96.js"><link rel="prefetch" href="/objection.js/assets/js/39.9a1b9711.js"><link rel="prefetch" href="/objection.js/assets/js/40.b706144c.js"><link rel="prefetch" href="/objection.js/assets/js/41.f7fdfc67.js"><link rel="prefetch" href="/objection.js/assets/js/42.86215083.js"><link rel="prefetch" href="/objection.js/assets/js/43.7b945b54.js"><link rel="prefetch" href="/objection.js/assets/js/44.d27f835b.js"><link rel="prefetch" href="/objection.js/assets/js/45.8fcf27df.js"><link rel="prefetch" href="/objection.js/assets/js/46.e8f676bd.js"><link rel="prefetch" href="/objection.js/assets/js/47.17b9b5b9.js"><link rel="prefetch" href="/objection.js/assets/js/48.927fd4d9.js"><link rel="prefetch" href="/objection.js/assets/js/49.c1f21c04.js"><link rel="prefetch" href="/objection.js/assets/js/50.772c5c28.js"><link rel="prefetch" href="/objection.js/assets/js/51.bfdccf8f.js"><link rel="prefetch" href="/objection.js/assets/js/52.d5250c95.js"><link rel="prefetch" href="/objection.js/assets/js/53.be0523d7.js"><link rel="prefetch" href="/objection.js/assets/js/54.80911536.js"><link rel="prefetch" href="/objection.js/assets/js/55.29af441a.js"><link rel="prefetch" href="/objection.js/assets/js/56.d496cd5d.js"><link rel="prefetch" href="/objection.js/assets/js/57.00f15633.js"><link rel="prefetch" href="/objection.js/assets/js/58.c3d39377.js"><link rel="prefetch" href="/objection.js/assets/js/8.419012c7.js"><link rel="prefetch" href="/objection.js/assets/js/9.533e7631.js"><link rel="prefetch" href="/objection.js/assets/js/vendors~docsearch.6b70a5e2.js">
    <link rel="stylesheet" href="/objection.js/assets/css/0.styles.6be6f8e1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/objection.js/" class="home-link router-link-active"><!----> <span class="site-name">Objection.js</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/objection.js/guide/" class="nav-link">Guide</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="API Reference" class="dropdown-title"><span class="title">API Reference</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/objection.js/api/objection/" class="nav-link">Main Module</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/query-builder/" class="nav-link">Query Builder</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/model/" class="nav-link">Model</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/types/" class="nav-link">Types</a></li></ul></div></div><div class="nav-item"><a href="/objection.js/recipes/" class="nav-link router-link-active">Recipe Book</a></div><div class="nav-item"><a href="/objection.js/changelog/" class="nav-link">Changelog</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="v1.x" class="dropdown-title"><span class="title">v1.x</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/objection.js/1.x/migration.html" class="nav-link">Migration to 2.0</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Vincit/objection.js/tree/v1/doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  v1.x documentation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/vincit/objection.js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ⭐ Star
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/vincit/objection.js" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/objection.js/guide/" class="nav-link">Guide</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="API Reference" class="dropdown-title"><span class="title">API Reference</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/objection.js/api/objection/" class="nav-link">Main Module</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/query-builder/" class="nav-link">Query Builder</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/model/" class="nav-link">Model</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/types/" class="nav-link">Types</a></li></ul></div></div><div class="nav-item"><a href="/objection.js/recipes/" class="nav-link router-link-active">Recipe Book</a></div><div class="nav-item"><a href="/objection.js/changelog/" class="nav-link">Changelog</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="v1.x" class="dropdown-title"><span class="title">v1.x</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/objection.js/1.x/migration.html" class="nav-link">Migration to 2.0</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Vincit/objection.js/tree/v1/doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  v1.x documentation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/vincit/objection.js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ⭐ Star
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/vincit/objection.js" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Recipes</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/objection.js/recipes/raw-queries.html" class="sidebar-link">Raw queries</a></li><li><a href="/objection.js/recipes/precedence-and-parentheses.html" class="sidebar-link">Precedence and parentheses</a></li><li><a href="/objection.js/recipes/subqueries.html" class="sidebar-link">Subqueries</a></li><li><a href="/objection.js/recipes/relation-subqueries.html" class="sidebar-link">Relation subqueries</a></li><li><a href="/objection.js/recipes/joins.html" class="sidebar-link">Joins</a></li><li><a href="/objection.js/recipes/modifiers.html" class="sidebar-link">Modifiers</a></li><li><a href="/objection.js/recipes/composite-keys.html" class="sidebar-link">Composite keys</a></li><li><a href="/objection.js/recipes/polymorphic-associations.html" class="sidebar-link">Polymorphic associations</a></li><li><a href="/objection.js/recipes/json-queries.html" class="sidebar-link">JSON queries</a></li><li><a href="/objection.js/recipes/custom-id-column.html" class="sidebar-link">Custom id column</a></li><li><a href="/objection.js/recipes/extra-properties.html" class="sidebar-link">Join table extra properties</a></li><li><a href="/objection.js/recipes/custom-validation.html" class="sidebar-link">Custom validation</a></li><li><a href="/objection.js/recipes/snake-case-to-camel-case-conversion.html" class="sidebar-link">Snake case to camel case conversion</a></li><li><a href="/objection.js/recipes/paging.html" class="sidebar-link">Paging</a></li><li><a href="/objection.js/recipes/returning-tricks.html" class="sidebar-link">PostgreSQL &quot;returning&quot; tricks</a></li><li><a href="/objection.js/recipes/timestamps.html" class="sidebar-link">Timestamps</a></li><li><a href="/objection.js/recipes/custom-query-builder.html" class="active sidebar-link">Custom query builder (extending the query builder)</a></li><li><a href="/objection.js/recipes/multitenancy-using-multiple-databases.html" class="sidebar-link">Multitenancy using multiple databases</a></li><li><a href="/objection.js/recipes/default-values.html" class="sidebar-link">Default values</a></li><li><a href="/objection.js/recipes/error-handling.html" class="sidebar-link">Error handling</a></li><li><a href="/objection.js/recipes/ternary-relationships.html" class="sidebar-link">Ternary relationships</a></li><li><a href="/objection.js/recipes/indexing-postgresql-jsonb-columns.html" class="sidebar-link">Indexing PostgreSQL JSONB columns</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="custom-query-builder-extending-the-query-builder"><a href="#custom-query-builder-extending-the-query-builder" class="header-anchor">#</a> Custom query builder (extending the query builder)</h1> <p>You can extend the <a href="/objection.js/api/query-builder/">QueryBuilder</a> returned by <a href="/objection.js/api/model/static-methods.html#static-query">query()</a>, <a href="/objection.js/api/model/static-methods.html#static-relatedquery">relatedQuery()</a>, <a href="/objection.js/api/model/instance-methods.html#relatedquery">$relatedQuery()</a> and <a href="/objection.js/api/model/instance-methods.html#query">$query()</a> methods (and all other methods that create a <a href="/objection.js/api/query-builder/">QueryBuilder</a>) by setting the model class's static <a href="/objection.js/api/model/static-methods.html#static-querybuilder">QueryBuilder</a> property.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// MyQueryBuilder.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> QueryBuilder <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'objection'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyQueryBuilder</span> <span class="token keyword">extends</span> <span class="token class-name">QueryBuilder</span> <span class="token punctuation">{</span>
  <span class="token function">myCustomMethod</span><span class="token punctuation">(</span><span class="token parameter">something</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">doSomething</span><span class="token punctuation">(</span>something<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Person.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> MyQueryBuilder <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./MyQueryBuilder'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">QueryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> MyQueryBuilder<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Now you can do this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">myCustomMethod</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you want to set the custom query builder for all model classes you can just set the <a href="/objection.js/api/model/static-methods.html#static-querybuilder">QueryBuilder</a> property of the <a href="/objection.js/api/model/">Model</a> base class. A cleaner option would be to create your own Model subclass, set its <a href="/objection.js/api/query-builder/">QueryBuilder</a> property and inherit all your models from the custom Model class.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// BaseModel.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> MyQueryBuilder <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./MyQueryBuilder'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">BaseModel</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">QueryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> MyQueryBuilder<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Person.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> BaseModel <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./BaseModel'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Person now uses MyQueryBuilder</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">extends</span> <span class="token class-name">BaseModel</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>Whenever a <a href="/objection.js/api/query-builder/">QueryBuilder</a> instance is created it is done by calling the static <a href="/objection.js/api/model/static-methods.html#static-query">query()</a> method. If you don't need to add methods, but simply modify the query, you can override the <a href="/objection.js/api/model/static-methods.html#static-query">query()</a>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">BaseModel</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Somehow modify the query.</span>
    <span class="token keyword">return</span> query<span class="token punctuation">.</span><span class="token function">runAfter</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">'got result'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>TIP: Consider using <a href="/objection.js/recipes/modifiers.html#usage-in-a-query">modifiers</a> instead of extending the query builder. You can often achieve the same flexibility with both.</p></div> <h1 id="extending-the-query-builder-in-typescript"><a href="#extending-the-query-builder-in-typescript" class="header-anchor">#</a> Extending the query builder in typescript</h1> <p>With typescript, you need to add some extra type properties for the custom query builder. These are necessary until typescript fully supports our use case. The good news is that you only need to define them once for the shared <code>BaseModel</code>. If you don't already have one, it's time to crate it.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Model<span class="token punctuation">,</span> Page <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'objection'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyQueryBuilder</span><span class="token operator">&lt;</span><span class="token constant">M</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">,</span> <span class="token constant">R</span> <span class="token operator">=</span> <span class="token constant">M</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">extends</span> <span class="token class-name">QueryBuilder</span><span class="token operator">&lt;</span><span class="token constant">M</span><span class="token punctuation">,</span> <span class="token constant">R</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// These are necessary. You can just copy-paste them and change the</span>
  <span class="token comment">// name of the query builder class.</span>
  ArrayQueryBuilderType<span class="token operator">!</span><span class="token punctuation">:</span> MyQueryBuilder<span class="token operator">&lt;</span><span class="token constant">M</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  SingleQueryBuilderType<span class="token operator">!</span><span class="token punctuation">:</span> MyQueryBuilder<span class="token operator">&lt;</span><span class="token constant">M</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  NumberQueryBuilderType<span class="token operator">!</span><span class="token punctuation">:</span> MyQueryBuilder<span class="token operator">&lt;</span><span class="token constant">M</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  PageQueryBuilderType<span class="token operator">!</span><span class="token punctuation">:</span> MyQueryBuilder<span class="token operator">&lt;</span><span class="token constant">M</span><span class="token punctuation">,</span> Page<span class="token operator">&lt;</span><span class="token constant">M</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span>

  <span class="token function">myCustomMethod</span><span class="token punctuation">(</span>something<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">this</span> <span class="token punctuation">{</span>
    <span class="token function">doSomething</span><span class="token punctuation">(</span>something<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">BaseModel</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token comment">// Both of these are needed.</span>
  QueryBuilderType<span class="token operator">!</span><span class="token punctuation">:</span> MyQueryBuilder<span class="token operator">&lt;</span><span class="token keyword">this</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> QueryBuilder <span class="token operator">=</span> MyQueryBuilder<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Now all models you inherit from <code>BaseModel</code> use <code>MyQueryBuilder</code> as a query builder.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">extends</span> <span class="token class-name">BaseModel</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> tableName <span class="token operator">=</span> <span class="token string">'persons'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">myCustomMethod</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>TIP: Consider using <a href="/objection.js/recipes/modifiers.html#usage-in-a-query">modifiers</a> instead of extending the query builder. You can often achieve the same flexibility with both.</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/objection.js/recipes/timestamps.html" class="prev">Timestamps</a></span> <span class="next"><a href="/objection.js/recipes/multitenancy-using-multiple-databases.html">Multitenancy using multiple databases</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/objection.js/assets/js/app.50db977b.js" defer></script><script src="/objection.js/assets/js/6.4413d797.js" defer></script><script src="/objection.js/assets/js/7.e45d78f3.js" defer></script><script src="/objection.js/assets/js/38.ebdc7e7e.js" defer></script>
  </body>
</html>
