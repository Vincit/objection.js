<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Documentation</title>

    <link href="../stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="../stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="../javascripts/all_nosearch.js" type="text/javascript"></script>

  </head>

  <body class="includes includes_API">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="../images/logo.png" />
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="api-reference">API reference</h1>

<p><strong>NOTE</strong>: Everything not mentioned in the API documentation is considered private implementation
and shouldn&rsquo;t be relied upon. Private implemementation can change without any notice even between
patch versions. Public API described here follows <a href="https://semver.org/">semantic versioning</a>.</p>

<h2 id="the-main-module">The main module</h2>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">mainModule</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>
<span class="kr">const</span> <span class="p">{</span> <span class="nx">Model</span><span class="p">,</span> <span class="nx">ref</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>
</code></pre>
<p>The main module is what you get when you import objection. It has a bunch of properties that are all
documented elsewhere in the API docs.</p>

<h3 id="properties">Properties</h3>

<h4 id="objection-model">Model</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">Model</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>
</code></pre>
<p><a href="#model">The model base class.</a></p>

<h4 id="objection-transaction">transaction</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">transaction</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>
</code></pre>
<p><a href="#transactions">The transaction function.</a></p>

<h4 id="objection-ref">ref</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">ref</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>
</code></pre>
<p><a href="#ref">The ref helper function.</a></p>

<h4 id="objection-raw">raw</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">raw</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>
</code></pre>
<p><a href="#raw">The raw helper function.</a></p>

<h4 id="objection-lit">lit</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">lit</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>
</code></pre>
<p><a href="#lit">The lit helper function.</a></p>

<h4 id="objection-mixin">mixin</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">mixin</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>
</code></pre>
<p><a href="#plugins">The mixin helper</a> for applying plugins. See the examples behind this link.</p>

<h4 id="objection-compose">compose</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">compose</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>
</code></pre>
<p><a href="#plugins">The compose helper</a> for applying plugins. See the examples behind this link.</p>

<h4 id="objection-lodash">lodash</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">lodash</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>
</code></pre>
<p><a href="https://lodash.com/">Lodash utility library</a> used internally by objection.</p>

<h4 id="objection-promise">Promise</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">Promise</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>
</code></pre>
<p><a href="http://bluebirdjs.com/docs/getting-started.html">Bluebird promise library</a> used internally by objection.</p>

<h4 id="objection-knexsnakecasemappers">knexSnakeCaseMappers</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">knexSnakeCaseMappers</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">Knex</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'knex'</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">knex</span> <span class="o">=</span> <span class="nx">Knex</span><span class="p">({</span>
  <span class="na">client</span><span class="p">:</span> <span class="s1">'postgres'</span><span class="p">,</span>

  <span class="na">connection</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">host</span><span class="p">:</span> <span class="s1">'127.0.0.1'</span><span class="p">,</span>
    <span class="na">user</span><span class="p">:</span> <span class="s1">'objection'</span><span class="p">,</span>
    <span class="na">database</span><span class="p">:</span> <span class="s1">'objection_test'</span>
  <span class="p">}</span>

  <span class="c1">// Merge `postProcessResponse` and `wrapIdentifier` mappers.</span>
  <span class="p">...</span><span class="nx">knexSnakeCaseMappers</span><span class="p">()</span>
<span class="p">});</span>
</code></pre>
<blockquote>
<p>For older nodes:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">Knex</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'knex'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">knexSnakeCaseMappers</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">).</span><span class="nx">knexSnakeCaseMappers</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">knex</span> <span class="o">=</span> <span class="nx">Knex</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({</span>
  <span class="na">client</span><span class="p">:</span> <span class="s1">'postgres'</span><span class="p">,</span>

  <span class="na">connection</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">host</span><span class="p">:</span> <span class="s1">'127.0.0.1'</span><span class="p">,</span>
    <span class="na">user</span><span class="p">:</span> <span class="s1">'objection'</span><span class="p">,</span>
    <span class="na">database</span><span class="p">:</span> <span class="s1">'objection_test'</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="nx">knexSnakeCaseMappers</span><span class="p">()));</span>
</code></pre>
<p>Documented <a href="#snake-case-to-camel-case-conversion">here</a>.</p>

<h4 id="objection-knexidentifiermapping">knexIdentifierMapping</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">knexIdentifierMapping</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">Knex</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'knex'</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">knex</span> <span class="o">=</span> <span class="nx">Knex</span><span class="p">({</span>
  <span class="na">client</span><span class="p">:</span> <span class="s1">'postgres'</span><span class="p">,</span>

  <span class="na">connection</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">host</span><span class="p">:</span> <span class="s1">'127.0.0.1'</span><span class="p">,</span>
    <span class="na">user</span><span class="p">:</span> <span class="s1">'objection'</span><span class="p">,</span>
    <span class="na">database</span><span class="p">:</span> <span class="s1">'objection_test'</span>
  <span class="p">}</span>

  <span class="c1">// Merge `postProcessResponse` and `wrapIdentifier` mappers.</span>
  <span class="p">...</span><span class="nx">knexIdentifierMapping</span><span class="p">({</span>
    <span class="na">MyId</span><span class="p">:</span> <span class="s1">'id'</span><span class="p">,</span>
    <span class="na">MyProp</span><span class="p">:</span> <span class="s1">'prop'</span><span class="p">,</span>
    <span class="na">MyAnotherProp</span><span class="p">:</span> <span class="s1">'anotherProp'</span>
  <span class="p">})</span>
<span class="p">});</span>
</code></pre>
<blockquote>
<p>Note that you can pretty easily define the conversions in some static property
of your model. In this example we have added a property <code class="prettyprint">column</code> to jsonSchema
and use that to create the mapping object.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">knexIdentifierMapping</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">Knex</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'knex'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>

<span class="c1">// Path to your model folder.</span>
<span class="kr">const</span> <span class="nx">MODELS_PATH</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'models'</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">knex</span> <span class="o">=</span> <span class="nx">Knex</span><span class="p">({</span>
  <span class="na">client</span><span class="p">:</span> <span class="s1">'postgres'</span><span class="p">,</span>

  <span class="na">connection</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">host</span><span class="p">:</span> <span class="s1">'127.0.0.1'</span><span class="p">,</span>
    <span class="na">user</span><span class="p">:</span> <span class="s1">'objection'</span><span class="p">,</span>
    <span class="na">database</span><span class="p">:</span> <span class="s1">'objection_test'</span>
  <span class="p">}</span>

  <span class="c1">// Go through all models and add conversions using the custom property</span>
  <span class="c1">// `column` in json schema.</span>
  <span class="p">...</span><span class="nx">knexIdentifierMapping</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readdirSync</span><span class="p">(</span><span class="nx">MODELS_PATH</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">it</span> <span class="o">=&gt;</span> <span class="nx">it</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="s1">'.js'</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">it</span> <span class="o">=&gt;</span> <span class="nx">require</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">MODELS_PATH</span><span class="p">,</span> <span class="nx">it</span><span class="p">)))</span>
    <span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">mapping</span><span class="p">,</span> <span class="nx">modelClass</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">properties</span> <span class="o">=</span> <span class="nx">modelClass</span><span class="p">.</span><span class="nx">jsonSchema</span><span class="p">.</span><span class="nx">properties</span><span class="p">;</span>
      <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">properties</span><span class="p">).</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">mapping</span><span class="p">,</span> <span class="nx">propName</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">mapping</span><span class="p">[</span><span class="nx">properties</span><span class="p">[</span><span class="nx">propName</span><span class="p">].</span><span class="nx">column</span><span class="p">]</span> <span class="o">=</span> <span class="nx">propName</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">mapping</span><span class="p">;</span>
      <span class="p">},</span> <span class="nx">mapping</span><span class="p">);</span>
    <span class="p">},</span> <span class="p">{});</span>
  <span class="p">)</span>
<span class="p">});</span>
</code></pre>
<blockquote>
<p>For older nodes:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">Knex</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'knex'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">knexSnakeCaseMappers</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">).</span><span class="nx">knexSnakeCaseMappers</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">knex</span> <span class="o">=</span> <span class="nx">Knex</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({</span>
  <span class="na">client</span><span class="p">:</span> <span class="s1">'postgres'</span><span class="p">,</span>

  <span class="na">connection</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">host</span><span class="p">:</span> <span class="s1">'127.0.0.1'</span><span class="p">,</span>
    <span class="na">user</span><span class="p">:</span> <span class="s1">'objection'</span><span class="p">,</span>
    <span class="na">database</span><span class="p">:</span> <span class="s1">'objection_test'</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="nx">knexIdentifierMapping</span><span class="p">({</span>
  <span class="na">MyId</span><span class="p">:</span> <span class="s1">'id'</span><span class="p">,</span>
  <span class="na">MyProp</span><span class="p">:</span> <span class="s1">'prop'</span><span class="p">,</span>
  <span class="na">MyAnotherProp</span><span class="p">:</span> <span class="s1">'anotherProp'</span>
<span class="p">})));</span>
</code></pre>
<p>Like <a href="#objection-knexsnakecasemappers">knexSnakeCaseMappers</a>, but can be used to make an arbitrary
static mapping between column names and property names. In the examples, you would have identifiers
<code class="prettyprint">MyId</code>, <code class="prettyprint">MyProp</code> and <code class="prettyprint">MyAnotherProp</code> in the database and you would like to map them into <code class="prettyprint">id</code>, <code class="prettyprint">prop</code>
and <code class="prettyprint">anotherProp</code> in the code.</p>

<h4 id="objection-snakecasemappers">snakeCaseMappers</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">Model</span><span class="p">,</span> <span class="nx">snakeCaseMappers</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>

<span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">columnNameMappers</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">snakeCaseMappers</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>ESNext:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">Model</span><span class="p">,</span> <span class="nx">snakeCaseMappers</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'objection'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">columnNameMappers</span> <span class="o">=</span> <span class="nx">snakeCaseMappers</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
<p>Documented <a href="#snake-case-to-camel-case-conversion">here</a>.</p>

<h2 id="querybuilder">QueryBuilder</h2>

<p>Query builder for Models.</p>

<p>This class is a wrapper around <a href="http://knexjs.org#Builder">knex QueryBuilder</a>. QueryBuilder has all the methods a
knex QueryBuilder has and more. While knex QueryBuilder returns plain javascript objects, QueryBuilder returns Model
subclass instances.</p>

<p>QueryBuilder is thenable, meaning that it can be used like a promise. You can
return query builder from a <a href="#then"><code class="prettyprint">then</code></a> method of a promise and it gets chained just like
a normal promise would.</p>

<p>The query is executed when one of its promise methods <a href="#then"><code class="prettyprint">then()</code></a>, <a href="#catch"><code class="prettyprint">catch()</code></a>, <a href="#map"><code class="prettyprint">map()</code></a>,
<a href="#bind"><code class="prettyprint">bind()</code></a> or <a href="#return"><code class="prettyprint">return()</code></a> is called.</p>

<h3 id="static-methods">Static methods</h3>

<h4 id="forclass">forClass</h4>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">QueryBuilder</span><span class="p">.</span><span class="nx">forClass</span><span class="p">(</span><span class="nx">modelClass</span><span class="p">);</span>
</code></pre>
<p>Create QueryBuilder for a Model subclass. You rarely need to call this. Query builders are created using the
<a href="#query"><code class="prettyprint">Model.query()</code></a> and other query methods.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>modelClass</td>
<td><a href="#model"><code class="prettyprint">Model</code></a></td>
<td>A Model class constructor</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td>The created query builder</td>
</tr>
</tbody></table>

<h3 id="global-query-building-helpers">Global query building helpers</h3>

<h4 id="ref">ref</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">).</span><span class="nx">ref</span><span class="p">;</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">ref</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'objection'</span><span class="p">;</span>

<span class="nx">await</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">select</span><span class="p">([</span>
    <span class="s1">'id'</span><span class="p">,</span>
    <span class="nx">ref</span><span class="p">(</span><span class="s1">'Model.jsonColumn:details.name'</span><span class="p">).</span><span class="nx">castText</span><span class="p">().</span><span class="nx">as</span><span class="p">(</span><span class="s1">'name'</span><span class="p">),</span>
    <span class="nx">ref</span><span class="p">(</span><span class="s1">'Model.jsonColumn:details.age'</span><span class="p">).</span><span class="nx">castInt</span><span class="p">().</span><span class="nx">as</span><span class="p">(</span><span class="s1">'age'</span><span class="p">)</span>
  <span class="p">])</span>
  <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">'OtherModel'</span><span class="p">,</span> <span class="nx">ref</span><span class="p">(</span><span class="s1">'Model.jsonColumn:details.name'</span><span class="p">).</span><span class="nx">castText</span><span class="p">(),</span> <span class="s1">'='</span><span class="p">,</span> <span class="nx">ref</span><span class="p">(</span><span class="s1">'OtherModel.name'</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="nx">ref</span><span class="p">(</span><span class="s1">'OtherModel.ageLimit'</span><span class="p">));</span>
</code></pre>
<p>Factory function that returns a <a href="#referencebuilder"><code class="prettyprint">ReferenceBuilder</code></a> instance, that makes it easier to refer
to tables, columns, json attributes etc. <code class="prettyprint">ReferenceBuilder</code> can also be used to type cast and alias the references.</p>

<p>See <a href="#fieldexpression"><code class="prettyprint">FieldExpression</code></a> for more information about how to refer to json fields.</p>

<h4 id="lit">lit</h4>
<pre class="highlight javascript"><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">lit</span><span class="p">,</span> <span class="nx">ref</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'objection'</span><span class="p">;</span>

<span class="nx">await</span> <span class="nx">Model</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">ref</span><span class="p">(</span><span class="s1">'Model.jsonColumn:details'</span><span class="p">),</span> <span class="s1">'='</span><span class="p">,</span> <span class="nx">lit</span><span class="p">({</span><span class="na">name</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">29</span><span class="p">}))</span>
</code></pre>
<p>Factory function that returns a <a href="#literalbuilder"><code class="prettyprint">LiteralBuilder</code></a> instance. <code class="prettyprint">LiteralBuilder</code>
helps build literals of different types.</p>

<h4 id="raw">raw</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">raw</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">childAgeSums</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">raw</span><span class="p">(</span><span class="s1">'coalesce(sum(??), 0) as ??'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'childAgeSum'</span><span class="p">]))</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">raw</span><span class="p">(</span><span class="s2">`?? || ' ' || ??`</span><span class="p">,</span> <span class="s1">'firstName'</span><span class="p">,</span> <span class="s1">'lastName'</span><span class="p">),</span> <span class="s1">'Arnold Schwarzenegger'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">orderBy</span><span class="p">(</span><span class="nx">raw</span><span class="p">(</span><span class="s1">'random()'</span><span class="p">));</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">childAgeSums</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">childAgeSum</span><span class="p">);</span>
</code></pre>
<p>Factory function that returns a <a href="#rawbuilder"><code class="prettyprint">RawBuilder</code></a> instance. <code class="prettyprint">RawBuilder</code> is a
wrapper for knex raw query that doesn&rsquo;t depend on knex. Instances of <code class="prettyprint">RawBuilder</code> are
converted to knex raw instances lazily when the query is executed.</p>

<h3 id="query-building-methods">Query building methods</h3>

<h4 id="findbyid">findById</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">findById</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Composite key:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">findById</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'10'</span><span class="p">]);</span>
</code></pre>
<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>any&#124; Array.&lt;any&gt;</td>
<td></td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="findbyids">findByIds</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">findByIds</span><span class="p">([</span><span class="nx">id1</span><span class="p">,</span> <span class="nx">id2</span><span class="p">]);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">[</span><span class="nx">person1</span><span class="p">,</span> <span class="nx">person2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">findByIds</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>
</code></pre>
<blockquote>
<p>Composite key:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">[</span><span class="nx">person1</span><span class="p">,</span> <span class="nx">person2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">findByIds</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'10'</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'10'</span><span class="p">]]);</span>
</code></pre>
<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>any&#124;any[]</td>
<td>A List of identifiers.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="findone">findOne</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(...</span><span class="nx">whereArgs</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">findOne</span><span class="p">({</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">,</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">});</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">findOne</span><span class="p">(</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">findOne</span><span class="p">(</span><span class="nx">raw</span><span class="p">(</span><span class="s1">'random() &lt; 0.5'</span><span class="p">));</span>
</code></pre>
<p>Shorthand for <code class="prettyprint">where(...whereArgs).first()</code>.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>whereArgs</td>
<td>&hellip;any</td>
<td>Anything the <a href="#where"><code class="prettyprint">where</code></a> method accepts.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="insert">insert</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">modelsOrObjects</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">jennifer</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">,</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">jennifer</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Batch insert (Only works on Postgres):</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">actors</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">someMovie</span>
  <span class="p">.</span><span class="nx">$relatedQuery</span><span class="p">(</span><span class="s1">'actors'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">insert</span><span class="p">([</span>
    <span class="p">{</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">,</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">},</span>
    <span class="p">{</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Bradley'</span><span class="p">,</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Cooper'</span><span class="p">}</span>
  <span class="p">]);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">actors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">firstName</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">actors</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">firstName</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>You can also give raw expressions and subqueries as values like this:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">raw</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>

<span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">insert</span><span class="p">({</span>
    <span class="na">age</span><span class="p">:</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">avg</span><span class="p">(</span><span class="s1">'age'</span><span class="p">),</span>
    <span class="na">firstName</span><span class="p">:</span> <span class="nx">raw</span><span class="p">(</span><span class="s2">"'Jenni' || 'fer'"</span><span class="p">)</span>
  <span class="p">});</span>
</code></pre>
<blockquote>
<p>Fields marked as <code class="prettyprint">extras</code> for many-to-many relations in <a href="#relationmappings"><code class="prettyprint">relationMappings</code></a> are automatically
written to the join table instead of the target table. The <code class="prettyprint">someExtra</code> field in the following example is written
to the join table if the <code class="prettyprint">extra</code> array of the relation mapping contains the string <code class="prettyprint">&#39;someExtra&#39;</code>.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">jennifer</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">someMovie</span>
  <span class="p">.</span><span class="nx">$relatedQuery</span><span class="p">(</span><span class="s1">'actors'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">insert</span><span class="p">({</span>
    <span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">,</span>
    <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">,</span>
    <span class="na">someExtra</span><span class="p">:</span> <span class="s2">"I'll be written to the join table"</span>
  <span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">jennifer</span><span class="p">.</span><span class="nx">someExtra</span><span class="p">);</span>
</code></pre>
<p>Creates an insert query.</p>

<p>The inserted objects are validated against the model&rsquo;s <a href="#jsonschema"><code class="prettyprint">jsonSchema</code></a>. If validation fails
the Promise is rejected with a <a href="#validationerror"><code class="prettyprint">ValidationError</code></a>.</p>

<p>NOTE: The return value of the insert query <em>only</em> contains the properties given to the insert
method plus the identifier. This is because we don&rsquo;t make an additional fetch query after
the insert. Using postgres you can chain <a href="#returning"><code class="prettyprint">returning(&#39;*&#39;)</code></a> to the query to get all
properties - see <a href="#postgresql-quot-returning-quot-tricks">this recipe</a> for some examples. If you use
<code class="prettyprint">returning([&#39;only&#39;, &#39;some&#39;, &#39;props&#39;])</code> note that the result object will still contain the input properies
<strong>plus</strong> the properties listed in <code class="prettyprint">returning</code>. On other databases you can use the <a href="#insertandfetch"><code class="prettyprint">insertAndFetch</code></a> method.</p>

<p>Batch inserts only work on Postgres because Postgres is the only database engine
that returns the identifiers of <em>all</em> inserted rows. knex supports batch inserts on
other databases also, but you only get the id of the first (or last) inserted object
as a result. If you need batch insert on other databases you can use knex directly
through <a href="#knexquery"><code class="prettyprint">YourModel.knexQuery()</code></a>.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>modelsOrObjects</td>
<td>Object&#124;<a href="#model"><code class="prettyprint">Model</code></a>&#124;Object[]&#124;<a href="#model"><code class="prettyprint">Model</code></a>[];</td>
<td>Objects to insert</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="insertandfetch">insertAndFetch</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">insertAndFetch</span><span class="p">(</span><span class="nx">modelsOrObjects</span><span class="p">);</span>
</code></pre>
<p>Just like <a href="#insert"><code class="prettyprint">insert</code></a> but also fetches the model afterwards.</p>

<p>Note that on postgresql you can just chain <a href="#returning"><code class="prettyprint">returning(&#39;*&#39;)</code></a> to the normal insert method
to get the same result without an additional query. See <a href="#postgresql-quot-returning-quot-tricks">this recipe</a> for some examples.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>modelsOrObjects</td>
<td>Object&#124;<a href="#model"><code class="prettyprint">Model</code></a>&#124;Object[]&#124;<a href="#model"><code class="prettyprint">Model</code></a>[];</td>
<td>Objects to insert</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="insertgraph">insertGraph</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">insertGraph</span><span class="p">(</span><span class="nx">graph</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</code></pre>
<p>See the <a href="#graph-inserts">section about graph inserts</a>.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>graph</td>
<td>Object&#124;<a href="#model"><code class="prettyprint">Model</code></a>&#124;Object[]&#124;<a href="#model"><code class="prettyprint">Model</code></a>[];</td>
<td>Objects to insert</td>
</tr>
<tr>
<td>graph</td>
<td><a href="#insertgraphoptions"><code class="prettyprint">InsertGraphOptions</code></a></td>
<td>Optional options.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="insertgraphandfetch">insertGraphAndFetch</h4>

<p>Exactly like <a href="#insertgraph">insertGraph</a> but also fetches the graph from the db after insert.</p>

<h4 id="insertwithrelated">insertWithRelated</h4>

<p>Alias for <a href="#insertgraph">insertGraph</a>.</p>

<h4 id="insertwithrelatedandfetch">insertWithRelatedAndFetch</h4>

<p>Alias for <a href="#insertgraphandfetch">insertGraphAndFetch</a>.</p>

<h4 id="update">update</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">modelOrObject</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">numberOfAffectedRows</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">,</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">24</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="mi">134</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">numberOfAffectedRows</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>You can also give raw expressions, subqueries and <code class="prettyprint">ref()</code> as values like this:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">raw</span><span class="p">,</span> <span class="nx">ref</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>

<span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">update</span><span class="p">({</span>
    <span class="na">firstName</span><span class="p">:</span> <span class="nx">raw</span><span class="p">(</span><span class="s2">"'Jenni' || 'fer'"</span><span class="p">),</span>
    <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">,</span>
    <span class="na">age</span><span class="p">:</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">avg</span><span class="p">(</span><span class="s1">'age'</span><span class="p">),</span>
    <span class="na">oldLastName</span><span class="p">:</span> <span class="nx">ref</span><span class="p">(</span><span class="s1">'lastName'</span><span class="p">)</span> <span class="c1">// same as knex.raw('??', ['lastName'])</span>
  <span class="p">});</span>
</code></pre>
<blockquote>
<p>Updating single value inside json column and referring attributes inside json columns (only with postgres) etc.:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">update</span><span class="p">({</span>
    <span class="na">lastName</span><span class="p">:</span> <span class="nx">ref</span><span class="p">(</span><span class="s1">'someJsonColumn:mother.lastName'</span><span class="p">).</span><span class="nx">castText</span><span class="p">(),</span>
    <span class="s1">'detailsJsonColumn:address.street'</span><span class="p">:</span> <span class="s1">'Elm street'</span>
  <span class="p">});</span>
</code></pre>
<p>Creates an update query.</p>

<p>The update object is validated against the model&rsquo;s <a href="#jsonschema"><code class="prettyprint">jsonSchema</code></a>. If validation fails
the Promise is rejected with a <a href="#validationerror"><code class="prettyprint">ValidationError</code></a>.</p>

<p>This method is meant for updating <em>whole</em> objects with all required properties. If you
want to update a subset of properties use the <a href="#patch"><code class="prettyprint">patch</code></a> method.</p>

<p>NOTE: The return value of the query will be the number of affected rows. If you want to update a single row and
retrieve the updated row as a result, you may want to use the <a href="#updateandfetchbyid"><code class="prettyprint">updateAndFetchById</code></a> method
or <em>take a look at <a href="#postgresql-quot-returning-quot-tricks">this recipe</a> if you&rsquo;re using Postgres</em>.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>modelOrObject</td>
<td>Object&#124;<a href="#model"><code class="prettyprint">Model</code></a></td>
<td>The update object</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="updateandfetchbyid">updateAndFetchById</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">updateAndFetchById</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">modelOrObject</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">updatedModel</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">updateAndFetchById</span><span class="p">(</span><span class="mi">134</span><span class="p">,</span> <span class="p">{</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">,</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">24</span><span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">updatedModel</span><span class="p">.</span><span class="nx">firstName</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>You can also give raw expressions and subqueries as values like this:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">raw</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>

<span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">updateAndFetchById</span><span class="p">(</span><span class="mi">134</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">firstName</span><span class="p">:</span> <span class="nx">raw</span><span class="p">(</span><span class="s2">"'Jenni' || 'fer'"</span><span class="p">),</span>
    <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">,</span>
    <span class="na">age</span><span class="p">:</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">avg</span><span class="p">(</span><span class="s1">'age'</span><span class="p">)</span>
  <span class="p">});</span>
</code></pre>
<p>Updates a single model by id and fetches it from the database afterwards.</p>

<p>The update object is validated against the model&rsquo;s <a href="#jsonschema"><code class="prettyprint">jsonSchema</code></a>. If validation fails
the Promise is rejected with a <a href="#validationerror"><code class="prettyprint">ValidationError</code></a>.</p>

<p>This method is meant for updating <em>whole</em> objects with all required properties. If you
want to update a subset of properties use the <a href="#patchandfetchbyid"><code class="prettyprint">patchAndFetchById</code></a> method.</p>

<p>NOTE: On postgresql you can just chain <a href="#first"><code class="prettyprint">first()</code></a> and <a href="#returning"><code class="prettyprint">returning(&#39;*&#39;)</code></a> to the normal <a href="#update"><code class="prettyprint">update</code></a> method
to get the same result without an additional query. See <a href="#postgresql-quot-returning-quot-tricks">this recipe</a> for some examples.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>string&#124;number</td>
<td>Identifier of the model to update</td>
</tr>
<tr>
<td>modelOrObject</td>
<td>Object&#124;<a href="#model"><code class="prettyprint">Model</code></a></td>
<td>The update object</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="updateandfetch">updateAndFetch</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">updateAndFetch</span><span class="p">(</span><span class="nx">modelOrObject</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">updatedModel</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">person</span>
  <span class="p">.</span><span class="nx">$query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">updateAndFetch</span><span class="p">({</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">,</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">24</span><span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">updatedModel</span><span class="p">.</span><span class="nx">firstName</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>You can also give raw expressions and subqueries as values like this:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">raw</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>

<span class="nx">await</span> <span class="nx">person</span>
  <span class="p">.</span><span class="nx">$query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">updateAndFetch</span><span class="p">({</span>
    <span class="na">firstName</span><span class="p">:</span> <span class="nx">raw</span><span class="p">(</span><span class="s2">"'Jenni' || 'fer'"</span><span class="p">),</span>
    <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">,</span>
    <span class="na">age</span><span class="p">:</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">avg</span><span class="p">(</span><span class="s1">'age'</span><span class="p">)</span>
  <span class="p">});</span>
</code></pre>
<p>Updates a single model and fetches it from the database afterwards. This only works with instance queries
started with <a href="#_s_query"><code class="prettyprint">$query()</code></a> method.</p>

<p>The update object is validated against the model&rsquo;s <a href="#jsonschema"><code class="prettyprint">jsonSchema</code></a>. If validation fails
the Promise is rejected with a <a href="#validationerror"><code class="prettyprint">ValidationError</code></a>.</p>

<p>This method is meant for updating <em>whole</em> objects with all required properties. If you
want to update a subset of properties use the <a href="#patchandfetch"><code class="prettyprint">patchAndFetch</code></a> method.</p>

<p>NOTE: On postgresql you can just chain <a href="#first"><code class="prettyprint">first()</code></a> and <a href="#returning"><code class="prettyprint">returning(&#39;*&#39;)</code></a> to the normal <a href="#update"><code class="prettyprint">update</code></a> method
to get the same result without an additional query. See <a href="#postgresql-quot-returning-quot-tricks">this recipe</a> for some examples.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>modelOrObject</td>
<td>Object&#124;<a href="#model"><code class="prettyprint">Model</code></a></td>
<td>The update object</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="upsertgraph">upsertGraph</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">upsertGraph</span><span class="p">(</span><span class="nx">modelOrObject</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</code></pre>
<p>See the <a href="#graph-upserts">section about graph upserts</a></p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>graph</td>
<td>Object&#124;<a href="#model"><code class="prettyprint">Model</code></a>&#124;Object[]&#124;<a href="#model"><code class="prettyprint">Model</code></a>[];</td>
<td>Graph to upsert.</td>
</tr>
<tr>
<td>options</td>
<td><a href="#upsertgraphoptions"><code class="prettyprint">UpsertGraphOptions</code></a></td>
<td>Optional options.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="upsertgraphandfetch">upsertGraphAndFetch</h4>

<p>Exactly like <a href="#upsertgraph">upsertGraph</a> but also fetches the graph from the db after the upsert operation.</p>

<h4 id="patch">patch</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">patch</span><span class="p">(</span><span class="nx">modelOrObject</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">numberOfAffectedRows</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">patch</span><span class="p">({</span><span class="na">age</span><span class="p">:</span> <span class="mi">24</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="mi">134</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">numberOfAffectedRows</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>You can also give raw expressions, subqueries and <code class="prettyprint">ref()</code> as values and <a href="#fieldexpression"><code class="prettyprint">FieldExpressions</code></a> as keys:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span><span class="nx">ref</span><span class="p">,</span> <span class="nx">raw</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>

<span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">patch</span><span class="p">({</span>
    <span class="na">age</span><span class="p">:</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">avg</span><span class="p">(</span><span class="s1">'age'</span><span class="p">),</span>
    <span class="c1">// You can use knex.raw instead of `raw()` if</span>
    <span class="c1">// you prefer.</span>
    <span class="na">firstName</span><span class="p">:</span> <span class="nx">raw</span><span class="p">(</span><span class="s2">"'Jenni' || 'fer'"</span><span class="p">),</span>
    <span class="na">oldLastName</span><span class="p">:</span> <span class="nx">ref</span><span class="p">(</span><span class="s1">'lastName'</span><span class="p">),</span>
    <span class="c1">// This updates a value nested deep inside a</span>
    <span class="c1">// json column `detailsJsonColumn`.</span>
    <span class="s1">'detailsJsonColumn:address.street'</span><span class="p">:</span> <span class="s1">'Elm street'</span>
  <span class="p">});</span>
</code></pre>
<p>Creates a patch query.</p>

<p>The patch object is validated against the model&rsquo;s <a href="#jsonschema"><code class="prettyprint">jsonSchema</code></a> <em>but</em> the <code class="prettyprint">required</code> property
of the <a href="#jsonschema"><code class="prettyprint">jsonSchema</code></a> is ignored. This way the properties in the patch object are still validated
but an error isn&rsquo;t thrown if the patch object doesn&rsquo;t contain all required properties.</p>

<p>Values specified using field expressions and literals are not validated.</p>

<p>If validation fails the Promise is rejected with a <a href="#validationerror"><code class="prettyprint">ValidationError</code></a>.</p>

<p>NOTE: The return value of the query will be the number of affected rows. If you want to patch a single row and
retrieve the patched row as a result, you may want to use the <a href="#patchandfetchbyid"><code class="prettyprint">patchAndFetchById</code></a> method
or <em>take a look at <a href="#postgresql-quot-returning-quot-tricks">this recipe</a> if you&rsquo;re using Postgres</em>.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>modelOrObject</td>
<td>Object&#124;<a href="#model"><code class="prettyprint">Model</code></a></td>
<td>The patch object</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="patchandfetchbyid">patchAndFetchById</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">patchAndFetchById</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">modelOrObject</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">updatedModel</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">patchAndFetchById</span><span class="p">(</span><span class="mi">134</span><span class="p">,</span> <span class="p">{</span><span class="na">age</span><span class="p">:</span> <span class="mi">24</span><span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">updatedModel</span><span class="p">.</span><span class="nx">firstName</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>You can also give raw expressions and subqueries as values like this:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">raw</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>

<span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">patchAndFetchById</span><span class="p">(</span><span class="mi">134</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">age</span><span class="p">:</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">avg</span><span class="p">(</span><span class="s1">'age'</span><span class="p">),</span>
    <span class="na">firstName</span><span class="p">:</span> <span class="nx">raw</span><span class="p">(</span><span class="s2">"'Jenni' || 'fer'"</span><span class="p">)</span>
  <span class="p">});</span>
</code></pre>
<p>Patches a single model by id and fetches it from the database afterwards.</p>

<p>The patch object is validated against the model&rsquo;s <a href="#jsonschema"><code class="prettyprint">jsonSchema</code></a> <em>but</em> the <code class="prettyprint">required</code> property
of the <a href="#jsonschema"><code class="prettyprint">jsonSchema</code></a> is ignored. This way the properties in the patch object are still validated
but an error isn&rsquo;t thrown if the patch object doesn&rsquo;t contain all required properties.</p>

<p>If validation fails the Promise is rejected with a <a href="#validationerror"><code class="prettyprint">ValidationError</code></a>.</p>

<p>NOTE: On postgresql you can just chain <a href="#first"><code class="prettyprint">first()</code></a> and <a href="#returning"><code class="prettyprint">returning(&#39;*&#39;)</code></a> to the normal <a href="#patch"><code class="prettyprint">patch</code></a> method
to get the same result without an additional query. See <a href="#postgresql-quot-returning-quot-tricks">this recipe</a> for some examples.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>string&#124;number</td>
<td>Identifier of the model to update</td>
</tr>
<tr>
<td>modelOrObject</td>
<td>Object&#124;<a href="#model"><code class="prettyprint">Model</code></a></td>
<td>The patch object</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="patchandfetch">patchAndFetch</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">patchAndFetch</span><span class="p">(</span><span class="nx">modelOrObject</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">updatedModel</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">person</span>
  <span class="p">.</span><span class="nx">$query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">patchAndFetch</span><span class="p">({</span><span class="na">age</span><span class="p">:</span> <span class="mi">24</span><span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">updatedModel</span><span class="p">.</span><span class="nx">firstName</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>You can also give raw expressions and subqueries as values like this:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">raw</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>

<span class="nx">await</span> <span class="nx">person</span>
  <span class="p">.</span><span class="nx">$query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">patchAndFetch</span><span class="p">({</span>
    <span class="na">age</span><span class="p">:</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">avg</span><span class="p">(</span><span class="s1">'age'</span><span class="p">),</span>
    <span class="na">firstName</span><span class="p">:</span> <span class="nx">raw</span><span class="p">(</span><span class="s2">"'Jenni' || 'fer'"</span><span class="p">)</span>
  <span class="p">});</span>
</code></pre>
<p>Patches a single model and fetches it from the database afterwards. This only works with instance queries
started with <a href="#_s_query"><code class="prettyprint">$query()</code></a> method.</p>

<p>The patch object is validated against the model&rsquo;s <a href="#jsonschema"><code class="prettyprint">jsonSchema</code></a> <em>but</em> the <code class="prettyprint">required</code> property
of the <a href="#jsonschema"><code class="prettyprint">jsonSchema</code></a> is ignored. This way the properties in the patch object are still validated
but an error isn&rsquo;t thrown if the patch object doesn&rsquo;t contain all required properties.</p>

<p>If validation fails the Promise is rejected with a <a href="#validationerror"><code class="prettyprint">ValidationError</code></a>.</p>

<p>NOTE: On postgresql you can just chain <a href="#first"><code class="prettyprint">first()</code></a> and <a href="#returning"><code class="prettyprint">returning(&#39;*&#39;)</code></a> to the normal <a href="#patch"><code class="prettyprint">patch</code></a> method
to get the same result without an additional query. See <a href="#postgresql-quot-returning-quot-tricks">this recipe</a> for some examples.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>modelOrObject</td>
<td>Object&#124;<a href="#model"><code class="prettyprint">Model</code></a></td>
<td>The patch object</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="delete">delete</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="k">delete</span><span class="p">();</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">numberOfDeletedRows</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="k">delete</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'removed'</span><span class="p">,</span> <span class="nx">numberOfDeletedRows</span><span class="p">,</span> <span class="s1">'people'</span><span class="p">);</span>
</code></pre>
<p>Creates a delete query.</p>

<p>The return value of the query will be the number of deleted rows. if you&rsquo;re using Postgres
and want to get the deleted rows, <em>take a look at <a href="#postgresql-quot-returning-quot-tricks">this recipe</a></em>.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="deletebyid">deleteById</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">deleteById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">numberOfDeletedRows</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">deleteById</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'removed'</span><span class="p">,</span> <span class="nx">numberOfDeletedRows</span><span class="p">,</span> <span class="s1">'people'</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Composite key:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">numberOfDeletedRows</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">deleteById</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="s1">'20'</span><span class="p">,</span> <span class="mi">46</span><span class="p">]);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'removed'</span><span class="p">,</span> <span class="nx">numberOfDeletedRows</span><span class="p">,</span> <span class="s1">'people'</span><span class="p">);</span>
</code></pre>
<p>Deletes a model by id.</p>

<p>The return value of the query will be the number of deleted rows. if you&rsquo;re using Postgres
and want to get the deleted rows, <em>take a look at <a href="#postgresql-quot-returning-quot-tricks">this recipe</a></em>.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>any&#124;any[]</td>
<td></td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="relate">relate</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">relate</span><span class="p">(</span><span class="nx">ids</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="mi">123</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">numRelatedRows</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">person</span><span class="p">.</span><span class="nx">$relatedQuery</span><span class="p">(</span><span class="s1">'movies'</span><span class="p">).</span><span class="nx">relate</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'movie 50 is now related to person 123 through `movies` relation'</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Relate multiple (only works with postgres)</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">numRelatedRows</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">person</span>
  <span class="p">.</span><span class="nx">$relatedQuery</span><span class="p">(</span><span class="s1">'movies'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">relate</span><span class="p">([</span><span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">]);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">numRelatedRows</span><span class="p">}</span><span class="s2"> rows were related`</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Composite key</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">numRelatedRows</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">person</span>
  <span class="p">.</span><span class="nx">$relatedQuery</span><span class="p">(</span><span class="s1">'movies'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">relate</span><span class="p">({</span><span class="na">foo</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="na">bar</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="na">baz</span><span class="p">:</span> <span class="mi">10</span><span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">numRelatedRows</span><span class="p">}</span><span class="s2"> rows were related`</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Fields marked as <code class="prettyprint">extras</code> for many-to-many relations in <a href="#relationmappings"><code class="prettyprint">relationMappings</code></a> are automatically
written to the join table. The <code class="prettyprint">someExtra</code> field in the following example is written to the join table if the
<code class="prettyprint">extra</code> array of the relation mapping contains the string <code class="prettyprint">&#39;someExtra&#39;</code>.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">numRelatedRows</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">someMovie</span>
  <span class="p">.</span><span class="nx">$relatedQuery</span><span class="p">(</span><span class="s1">'actors'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">relate</span><span class="p">({</span>
    <span class="na">id</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="na">someExtra</span><span class="p">:</span> <span class="s2">"I'll be written to the join table"</span>
  <span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">numRelatedRows</span><span class="p">}</span><span class="s2"> rows were related`</span><span class="p">);</span>
</code></pre>
<p>Relates an existing model to another model.</p>

<p>This method doesn&rsquo;t create a new instance but only updates the foreign keys and in
the case of many-to-many relation, creates a join row to the join table.</p>

<p>On Postgres multiple models can be related by giving an array of identifiers.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>ids</td>
<td>number&#124;string&#124;Array&#124;Object</td>
<td>Identifier(s) of the model(s) to relate</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="unrelate">unrelate</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">unrelate</span><span class="p">();</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">numUnrelatedRows</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">person</span><span class="p">.</span><span class="nx">$relatedQuery</span><span class="p">(</span><span class="s1">'movies'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">unrelate</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'movie 50 is no longer related to person 123 through `movies` relation'</span><span class="p">);</span>
</code></pre>
<p>Removes a connection between two models.</p>

<p>Doesn&rsquo;t delete the models. Only removes the connection. For ManyToMany relations this
deletes the join column from the join table. For other relation types this sets the
join columns to null.</p>

<p>Note that, unlike for <code class="prettyprint">relate</code>, you shouldn&rsquo;t pass arguments for the <code class="prettyprint">unrelate</code> method.
Use <code class="prettyprint">unrelate</code> like <code class="prettyprint">delete</code> and filter the rows using the returned query builder.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="alias">alias</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="nx">alias</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s1">'p'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'p.id'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">'persons as parent'</span><span class="p">,</span> <span class="s1">'parent.id'</span><span class="p">,</span> <span class="s1">'p.parentId'</span><span class="p">)</span>
</code></pre>
<p>Give an alias for the table to be used in the query.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>alias</td>
<td>string</td>
<td>Table alias for the query.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="increment">increment</h4>

<p>See <a href="http://knexjs.org/#Builder-increment">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="decrement">decrement</h4>

<p>See <a href="http://knexjs.org/#Builder-decrement">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="select">select</h4>

<p>See <a href="http://knexjs.org/#Builder-select">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="forupdate">forUpdate</h4>

<p>See <a href="http://knexjs.org/#Builder-forUpdate">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="forshare">forShare</h4>

<p>See <a href="http://knexjs.org/#Builder-forShare">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="as">as</h4>

<p>See <a href="http://knexjs.org/#Builder-as">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="columns">columns</h4>

<p>See <a href="http://knexjs.org/#Builder-columns">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="column">column</h4>

<p>See <a href="http://knexjs.org/#Builder-column">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="from">from</h4>

<p>See <a href="http://knexjs.org/#Builder-from">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="fromjs">fromJS</h4>

<p>See <a href="http://knexjs.org/#Builder-fromJS">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="into">into</h4>

<p>See <a href="http://knexjs.org/#Builder-into">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="with">with</h4>

<p>See <a href="http://knexjs.org/#Builder-with">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="withschema">withSchema</h4>

<p>See <a href="http://knexjs.org/#Builder-withSchema">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="table">table</h4>

<p>See <a href="http://knexjs.org/#Builder-table">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="distinct">distinct</h4>

<p>See <a href="http://knexjs.org/#Builder-distinct">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="join">join</h4>

<p>See <a href="http://knexjs.org/#Builder-join">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="joinraw">joinRaw</h4>

<p>See <a href="http://knexjs.org/#Builder-joinRaw">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="innerjoin">innerJoin</h4>

<p>See <a href="http://knexjs.org/#Builder-innerJoin">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="leftjoin">leftJoin</h4>

<p>See <a href="http://knexjs.org/#Builder-leftJoin">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="leftouterjoin">leftOuterJoin</h4>

<p>See <a href="http://knexjs.org/#Builder-leftOuterJoin">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="rightjoin">rightJoin</h4>

<p>See <a href="http://knexjs.org/#Builder-rightJoin">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="rightouterjoin">rightOuterJoin</h4>

<p>See <a href="http://knexjs.org/#Builder-rightOuterJoin">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="outerjoin">outerJoin</h4>

<p>See <a href="http://knexjs.org/#Builder-outerJoin">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="fullouterjoin">fullOuterJoin</h4>

<p>See <a href="http://knexjs.org/#Builder-fullOuterJoin">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="crossjoin">crossJoin</h4>

<p>See <a href="http://knexjs.org/#Builder-crossJoin">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="joinrelation">joinRelation</h4>

<p>Joins a set of relations described by <code class="prettyprint">relationExpression</code>. See the examples for more info.</p>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">joinRelation</span><span class="p">(</span><span class="nx">relationExpression</span><span class="p">,</span> <span class="nx">opt</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Join one relation:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">joinRelation</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'pets.species'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Give an alias for a single relation:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">joinRelation</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">,</span> <span class="p">{</span><span class="na">alias</span><span class="p">:</span> <span class="s1">'p'</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'p.species'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Join two relations:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">joinRelation</span><span class="p">(</span><span class="s1">'[pets, parent]'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'pets.species'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'parent.name'</span><span class="p">,</span> <span class="s1">'Arnold'</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Join two multiple and nested relations. Note that when referring to nested relations
<code class="prettyprint">:</code> must be used as a separator instead of <code class="prettyprint">.</code>. This limitation comes from the way
knex parses table references.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">'persons.id'</span><span class="p">,</span> <span class="s1">'parent:parent.name as grandParentName'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">joinRelation</span><span class="p">(</span><span class="s1">'[pets, parent.[pets, parent]]'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'parent:pets.species'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Give aliases for a bunch of relations:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">'persons.id'</span><span class="p">,</span> <span class="s1">'pr:pr.name as grandParentName'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">joinRelation</span><span class="p">(</span><span class="s1">'[pets, parent.[pets, parent]]'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">aliases</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">parent</span><span class="p">:</span> <span class="s1">'pr'</span><span class="p">,</span>
      <span class="na">pets</span><span class="p">:</span> <span class="s1">'pt'</span>
    <span class="p">}</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'pr:pt.species'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">);</span>
</code></pre>
<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>relationExpression</td>
<td><a href="#relationexpression"><code class="prettyprint">RelationExpression</code></a></td>
<td>An expression describing which relations to join.</td>
</tr>
<tr>
<td>opt</td>
<td>object</td>
<td>Optional options. See the examples.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="innerjoinrelation">innerJoinRelation</h4>

<p>Alias for <a href="#joinrelation"><code class="prettyprint">joinRelation</code></a>.</p>

<h4 id="outerjoinrelation">outerJoinRelation</h4>

<p>Outer join version of the <a href="#joinrelation"><code class="prettyprint">joinRelation</code></a> method.</p>

<h4 id="leftjoinrelation">leftJoinRelation</h4>

<p>Left join version of the <a href="#joinrelation"><code class="prettyprint">joinRelation</code></a> method.</p>

<h4 id="leftouterjoinrelation">leftOuterJoinRelation</h4>

<p>Left outer join version of the <a href="#joinrelation"><code class="prettyprint">joinRelation</code></a> method.</p>

<h4 id="rightjoinrelation">rightJoinRelation</h4>

<p>Right join version of the <a href="#joinrelation"><code class="prettyprint">joinRelation</code></a> method.</p>

<h4 id="rightouterjoinrelation">rightOuterJoinRelation</h4>

<p>Left outer join version of the <a href="#joinrelation"><code class="prettyprint">joinRelation</code></a> method.</p>

<h4 id="fullouterjoinrelation">fullOuterJoinRelation</h4>

<p>Full outer join version of the <a href="#joinrelation"><code class="prettyprint">joinRelation</code></a> method.</p>

<h4 id="where">where</h4>

<p>See <a href="http://knexjs.org/#Builder-where">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="andwhere">andWhere</h4>

<p>See <a href="http://knexjs.org/#Builder-where">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orwhere">orWhere</h4>

<p>See <a href="http://knexjs.org/#Builder-where">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="wherenot">whereNot</h4>

<p>See <a href="http://knexjs.org/#Builder-where">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orwherenot">orWhereNot</h4>

<p>See <a href="http://knexjs.org/#Builder-where">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="whereraw">whereRaw</h4>

<p>See <a href="http://knexjs.org/#Builder-whereRaw">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="wherewrapped">whereWrapped</h4>

<p>See <a href="http://knexjs.org/#Builder-wheres">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="havingwrapped">havingWrapped</h4>

<p>See <a href="http://knexjs.org/#Builder-having">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orwhereraw">orWhereRaw</h4>

<p>See <a href="http://knexjs.org/#Builder-whereRaw">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="whereexists">whereExists</h4>

<p>See <a href="http://knexjs.org/#Builder-whereExists">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orwhereexists">orWhereExists</h4>

<p>See <a href="http://knexjs.org/#Builder-whereExists">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="wherenotexists">whereNotExists</h4>

<p>See <a href="http://knexjs.org/#Builder-whereNotExists">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orwherenotexists">orWhereNotExists</h4>

<p>See <a href="http://knexjs.org/#Builder-whereNotExists">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="wherein">whereIn</h4>

<p>See <a href="http://knexjs.org/#Builder-whereIn">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orwherein">orWhereIn</h4>

<p>See <a href="http://knexjs.org/#Builder-whereIn">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="wherenotin">whereNotIn</h4>

<p>See <a href="http://knexjs.org/#Builder-whereNotIn">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orwherenotin">orWhereNotIn</h4>

<p>See <a href="http://knexjs.org/#Builder-whereNotIn">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="wherenull">whereNull</h4>

<p>See <a href="http://knexjs.org/#Builder-whereNull">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orwherenull">orWhereNull</h4>

<p>See <a href="http://knexjs.org/#Builder-whereNull">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="wherenotnull">whereNotNull</h4>

<p>See <a href="http://knexjs.org/#Builder-whereNotNull">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orwherenotnull">orWhereNotNull</h4>

<p>See <a href="http://knexjs.org/#Builder-whereNotNull">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="wherebetween">whereBetween</h4>

<p>See <a href="http://knexjs.org/#Builder-whereBetween">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="wherenotbetween">whereNotBetween</h4>

<p>See <a href="http://knexjs.org/#Builder-whereNotBetween">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orwherebetween">orWhereBetween</h4>

<p>See <a href="http://knexjs.org/#Builder-whereBetween">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orwherenotbetween">orWhereNotBetween</h4>

<p>See <a href="http://knexjs.org/#Builder-whereNotBetween">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="groupby">groupBy</h4>

<p>See <a href="http://knexjs.org/#Builder-groupBy">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="groupbyraw">groupByRaw</h4>

<p>See <a href="http://knexjs.org/#Builder-groupByRaw">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orderby">orderBy</h4>

<p>See <a href="http://knexjs.org/#Builder-orderBy">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orderbyraw">orderByRaw</h4>

<p>See <a href="http://knexjs.org/#Builder-orderByRaw">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="union">union</h4>

<p>See <a href="http://knexjs.org/#Builder-union">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="unionall">unionAll</h4>

<p>See <a href="http://knexjs.org/#Builder-unionAll">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="having">having</h4>

<p>See <a href="http://knexjs.org/#Builder-having">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="havingraw">havingRaw</h4>

<p>See <a href="http://knexjs.org/#Builder-havingRaw">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orhaving">orHaving</h4>

<p>See <a href="http://knexjs.org/#Builder-having">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orhavingraw">orHavingRaw</h4>

<p>See <a href="http://knexjs.org/#Builder-havingRaw">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="offset">offset</h4>

<p>See <a href="http://knexjs.org/#Builder-offset">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="limit">limit</h4>

<p>See <a href="http://knexjs.org/#Builder-limit">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="count">count</h4>

<p>See <a href="http://knexjs.org/#Builder-count">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="countdistinct">countDistinct</h4>

<p>See <a href="http://knexjs.org/#Builder-count">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="min">min</h4>

<p>See <a href="http://knexjs.org/#Builder-min">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="max">max</h4>

<p>See <a href="http://knexjs.org/#Builder-max">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="sum">sum</h4>

<p>See <a href="http://knexjs.org/#Builder-sum">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="avg">avg</h4>

<p>See <a href="http://knexjs.org/#Builder-avg">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="avgdistinct">avgDistinct</h4>

<p>See <a href="http://knexjs.org/#Builder-avg">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="debug">debug</h4>

<p>See <a href="http://knexjs.org/#Builder-debug">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="returning">returning</h4>

<p>See <a href="http://knexjs.org/#Builder-returning">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="truncate">truncate</h4>

<p>See <a href="http://knexjs.org/#Builder-truncate">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="connection">connection</h4>

<p>See <a href="http://knexjs.org/#Builder-connection">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="modify">modify</h4>

<p>See <a href="http://knexjs.org/#Builder-modify">knex documentation</a></p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>fn</td>
<td>function&#124;string</td>
<td>The modify callback function, receiving the builder as its first argument, followed by the optional arguments. If a string is provided, the call is redirected to <a href="#applyfilter"><code class="prettyprint">applyFilter</code></a> instead.</td>
</tr>
<tr>
<td>*arguments</td>
<td></td>
<td>The optional arguments passed to the modify function</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="applyfilter">applyFilter</h4>

<p>Applies named filters to the query builder.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>filter</td>
<td>string</td>
<td>The name of the filter, as found in <a href="#namedfilters"><code class="prettyprint">namedFilters</code></a>.</td>
</tr>
<tr>
<td>*arguments</td>
<td></td>
<td>When providing multiple arguments, all provided named filters will be applied.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="columninfo">columnInfo</h4>

<p>See <a href="http://knexjs.org/#Builder-columnInfo">knex documentation</a></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="wherecomposite">whereComposite</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">whereComposite</span><span class="p">(</span><span class="nx">columns</span><span class="p">,</span> <span class="nx">operator</span><span class="p">,</span> <span class="nx">values</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">builder</span><span class="p">.</span><span class="nx">whereComposite</span><span class="p">([</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">],</span> <span class="s1">'='</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'Jennifer'</span><span class="p">]);</span>
</code></pre>
<blockquote>
<p>This method also works with a single column - value pair:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">builder</span><span class="p">.</span><span class="nx">whereComposite</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</code></pre>
<p><a href="#where"><code class="prettyprint">where</code></a> for (possibly) composite keys.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="whereincomposite">whereInComposite</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">whereInComposite</span><span class="p">(</span><span class="nx">columns</span><span class="p">,</span> <span class="nx">values</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">builder</span><span class="p">.</span><span class="nx">whereInComposite</span><span class="p">([</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">],</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]);</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">builder</span><span class="p">.</span><span class="nx">whereInComposite</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]]);</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">builder</span><span class="p">.</span><span class="nx">whereInComposite</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">builder</span><span class="p">.</span><span class="nx">whereInComposite</span><span class="p">([</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">],</span> <span class="nx">SomeModel</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">select</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">));</span>
</code></pre>
<p><a href="#wherein"><code class="prettyprint">whereIn</code></a> for (possibly) composite keys.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="wherejsonsupersetof">whereJsonSupersetOf</h4>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">whereJsonSupersetOf</span><span class="p">(</span><span class="nx">fieldExpression</span><span class="p">,</span> <span class="nx">jsonObjectOrFieldExpression</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">whereJsonSupersetOf</span><span class="p">(</span><span class="s1">'additionalData:myDogs'</span><span class="p">,</span> <span class="s1">'additionalData:dogsAtHome'</span><span class="p">);</span>

<span class="c1">// These people have all or some of their dogs at home. Person might have some</span>
<span class="c1">// additional dogs in their custody since myDogs is supreset of dogsAtHome.</span>

<span class="kr">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">whereJsonSupersetOf</span><span class="p">(</span><span class="s1">'additionalData:myDogs[0]'</span><span class="p">,</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="s2">"peter"</span><span class="p">});</span>

<span class="c1">// These people's first dog name is "peter", but the dog might have</span>
<span class="c1">// additional attributes as well.</span>
</code></pre>
<blockquote>
<p>Object and array are always their own supersets.</p>

<p>For arrays this means that left side matches if it has all the elements
listed in the right hand side. e.g.</p>
</blockquote>
<pre class="highlight plaintext"><code>[1,2,3] isSuperSetOf [2] =&gt; true
[1,2,3] isSuperSetOf [2,1,3] =&gt; true
[1,2,3] isSuperSetOf [2,null] =&gt; false
[1,2,3] isSuperSetOf [] =&gt; true
</code></pre>
<blockquote>
<p>The <code class="prettyprint">not</code> variants with jsonb operators behave in a way that they won&rsquo;t match rows, which don&rsquo;t have
the referred json key referred in field expression. e.g. for table</p>
</blockquote>
<pre class="highlight plaintext"><code> id |    jsonObject
----+--------------------------
  1 | {}
  2 | NULL
  3 | {"a": 1}
  4 | {"a": 1, "b": 2}
  5 | {"a": ['3'], "b": ['3']}
</code></pre>
<blockquote>
<p>query:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">builder</span><span class="p">.</span><span class="nx">whereJsonNotEquals</span><span class="p">(</span><span class="s2">"jsonObject:a"</span><span class="p">,</span> <span class="s2">"jsonObject:b"</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>Returns only the row <code class="prettyprint">4</code> which has keys <code class="prettyprint">a</code> and <code class="prettyprint">b</code> and <code class="prettyprint">a</code> != <code class="prettyprint">b</code>, but it won&rsquo;t return any rows which
does not have <code class="prettyprint">jsonObject.a</code> or <code class="prettyprint">jsonObject.b</code>.</p>
</blockquote>

<p>Where left hand json field reference is a superset of the right hand json value or reference.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>fieldExpression</td>
<td><a href="#fieldexpression"><code class="prettyprint">FieldExpression</code></a></td>
<td>Reference to column / json field, which is tested for being a superset</td>
</tr>
<tr>
<td>jsonObjectOrFieldExpression</td>
<td>Object&#124;Array&#124;<a href="#fieldexpression"><code class="prettyprint">FieldExpression</code></a></td>
<td>To which to compare</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orwherejsonsupersetof">orWhereJsonSupersetOf</h4>

<p>See <a href="#wherejsonsupersetof"><code class="prettyprint">whereJsonSupersetOf</code></a></p>

<h4 id="wherejsonnotsupersetof">whereJsonNotSupersetOf</h4>

<p>See <a href="#wherejsonsupersetof"><code class="prettyprint">whereJsonSupersetOf</code></a></p>

<h4 id="orwherejsonnotsupersetof">orWhereJsonNotSupersetOf</h4>

<p>See <a href="#wherejsonsupersetof"><code class="prettyprint">whereJsonSupersetOf</code></a></p>

<h4 id="wherejsonsubsetof">whereJsonSubsetOf</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">whereJsonSubsetOf</span><span class="p">(</span><span class="nx">fieldExpression</span><span class="p">,</span> <span class="nx">jsonObjectOrFieldExpression</span><span class="p">);</span>
</code></pre>
<p>Where left hand json field reference is a subset of the right hand json value or reference.</p>

<p>Object and array are always their own subsets.</p>

<p>See <a href="#wherejsonsupersetof"><code class="prettyprint">whereJsonSupersetOf</code></a></p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>fieldExpression</td>
<td><a href="#fieldexpression"><code class="prettyprint">FieldExpression</code></a></td>
<td>Reference to column / json field, which is tested for being a superset</td>
</tr>
<tr>
<td>jsonObjectOrFieldExpression</td>
<td>Object&#124;Array&#124;<a href="#fieldexpression"><code class="prettyprint">FieldExpression</code></a></td>
<td>To which to compare</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orwherejsonsubsetof">orWhereJsonSubsetOf</h4>

<p>See <a href="#wherejsonsubsetof"><code class="prettyprint">whereJsonSubsetOf</code></a></p>

<h4 id="wherejsonnotsubsetof">whereJsonNotSubsetOf</h4>

<p>See <a href="#wherejsonsubsetof"><code class="prettyprint">whereJsonSubsetOf</code></a></p>

<h4 id="orwherejsonnotsubsetof">orWhereJsonNotSubsetOf</h4>

<p>See <a href="#wherejsonsubsetof"><code class="prettyprint">whereJsonSubsetOf</code></a></p>

<h4 id="wherejsonisarray">whereJsonIsArray</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">whereJsonIsArray</span><span class="p">(</span><span class="nx">fieldExpression</span><span class="p">);</span>
</code></pre>
<p>Where json field reference is an array.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>fieldExpression</td>
<td><a href="#fieldexpression"><code class="prettyprint">FieldExpression</code></a></td>
<td></td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orwherejsonisarray">orWhereJsonIsArray</h4>

<p>See <a href="#wherejsonisarray"><code class="prettyprint">whereJsonIsArray</code></a></p>

<h4 id="wherejsonnotarray">whereJsonNotArray</h4>

<p>See <a href="#wherejsonisarray"><code class="prettyprint">whereJsonIsArray</code></a></p>

<h4 id="orwherejsonnotarray">orWhereJsonNotArray</h4>

<p>See <a href="#wherejsonisarray"><code class="prettyprint">whereJsonIsArray</code></a></p>

<h4 id="wherejsonisobject">whereJsonIsObject</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">whereJsonIsObject</span><span class="p">(</span><span class="nx">fieldExpression</span><span class="p">);</span>
</code></pre>
<p>Where json field reference is an object.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>fieldExpression</td>
<td><a href="#fieldexpression"><code class="prettyprint">FieldExpression</code></a></td>
<td></td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orwherejsonisobject">orWhereJsonIsObject</h4>

<p>See <a href="#wherejsonisobject"><code class="prettyprint">whereJsonIsObject</code></a></p>

<h4 id="wherejsonnotobject">whereJsonNotObject</h4>

<p>See <a href="#wherejsonisobject"><code class="prettyprint">whereJsonIsObject</code></a></p>

<h4 id="orwherejsonnotobject">orWhereJsonNotObject</h4>

<p>See <a href="#wherejsonisobject"><code class="prettyprint">whereJsonIsObject</code></a></p>

<h4 id="wherejsonhasany">whereJsonHasAny</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">whereJsonHasAny</span><span class="p">(</span><span class="nx">fieldExpression</span><span class="p">,</span> <span class="nx">keys</span><span class="p">);</span>
</code></pre>
<p>Where any of given strings is found from json object key(s) or array items.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>fieldExpression</td>
<td><a href="#fieldexpression"><code class="prettyprint">FieldExpression</code></a></td>
<td></td>
</tr>
<tr>
<td>keys</td>
<td>string&#124;string[]</td>
<td>Strings that are looked from object or array</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orwherejsonhasany">orWhereJsonHasAny</h4>

<p>See <a href="#wherejsonhasany"><code class="prettyprint">whereJsonHasAny</code></a></p>

<h4 id="wherejsonhasall">whereJsonHasAll</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">whereJsonHasAll</span><span class="p">(</span><span class="nx">fieldExpression</span><span class="p">,</span> <span class="nx">keys</span><span class="p">);</span>
</code></pre>
<p>Where all of given strings are found from json object key(s) or array items.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>fieldExpression</td>
<td><a href="#fieldexpression"><code class="prettyprint">FieldExpression</code></a></td>
<td></td>
</tr>
<tr>
<td>keys</td>
<td>string&#124;string[]</td>
<td>Strings that are looked from object or array</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="orwherejsonhasall">orWhereJsonHasAll</h4>

<p>See <a href="#wherejsonhasall"><code class="prettyprint">whereJsonHasAll</code></a></p>

<h3 id="other-instance-methods">Other instance methods</h3>

<h4 id="context">context</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">context</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>You can set the context like this:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">context</span><span class="p">({</span><span class="na">something</span><span class="p">:</span> <span class="s1">'hello'</span><span class="p">});</span>
</code></pre>
<blockquote>
<p>and access the context like this:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">context</span><span class="p">();</span>
</code></pre>
<blockquote>
<p>You can set any data to the context object. You can also register QueryBuilder lifecycle methods
for <em>all</em> queries that share the context:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">context</span><span class="p">({</span>
    <span class="na">runBefore</span><span class="p">:</span> <span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">builder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="na">runAfter</span><span class="p">:</span> <span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">builder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="na">onBuild</span><span class="p">:</span> <span class="nx">builder</span> <span class="o">=&gt;</span> <span class="p">{}</span>
  <span class="p">});</span>
</code></pre>
<blockquote>
<p>For example the <code class="prettyprint">eager</code> method causes multiple queries to be executed from a single query builder.
If you wanted to make all of them use the same schema you could write this:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'[movies, children.movies]'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">context</span><span class="p">({</span>
    <span class="na">onBuild</span><span class="p">:</span> <span class="nx">builder</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">builder</span><span class="p">.</span><span class="nx">withSchema</span><span class="p">(</span><span class="s1">'someSchema'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
</code></pre>
<p>Sets/gets the query context.</p>

<p>Some query builder methods create more than one query. The query context is an object that is
shared with all queries started by a query builder.</p>

<p>The context is also passed to <a href="#_s_beforeinsert"><code class="prettyprint">$beforeInsert</code></a>, <a href="#_s_afterinsert"><code class="prettyprint">$afterInsert</code></a>,
<a href="#_s_beforeupdate"><code class="prettyprint">$beforeUpdate</code></a>, <a href="#_s_afterupdate"><code class="prettyprint">$afterUpdate</code></a>, <a href="#_s_beforeidelete"><code class="prettyprint">$beforeDelete</code></a>,
<a href="#_s_afterdelete"><code class="prettyprint">$afterDelete</code></a> and <a href="#_s_afterget"><code class="prettyprint">$afterGet</code></a> calls that the query creates.</p>

<p>In addition to properties added using this method (and <a href="#mergecontext"><code class="prettyprint">mergeContext</code></a>) the query context
object always has a <code class="prettyprint">transaction</code> property that holds the active transaction. If there is no active transaction
the <code class="prettyprint">transaction</code> property contains the normal knex instance. In both cases the value can be passed anywhere
where a transaction object can be passed so you never need to check for the existence of the <code class="prettyprint">transaction</code>
property.</p>

<p>See the methods <a href="#runbefore"><code class="prettyprint">runBefore</code></a>, <a href="#onbuild"><code class="prettyprint">onBuild</code></a> and <a href="#runafter"><code class="prettyprint">runAfter</code></a>
for more information about the hooks.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>queryContext</td>
<td>Object</td>
<td>The query context object</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="mergecontext">mergeContext</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">mergeContext</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">);</span>
</code></pre>
<p>Merges values into the query context.</p>

<p>This method is like <a href="#context"><code class="prettyprint">context</code></a> but instead of replacing the whole context
this method merges the objects.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>queryContext</td>
<td>Object</td>
<td>The object to merge into the query context.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="tablenamefor">tableNameFor</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">tableName</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">tableNameFor</span><span class="p">(</span><span class="nx">modelClass</span><span class="p">);</span>
</code></pre>
<p>Returns the table name for a given model class for the query. Usually the table name can be fetched
through <code class="prettyprint">Model.tableName</code> but if the source table has been changed for example using the <a href="#table"><code class="prettyprint">QueryBuilder#table</code></a>
method <code class="prettyprint">tableNameFor</code> will return the correct value.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>modelClass</td>
<td>function</td>
<td>A model class.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>string</td>
<td>The source table (or view) name for <code class="prettyprint">modelClass</code>.</td>
</tr>
</tbody></table>

<h4 id="tablereffor">tableRefFor</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">tableRef</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">tableRefFor</span><span class="p">(</span><span class="nx">modelClass</span><span class="p">);</span>
</code></pre>
<p>Returns the name that should be used to refer to the <code class="prettyprint">modelClass</code>&rsquo;s table in the query.
Usually a table can be referred to using its name, but <code class="prettyprint">tableRefFor</code> can return a different
value for example in case an alias has been given.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>modelClass</td>
<td>function</td>
<td>A model class.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>string</td>
<td>The name that should be used to refer to a table in the query.</td>
</tr>
</tbody></table>

<h4 id="reject">reject</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">reason</span><span class="p">);</span>
</code></pre>
<p>Skips the database query and &ldquo;fakes&rdquo; an error result.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>reson</td>
<td></td>
<td>The rejection reason</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="resolve">resolve</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</code></pre>
<p>Skips the database query and &ldquo;fakes&rdquo; a result.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>value</td>
<td></td>
<td>The resolve value</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="isexecutable">isExecutable</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">executable</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">isExecutable</span><span class="p">();</span>
</code></pre>
<p>Returns false if this query will never be executed.</p>

<p>This may be true in multiple cases:</p>

<ol>
<li>The query is explicitly resolved or rejected using the <a href="#resolve"><code class="prettyprint">resolve</code></a> or <a href="#reject"><code class="prettyprint">reject</code></a> methods.</li>
<li>The query starts a different query when it is executed.</li>
</ol>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>boolean</td>
<td>false if the query will never be executed.</td>
</tr>
</tbody></table>

<h4 id="isfind">isFind</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">isFind</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">isFind</span><span class="p">();</span>
</code></pre>
<p>Returns true if the query is read-only.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>boolean</td>
<td>true if the query is read-only.</td>
</tr>
</tbody></table>

<h4 id="isinsert">isInsert</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">isInsert</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">isInsert</span><span class="p">();</span>
</code></pre>
<p>Returns true if the query performs an insert operation.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>boolean</td>
<td>true if the query performs an insert operation.</td>
</tr>
</tbody></table>

<h4 id="isupdate">isUpdate</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">isUpdate</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">isUpdate</span><span class="p">();</span>
</code></pre>
<p>Returns true if the query performs an update operation.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>boolean</td>
<td>true if the query performs an update operation.</td>
</tr>
</tbody></table>

<h4 id="isdelete">isDelete</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">isDelete</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">isDelete</span><span class="p">();</span>
</code></pre>
<p>Returns true if the query performs a delete operation.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>boolean</td>
<td>true if the query performs a delete operation.</td>
</tr>
</tbody></table>

<h4 id="isrelate">isRelate</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">isRelate</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">isRelate</span><span class="p">();</span>
</code></pre>
<p>Returns true if the query performs a relate operation.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>boolean</td>
<td>true if the query performs a relate operation.</td>
</tr>
</tbody></table>

<h4 id="isunrelate">isUnrelate</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">isUnrelate</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">isUnrelate</span><span class="p">();</span>
</code></pre>
<p>Returns true if the query performs an unrelate operation.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>boolean</td>
<td>true if the query performs an unrelate operation.</td>
</tr>
</tbody></table>

<h4 id="haswheres">hasWheres</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">hasWheres</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">hasWheres</span><span class="p">();</span>
</code></pre>
<p>Returns true if the query contains where statements.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>boolean</td>
<td>true if the query contains where statements.</td>
</tr>
</tbody></table>

<h4 id="hasselects">hasSelects</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">hasSelects</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">hasSelects</span><span class="p">();</span>
</code></pre>
<p>Returns true if the query contains any specific select staments, such as:
<code class="prettyprint">&#39;select&#39;</code>, <code class="prettyprint">&#39;columns&#39;</code>, <code class="prettyprint">&#39;column&#39;</code>, <code class="prettyprint">&#39;distinct&#39;</code>, <code class="prettyprint">&#39;count&#39;</code>, <code class="prettyprint">&#39;countDistinct&#39;</code>, <code class="prettyprint">&#39;min&#39;</code>, <code class="prettyprint">&#39;max&#39;</code>, <code class="prettyprint">&#39;sum&#39;</code>, <code class="prettyprint">&#39;sumDistinct&#39;</code>, <code class="prettyprint">&#39;avg&#39;</code>, <code class="prettyprint">&#39;avgDistinct&#39;</code></p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>boolean</td>
<td>true if the query contains any specific select staments.</td>
</tr>
</tbody></table>

<h4 id="haseager">hasEager</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">hasEager</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">hasEager</span><span class="p">();</span>
</code></pre>
<p>Returns true if the query defines any eager expressions.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>boolean</td>
<td>true if the query defines any eager expressions.</td>
</tr>
</tbody></table>

<h4 id="has">has</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">has</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">).</span><span class="nx">has</span><span class="p">(</span><span class="s1">'range'</span><span class="p">));</span>
</code></pre>
<p>Returns true if the query defines an operation that matches the given selector.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>selector</td>
<td>string&#124;regexp</td>
<td>A name or regular expression to match all defined operations against.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>boolean</td>
<td>true if the query defines an operation that matches the given selector.</td>
</tr>
</tbody></table>

<h4 id="clear">clear</h4>
<pre class="highlight javascript"><code><span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">clear</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">'firstName'</span><span class="p">).</span><span class="nx">clear</span><span class="p">(</span><span class="s1">'orderBy'</span><span class="p">).</span><span class="nx">has</span><span class="p">(</span><span class="s1">'orderBy'</span><span class="p">));</span>
</code></pre>
<p>Removes all operations in the query that match the given selector.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>selector</td>
<td>string&#124;regexp</td>
<td>A name or regular expression to match all operations that are to be removed against.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="runbefore">runBefore</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">runBefore</span><span class="p">(</span><span class="nx">runBefore</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">();</span>

<span class="nx">query</span>
  <span class="p">.</span><span class="nx">runBefore</span><span class="p">(</span><span class="nx">async</span> <span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello 1'</span><span class="p">);</span>

    <span class="nx">await</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello 2'</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">result</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">runBefore</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello 3'</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">result</span>
  <span class="p">});</span>

<span class="nx">await</span> <span class="nx">query</span><span class="p">;</span>
<span class="c1">// --&gt; hello 1</span>
<span class="c1">// --&gt; hello 2</span>
<span class="c1">// --&gt; hello 3</span>
</code></pre>
<p>Registers a function to be called before the database query when the builder is executed. Multiple functions can be
chained like <a href="#then"><code class="prettyprint">then</code></a> methods of a promise.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>runBefore</td>
<td>function(result, <a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a>)</td>
<td>The function to be executed. This function can be async. Note that it needs to return the result used for further processing in the chain of calls.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="onbuild">onBuild</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">onBuild</span><span class="p">(</span><span class="nx">onBuild</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">();</span>

<span class="nx">query</span>
 <span class="p">.</span><span class="nx">onBuild</span><span class="p">(</span><span class="nx">builder</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="nx">builder</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="p">})</span>
 <span class="p">.</span><span class="nx">onBuild</span><span class="p">(</span><span class="nx">builder</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="nx">builder</span><span class="p">.</span><span class="nx">orWhere</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
 <span class="p">});</span>
</code></pre>
<p>Functions registered with this method are called each time the query is built into an SQL string. This method is ran
after <a href="#runbefore"><code class="prettyprint">runBefore</code></a> methods but before <a href="#runafter"><code class="prettyprint">runAfter</code></a> methods.</p>

<p>If you need to modify the SQL query at query build time, this is the place to do it. You shouldn&rsquo;t
modify the query in any of the <code class="prettyprint">run</code> methods.</p>

<p>Unlike the <code class="prettyprint">run</code> methods (<code class="prettyprint">runAfter</code>, <code class="prettyprint">runBefore</code> etc.) these must be synchronous. Also you should not register any <code class="prettyprint">run</code> methods
from these. You should <em>only</em> call the query building methods of the builder provided as a parameter.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>onBuild</td>
<td>function(<a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a>)</td>
<td>The function to be executed.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="onbuildknex">onBuildKnex</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">onBuildKnex</span><span class="p">(</span><span class="nx">onBuildKnex</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">();</span>

<span class="nx">query</span>
 <span class="p">.</span><span class="nx">onBuildKnex</span><span class="p">((</span><span class="nx">knexBuilder</span><span class="p">,</span> <span class="nx">objectionBuilder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="nx">knexBuilder</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="p">});</span>
</code></pre>
<p>Functions registered with this method are called each time the query is built into an SQL string. This method is ran
after <a href="#onbuild"><code class="prettyprint">onBuild</code></a> methods but before <a href="#runafter"><code class="prettyprint">runAfter</code></a> methods.</p>

<p>If you need to modify the SQL query at query build time, this is the place to do it in addition to <code class="prettyprint">onBuild</code>. The only
difference between <code class="prettyprint">onBuildKnex</code> and <code class="prettyprint">onBuild</code> is that in <code class="prettyprint">onBuild</code> you can modify the objection&rsquo;s query builder. In
<code class="prettyprint">onBuildKnex</code> the objection builder has been compiled into a knex query builder and any modifications to the objection
builder will be ignored.</p>

<p>Unlike the <code class="prettyprint">run</code>  methods (<code class="prettyprint">runAfter</code>, <code class="prettyprint">runBefore</code> etc.) these must be synchronous. Also you should not register any <code class="prettyprint">run</code> methods
from these. You should <em>only</em> call the query building methods of the <strong>knexBuilder</strong> provided as a parameter.</p>

<p>WARNING: You should never call any query building (or any other mutating) method on the <code class="prettyprint">objectionBuilder</code> in
         this function. If you do, those calls will get ignored. At this point the query builder has been
         compiled into a knex query builder and you should only modify that. You can call non mutating methods
         like <code class="prettyprint">hasSelects</code>, <code class="prettyprint">hasWheres</code> etc. on the objection builder.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>onBuildKnex</td>
<td>function(<code class="prettyprint">KnexQueryBuilder</code>, <a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a>)</td>
<td>The function to be executed.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="runafter">runAfter</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">runAfter</span><span class="p">(</span><span class="nx">runAfter</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">();</span>

<span class="nx">query</span>
 <span class="p">.</span><span class="nx">runAfter</span><span class="p">(</span><span class="nx">async</span> <span class="p">(</span><span class="nx">models</span><span class="p">,</span> <span class="nx">queryBuilder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nx">models</span><span class="p">;</span>
 <span class="p">})</span>
 <span class="p">.</span><span class="nx">runAfter</span><span class="p">(</span><span class="nx">async</span> <span class="p">(</span><span class="nx">models</span><span class="p">,</span> <span class="nx">queryBuilder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="nx">models</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">Person</span><span class="p">.</span><span class="nx">fromJson</span><span class="p">({</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">}));</span>
   <span class="k">return</span> <span class="nx">models</span><span class="p">;</span>
 <span class="p">});</span>

<span class="kr">const</span> <span class="nx">models</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">query</span><span class="p">;</span>
</code></pre>
<p>Registers a function to be called when the builder is executed.</p>

<p>These functions are executed as the last thing before any promise handlers
registered using the <a href="#then"><code class="prettyprint">then</code></a> method. Multiple functions can be chained like
<a href="#then"><code class="prettyprint">then</code></a>  methods of a promise.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>runAfter</td>
<td>function(result, <a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a>)</td>
<td>The function to be executed. This function can be async. Note that it needs to return the result used for further processing in the chain of calls.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="onerror">onError</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">onError</span><span class="p">(</span><span class="nx">onError</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">();</span>

<span class="nx">query</span>
 <span class="p">.</span><span class="nx">onError</span><span class="p">(</span><span class="nx">async</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">queryBuilder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="c1">// Handle `SomeError` but let other errors go through.</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">error</span> <span class="k">instanceof</span> <span class="nx">SomeError</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// This will cause the query to be resolved with an object</span>
     <span class="c1">// instead of throwing an error.</span>
     <span class="k">return</span> <span class="p">{</span><span class="na">error</span><span class="p">:</span> <span class="s1">'some error occurred'</span><span class="p">};</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="k">return</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
   <span class="p">}</span>
 <span class="p">})</span>
 <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">,</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">);</span>
</code></pre>
<p>Registers an error handler. Just like <code class="prettyprint">catch</code> but doesn&rsquo;t execute the query.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>onError</td>
<td>function(Error, <a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a>)</td>
<td>The function to be executed on error.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="eageralgorithm">eagerAlgorithm</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">eagerAlgorithm</span><span class="p">(</span><span class="nx">algo</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eagerAlgorithm</span><span class="p">(</span><span class="nx">Person</span><span class="p">.</span><span class="nx">JoinEagerAlgorithm</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'[pets, children]'</span><span class="p">)</span>
</code></pre>
<p>Select the eager loading algorithm for the query. See comparison between
the available algorithms <a href="#eager">here</a>.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>algo</td>
<td>EagerAlgorithm</td>
<td>The eager loading algorithm to use. One of <code class="prettyprint">Model.JoinEagerAlgorithm</code>, <code class="prettyprint">Model.WhereInEagerAlgorithm</code> and <code class="prettyprint">Model.NaiveEagerAlgorithm</code>.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="eageroptions-method">eagerOptions</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">eagerOptions</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eagerOptions</span><span class="p">({</span><span class="na">joinOperation</span><span class="p">:</span> <span class="s1">'innerJoin'</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'[pets, children]'</span><span class="p">)</span>
</code></pre>
<p>Sets <a href="#eageroptions">options</a> for the eager query.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>options</td>
<td><a href="#eageroptions"><code class="prettyprint">EagerOptions</code></a></td>
<td>Options to set.s</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="eager">eager</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="nx">relationExpression</span><span class="p">,</span> <span class="nx">filters</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="c1">// Fetch `children` relation for each result Person and `pets` and `movies`</span>
<span class="c1">// relations for all the children.</span>
<span class="kr">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'children.[pets, movies]'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">pets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">name</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">movies</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Relations can be filtered by giving named filter functions as arguments
to the relations:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'children(orderByAge).[pets(onlyDogs, orderByName), movies]'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">orderByAge</span><span class="p">:</span> <span class="p">(</span><span class="nx">builder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">builder</span><span class="p">.</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">'age'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">orderByName</span><span class="p">:</span> <span class="p">(</span><span class="nx">builder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">builder</span><span class="p">.</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">onlyDogs</span><span class="p">:</span> <span class="p">(</span><span class="nx">builder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">builder</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'species'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">pets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">name</span><span class="p">);</span>
<span class="nx">cconsole</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">movies</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Reusable named filters can be defined for a model class using <a href="#namedfilters"><code class="prettyprint">namedFilters</code></a></p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">namedFilters</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">orderByAge</span><span class="p">:</span> <span class="p">(</span><span class="nx">builder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">builder</span><span class="p">.</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">'age'</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Animal</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">namedFilters</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">orderByName</span><span class="p">:</span> <span class="p">(</span><span class="nx">builder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">builder</span><span class="p">.</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="na">onlyDogs</span><span class="p">:</span> <span class="p">(</span><span class="nx">builder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">builder</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'species'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'children(orderByAge).[pets(onlyDogs, orderByName), movies]'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">pets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">name</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">movies</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Filters can also be registered using the <a href="#modifyeager"><code class="prettyprint">modifyEager</code></a> method:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'children.[pets, movies]'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">modifyEager</span><span class="p">(</span><span class="s1">'children'</span><span class="p">,</span> <span class="nx">builder</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Order children by age.</span>
    <span class="nx">builder</span><span class="p">.</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">'age'</span><span class="p">);</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">modifyEager</span><span class="p">(</span><span class="s1">'children.[pets, movies]'</span><span class="p">,</span> <span class="nx">builder</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Only select `pets` and `movies` whose id &gt; 10 for the children.</span>
    <span class="nx">builder</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">modifyEager</span><span class="p">(</span><span class="s1">'children.movies]'</span><span class="p">,</span> <span class="nx">builder</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Only select 100 first movies for the children.</span>
    <span class="nx">builder</span><span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
  <span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">pets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">name</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">movies</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Relations can be given aliases using the <code class="prettyprint">as</code> keyword:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s2">`[
    children(orderByAge) as kids .[
      pets(filterDogs) as dogs,
      pets(filterCats) as cats

      movies.[
        actors
      ]
    ]
  ]`</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">kids</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">dogs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">name</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">kids</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">movies</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>The eager queries are optimized to avoid the N + 1 query problem. Consider this query:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'children.children'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// --&gt; 10</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">children</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// --&gt; 10</span>
</code></pre>
<blockquote>
<p>The person has 10 children and they all have 10 children. The query above will
return 100 database rows but will generate only three database queries when using
<code class="prettyprint">WhereInEagerAlgorithm</code> and only one query when using <code class="prettyprint">JoinEagerAlgorithm</code>.</p>

<p>The loading algorithm can be changed using the <a href="#eageralgorithm"><code class="prettyprint">eagerAlgorithm</code></a> method:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">eagerAlgorithm</span><span class="p">(</span><span class="nx">Person</span><span class="p">.</span><span class="nx">JoinEagerAlgorithm</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'[movies, children.pets]'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'movies.name'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'%terminator%'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'children:pets.species'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">);</span>
</code></pre>
<p>Fetch relations eagerly for the result rows.</p>

<p>See the <a href="#eager-queries">eager queries</a> section for more examples and <a href="#relationexpression"><code class="prettyprint">RelationExpression</code></a>
for more info on the relation expression language.</p>

<p>You can choose the way objection performs the eager loading by using <a href="#eageralgorithm"><code class="prettyprint">eagerAlgorithm</code></a> method
on a query builder or by setting the <a href="#defaulteageralgorithm"><code class="prettyprint">defaultEagerAlgorithm</code></a> property of a model. The
three algorithms currently available are <code class="prettyprint">Model.WhereInEagerAlgorithm</code> (the default) <code class="prettyprint">Model.JoinEagerAlgorithm</code>
and <code class="prettyprint">Model.NaiveEagerAlgorithm</code>. All three have their strengths and weaknesses. We will go through the main
differences below. You can always see the executed SQL by calling the <a href="#debug"><code class="prettyprint">debug</code></a> method for the query builder.</p>

<p><b>WhereInEagerAlgorithm</b></p>

<p>This algorithm uses multiple queries to fetch the related objects. Objection performs one query per level
in the eager tree. For example only two additional queries will be created for eager expression <code class="prettyprint">children.children</code>
no matter how many children the model has or how many children each of the children have. This algorithm is explained
in detail in <a href="https://www.vincit.fi/en/blog/nested-eager-loading-and-inserts-with-objection-js/">this blog post</a>.</p>

<p>Limitations:</p>

<ul>
<li>Relations cannot be referred in the query because they are not joined.</li>
<li><code class="prettyprint">limit</code> and <code class="prettyprint">page</code> methods will work incorrectly when applied to a relation using <code class="prettyprint">modifyEager</code>,
because they will be applied on a query that fetches relations for multiple parents. You can use
<code class="prettyprint">limit</code> and <code class="prettyprint">page</code> for the root query.</li>
</ul>

<p><b>JoinEagerAlgorithm</b></p>

<p>This algorithm uses joins to fetch the whole eager tree using one single query. This allows you to reference the relations
in the root query (see the last example). The related tables can be referred using the relation name. Nested relations
must be separated by <code class="prettyprint">:</code> character (dot is not used because of the way knex parses identifiers).</p>

<p>When this algorithm is used, information schema queries are executed to get table column names. They are done only once for each table during the lifetime of the process and then cached.</p>

<p>Limitations:</p>

<ul>
<li><code class="prettyprint">limit</code> and <code class="prettyprint">page</code> methods will work incorrectly because they will limit the result set that contains all the result
rows in a flattened format. For example the result set of the eager expression <code class="prettyprint">children.children</code> will have
<code class="prettyprint">10 * 10 * 10</code> rows assuming the you fetched 10 models that all had 10 children that all had 10 children.</li>
</ul>

<p><b>NaiveEagerAlgorithm</b></p>

<p>This algorithm naively fetches the relations using a separate query for each model. For example relation expression
<code class="prettyprint">children.children</code> will cause 111 queries to be performed assuming a result set of 10 each having 10 children each
having 10 children. For small result sets this doesn&rsquo;t matter. The clear benefit of this algorithm is that there are
no limitations. You can use <code class="prettyprint">offset</code>, <code class="prettyprint">limit</code>, <code class="prettyprint">min</code>, <code class="prettyprint">max</code> etc. in <code class="prettyprint">modifyEager</code>. You can for example fetch only the
youngest child for each parent.</p>

<p><b>Performance differences</b></p>

<p><code class="prettyprint">WhereInEagerAlgorithm</code> performs more queries than <code class="prettyprint">JoinEagerAlgorithm</code> which can cause a significant delay especially if
the round trip time to the database server is significant. On the other hand the result from <code class="prettyprint">WhereInEagerAlgorithm</code> is
trivial to parse into a tree structure while the result of <code class="prettyprint">JoinEagerAlgorithm</code> needs some complex parsing which
can lead to a significant performance decrease. Which method is faster depends heavily on the query and the environment.
You should select the algorithm that makes your code cleaner and only consider performance if you have an actual measured
real-life problem. Don&rsquo;t optimize prematurely! <code class="prettyprint">NaiveEagerAlgorithm</code> is by far the slowest. It should only be used for
cases where performance doesn&rsquo;t matter and when it is the only option to get the job done.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>relationExpression</td>
<td>string&#124;<a href="#relationexpression"><code class="prettyprint">RelationExpression</code></a></td>
<td>The eager expression</td>
</tr>
<tr>
<td>filters</td>
<td>Object&lt;string, function(<a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a>)&gt;</td>
<td>The named filter functions for the expression</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="joineager">joinEager</h4>

<p>Shorthand for <code class="prettyprint">eagerAlgorithm(Model.JoinEagerAlgorithm).eager(expr)</code>.</p>

<h4 id="naiveeager">naiveEager</h4>

<p>Shorthand for <code class="prettyprint">eagerAlgorithm(Model.NaiveEagerAlgorithm).eager(expr)</code>.</p>

<h4 id="mergeeager">mergeEager</h4>

<blockquote>
<p>The following queries are equivalent</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'[children.pets, movies]'</span><span class="p">)</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'children'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">mergeEager</span><span class="p">(</span><span class="s1">'children.pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">mergeEager</span><span class="p">(</span><span class="s1">'movies'</span><span class="p">)</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'children.pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">mergeEager</span><span class="p">(</span><span class="s1">'movies'</span><span class="p">)</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">mergeEager</span><span class="p">(</span><span class="s1">'children.pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">mergeEager</span><span class="p">(</span><span class="s1">'movies'</span><span class="p">)</span>
</code></pre>
<p>Just like <a href="#eager">eager</a> but instead of replacing query builder&rsquo;s eager expression this method merges the given
expression to the existing expression.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>relationExpression</td>
<td>string&#124;<a href="#relationexpression"><code class="prettyprint">RelationExpression</code></a></td>
<td>The eager expression</td>
</tr>
<tr>
<td>filters</td>
<td>Object&lt;string, function(<a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a>)&gt;</td>
<td>The named filter functions for the expression</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="mergejoineager">mergeJoinEager</h4>

<p>Shorthand for <code class="prettyprint">eagerAlgorithm(Model.JoinEagerAlgorithm).mergeEager(expr)</code>.</p>

<h4 id="mergenaiveeager">mergeNaiveEager</h4>

<p>Shorthand for <code class="prettyprint">eagerAlgorithm(Model.NaiveEagerAlgorithm).mergeEager(expr)</code>.</p>

<h4 id="alloweager">allowEager</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">allowEager</span><span class="p">(</span><span class="nx">relationExpression</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">allowEager</span><span class="p">(</span><span class="s1">'[children.pets, movies]'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">eager</span><span class="p">)</span>
</code></pre>
<p>Sets the allowed eager expression.</p>

<p>Any subset of the allowed expression is accepted by <a href="#eager"><code class="prettyprint">eager</code></a> method. For example setting
the allowed expression to <code class="prettyprint">a.b.c</code> expressions <code class="prettyprint">a</code>, <code class="prettyprint">a.b</code> and <code class="prettyprint">a.b.c</code> are accepted by <a href="#eager"><code class="prettyprint">eager</code></a>
method. Setting any other expression will reject the query and cause the promise error handlers
to be called.</p>

<p>This method is useful when the eager expression comes from an untrusted source like query
parameters of a http request.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>relationExpression</td>
<td>string&#124;<a href="#relationexpression"><code class="prettyprint">RelationExpression</code></a></td>
<td>The allowed eager expression</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="mergealloweager">mergeAllowEager</h4>

<blockquote>
<p>The following queries are equivalent</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">allowEager</span><span class="p">(</span><span class="s1">'[children.pets, movies]'</span><span class="p">)</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">allowEager</span><span class="p">(</span><span class="s1">'children'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">mergeAllowEager</span><span class="p">(</span><span class="s1">'children.pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">mergeAllowEager</span><span class="p">(</span><span class="s1">'movies'</span><span class="p">)</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">allowEager</span><span class="p">(</span><span class="s1">'children.pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">mergeAllowEager</span><span class="p">(</span><span class="s1">'movies'</span><span class="p">)</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">mergeAllowEager</span><span class="p">(</span><span class="s1">'children.pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">mergeAllowEager</span><span class="p">(</span><span class="s1">'movies'</span><span class="p">)</span>
</code></pre>
<p>Just like <a href="#allowEager">allowEager</a> but instead of replacing query builder&rsquo;s allowEager expression this method merges the given expression to the existing expression.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>relationExpression</td>
<td>string&#124;<a href="#relationexpression"><code class="prettyprint">RelationExpression</code></a></td>
<td>The allowed eager expression</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="modifyeager">modifyEager</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">modifyEager</span><span class="p">(</span><span class="nx">pathExpression</span><span class="p">,</span> <span class="nx">modifier</span><span class="p">);</span>
</code></pre>
<p>Can be used to modify the eager queries.</p>

<p>The <code class="prettyprint">pathExpression</code> is a relation expression that specifies the queries for which the modifier is given.</p>

<blockquote>
<p>The following query would filter out the children&rsquo;s pets that
are &lt;= 10 years old:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'[children.[pets, movies], movies]'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">modifyEager</span><span class="p">(</span><span class="s1">'children.pets'</span><span class="p">,</span> <span class="nx">builder</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">builder</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
  <span class="p">})</span>
</code></pre>
<blockquote>
<p>The path expression can have multiple targets. The next example sorts both the
pets and movies of the children by id:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'[children.[pets, movies], movies]'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">modifyEager</span><span class="p">(</span><span class="s1">'children.[pets, movies]'</span><span class="p">,</span> <span class="nx">builder</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">builder</span><span class="p">.</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">'id'</span><span class="p">);</span>
  <span class="p">})</span>
</code></pre>
<blockquote>
<p>This example only selects movies whose name contains the word &lsquo;Predator&rsquo;:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'[children.[pets, movies], movies]'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">modifyEager</span><span class="p">(</span><span class="s1">'[children.movies, movies]'</span><span class="p">,</span> <span class="nx">builder</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">builder</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'like'</span><span class="p">,</span> <span class="s1">'%Predator%'</span><span class="p">);</span>
  <span class="p">})</span>
</code></pre>
<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>pathExpression</td>
<td>string&#124;<a href="#relationexpression"><code class="prettyprint">RelationExpression</code></a></td>
<td>Expression that specifies the queries for which to give the filter.</td>
</tr>
<tr>
<td>modifier</td>
<td>function(<a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td>The modifier function.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="filtereager">filterEager</h4>

<p>Alias for <a href="#modifyeager">modifyEager</a>.</p>

<h4 id="allowinsert">allowInsert</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">allowInsert</span><span class="p">(</span><span class="nx">relationExpression</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">insertedPerson</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">allowInsert</span><span class="p">(</span><span class="s1">'[children.pets, movies]'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">insertGraph</span><span class="p">({</span>
    <span class="na">firstName</span><span class="p">:</span> <span class="s1">'Sylvester'</span><span class="p">,</span>
    <span class="na">children</span><span class="p">:</span> <span class="p">[{</span>
      <span class="na">firstName</span><span class="p">:</span> <span class="s1">'Sage'</span><span class="p">,</span>
      <span class="na">pets</span><span class="p">:</span> <span class="p">[{</span>
        <span class="na">name</span><span class="p">:</span> <span class="s1">'Fluffy'</span>
        <span class="na">species</span><span class="p">:</span> <span class="s1">'dog'</span>
      <span class="p">},</span> <span class="p">{</span>
        <span class="na">name</span><span class="p">:</span> <span class="s1">'Scrappy'</span><span class="p">,</span>
        <span class="na">species</span><span class="p">:</span> <span class="s1">'dog'</span>
      <span class="p">}]</span>
    <span class="p">}]</span>
  <span class="p">})</span>
</code></pre>
<p>Sets the allowed tree of relations to insert using <a href="#insertgraph"><code class="prettyprint">insertGraph</code></a> method.</p>

<p>If the model tree given to the <a href="#insertgraph"><code class="prettyprint">insertGraph</code></a> method isn&rsquo;t a subtree of the
given expression, the query is rejected.</p>

<p>See methods <a href="#eager"><code class="prettyprint">eager</code></a>, <a href="#alloweager"><code class="prettyprint">allowEager</code></a>, <a href="#relationexpression"><code class="prettyprint">RelationExpression</code></a> and the
section about <a href="#eager-queries">eager queries</a> for more information on relation expressions.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>relationExpression</td>
<td>string&#124;<a href="#relationexpression"><code class="prettyprint">RelationExpression</code></a></td>
<td>The allowed eager expression</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="allowupsert">allowUpsert</h4>

<p>Just like <a href="#allowinsert"><code class="prettyprint">allowInsert</code></a> but this one works with <a href="#upsertgraph"><code class="prettyprint">upsertGraph</code></a>.</p>

<h4 id="castto">castTo</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">castTo</span><span class="p">(</span><span class="nx">ModelClass</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>The following example creates a query through <code class="prettyprint">Person</code>, joins a bunch of relations, selects
only the related <code class="prettyprint">Animal</code>&rsquo;s columns and returns the results as <code class="prettyprint">Animal</code> instances instead
of <code class="prettyprint">Person</code> instances.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">animals</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">joinRelation</span><span class="p">(</span><span class="s1">'children.children.pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">'children:children:pets.*'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">castTo</span><span class="p">(</span><span class="nx">Animal</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>If your result rows represent no actual model, you can use <code class="prettyprint">objection.Model</code></p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">Model</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">models</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">joinRelation</span><span class="p">(</span><span class="s1">'children.pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">select</span><span class="p">([</span>
    <span class="s1">'children:pets.id as animalId'</span><span class="p">,</span>
    <span class="s1">'children.firstName as childFirstName'</span>
  <span class="p">])</span>
  <span class="p">.</span><span class="nx">castTo</span><span class="p">(</span><span class="nx">Model</span><span class="p">);</span>
</code></pre>
<p>Sets the model class of the result rows.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#model"><code class="prettyprint">ModelClass</code></a></td>
<td>The model class of the result rows.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining.</td>
</tr>
</tbody></table>

<h4 id="modelclass">modelClass</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">modelClass</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">modelClass</span><span class="p">();</span>
</code></pre>
<p>Gets the Model subclass this builder is bound to.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#model"><code class="prettyprint">Model</code></a></td>
<td>The Model subclass this builder is bound to</td>
</tr>
</tbody></table>

<h4 id="tostring">toString</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">sql</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</code></pre>
<p>Returns the SQL string suitable for logging input <em>but not for execution</em>, via Knex&rsquo;s <code class="prettyprint">toString()</code>. This method should not be used to create queries for database execution because it makes no guarantees about escaping bindings properly.</p>

<p>Note: In the current release, if the query builder attempts to execute multiple queries or throw any exception whatsoever, <strong>no error will throw</strong> and instead the following string is returned:</p>
<pre class="highlight plaintext"><code>This query cannot be built synchronously. Consider using debug() method instead.
</code></pre>
<p>Later versions of Objection may introduce a native way to retrieve an executable SQL statement, or handle this behavior differently. If you need executable SQL, you can consider the unstable/private API <code class="prettyprint">this.build().toSQL()</code>, which is the native Knex method that can <a href="http://knexjs.org/#Interfaces-toSQL">provide formatted bindings</a>.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>string</td>
<td>The SQL this query builder will build, or <code class="prettyprint">This query cannot be built synchronously. Consider using debug() method instead.</code> if an exception is thrown</td>
</tr>
</tbody></table>

<h4 id="tosql">toSql</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">sql</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">toSql</span><span class="p">();</span>
</code></pre>
<p>An alias for <code class="prettyprint">toSql()</code>.</p>

<p>Note: The behavior of Objection&rsquo;s <code class="prettyprint">toSql()</code> is different from Knex&rsquo;s <code class="prettyprint">toSql()</code> (see above). This method may be deprecated soon.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>string</td>
<td>The SQL this query builder will build, or <code class="prettyprint">This query cannot be built synchronously. Consider using debug() method instead.</code> if an exception is thrown</td>
</tr>
</tbody></table>

<h4 id="skipundefined">skipUndefined</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">skipUndefined</span><span class="p">();</span>
</code></pre>
<p>If this method is called for a builder then undefined values passed to the query builder methods don&rsquo;t cause
an exception but are ignored instead.</p>

<blockquote>
<p>For example the following query will return all <code class="prettyprint">Person</code> rows if <code class="prettyprint">req.query.firstName</code> is <code class="prettyprint">undefined</code>.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">skipUndefined</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'firstName'</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">firstName</span><span class="p">)</span>
</code></pre>
<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining</td>
</tr>
</tbody></table>

<h4 id="transacting">transacting</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">transacting</span><span class="p">(</span><span class="nx">transaction</span><span class="p">);</span>
</code></pre>
<p>Sets the transaction for a query.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>transaction</td>
<td>object</td>
<td>A transaction object</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining</td>
</tr>
</tbody></table>

<h4 id="clone">clone</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">clone</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
</code></pre>
<p>Create a clone of this builder.</p>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td>Clone of the query builder</td>
</tr>
</tbody></table>

<h4 id="execute">execute</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">execute</span><span class="p">();</span>
</code></pre>
<p>Executes the query and returns a Promise.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://bluebirdjs.com/docs/getting-started.html"><code class="prettyprint">Promise</code></a></td>
<td>Promise the will be resolved with the result of the query.</td>
</tr>
</tbody></table>

<h4 id="then">then</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">successHandler</span><span class="p">,</span> <span class="nx">errorHandler</span><span class="p">);</span>
</code></pre>
<p>Executes the query and returns a Promise.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>successHandler</td>
<td>function</td>
<td>identity</td>
<td>Promise success handler</td>
</tr>
<tr>
<td>errorHandler</td>
<td>function</td>
<td>identity</td>
<td>Promise error handler</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://bluebirdjs.com/docs/getting-started.html"><code class="prettyprint">Promise</code></a></td>
<td>Promise the will be resolved with the result of the query.</td>
</tr>
</tbody></table>

<h4 id="map">map</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">mapper</span><span class="p">);</span>
</code></pre>
<p>Executes the query and calls <code class="prettyprint">map(mapper)</code> for the returned promise.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>mapper</td>
<td>function</td>
<td>identity</td>
<td>Mapper function</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://bluebirdjs.com/docs/getting-started.html"><code class="prettyprint">Promise</code></a></td>
<td>Promise the will be resolved with the result of the query.</td>
</tr>
</tbody></table>

<h4 id="reduce">reduce</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="nx">initialValue</span><span class="p">);</span>
</code></pre>
<p>Executes the query and calls <code class="prettyprint">reduce(reducer, initialValue)</code> for the returned promise.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>reducer</td>
<td>function</td>
<td>undefined</td>
<td>Reducer function</td>
</tr>
<tr>
<td>initialValue</td>
<td>any</td>
<td>first element of the reduced collection</td>
<td>First arg for the</td>
</tr>
</tbody></table>

<p>reducer function</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://bluebirdjs.com/docs/getting-started.html"><code class="prettyprint">Promise</code></a></td>
<td>Promise the will be resolved with the result of the query.</td>
</tr>
</tbody></table>

<h4 id="catch">catch</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">errorHandler</span><span class="p">);</span>
</code></pre>
<p>Executes the query and calls <code class="prettyprint">catch(errorHandler)</code> for the returned promise.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>errorHandler</td>
<td>function</td>
<td>identity</td>
<td>Error handler</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://bluebirdjs.com/docs/getting-started.html"><code class="prettyprint">Promise</code></a></td>
<td>Promise the will be resolved with the result of the query.</td>
</tr>
</tbody></table>

<h4 id="return">return</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="k">return</span><span class="p">(</span><span class="nx">returnValue</span><span class="p">);</span>
</code></pre>
<p>Executes the query and calls <code class="prettyprint">return(returnValue)</code> for the returned promise.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>returnValue</td>
<td></td>
<td>undefined</td>
<td>Return value</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://bluebirdjs.com/docs/getting-started.html"><code class="prettyprint">Promise</code></a></td>
<td>Promise the will be resolved with the result of the query.</td>
</tr>
</tbody></table>

<h4 id="bind">bind</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">returnValue</span><span class="p">);</span>
</code></pre>
<p>Executes the query and calls <code class="prettyprint">bind(context)</code> for the returned promise.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>context</td>
<td></td>
<td>undefined</td>
<td>Bind context</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://bluebirdjs.com/docs/getting-started.html"><code class="prettyprint">Promise</code></a></td>
<td>Promise the will be resolved with the result of the query.</td>
</tr>
</tbody></table>

<h4 id="ascallback">asCallback</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">asCallback</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
</code></pre>
<p>Executes the query and calls <code class="prettyprint">asCallback(callback)</code> for the returned promise.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>callback</td>
<td>function</td>
<td>undefined</td>
<td>Node style callback</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://bluebirdjs.com/docs/getting-started.html"><code class="prettyprint">Promise</code></a></td>
<td>Promise the will be resolved with the result of the query.</td>
</tr>
</tbody></table>

<h4 id="nodeify">nodeify</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">nodeify</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
</code></pre>
<p>Executes the query and calls <code class="prettyprint">nodeify(callback)</code> for the returned promise.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>callback</td>
<td>function</td>
<td>undefined</td>
<td>Node style callback</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://bluebirdjs.com/docs/getting-started.html"><code class="prettyprint">Promise</code></a></td>
<td>Promise the will be resolved with the result of the query.</td>
</tr>
</tbody></table>

<h4 id="resultsize">resultSize</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">resultSize</span><span class="p">();</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>

<span class="kr">const</span> <span class="p">[</span><span class="nx">total</span><span class="p">,</span> <span class="nx">models</span><span class="p">]</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
  <span class="nx">query</span><span class="p">.</span><span class="nx">resultSize</span><span class="p">(),</span>
  <span class="nx">query</span><span class="p">.</span><span class="nx">offset</span><span class="p">(</span><span class="mi">100</span><span class="p">).</span><span class="nx">limit</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">]);</span>
</code></pre>
<p>Returns the amount of rows the current query would produce without <a href="#limit"><code class="prettyprint">limit</code></a> and <a href="#offset"><code class="prettyprint">offset</code></a> applied.
Note that this executes a query (not the one we are building) and returns a Promise.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://bluebirdjs.com/docs/getting-started.html"><code class="prettyprint">Promise</code></a></td>
<td>Promise the will be resolved with the result size.</td>
</tr>
</tbody></table>

<h4 id="page">page</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">page</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span> <span class="nx">pageSize</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">page</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// --&gt; 100</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">total</span><span class="p">);</span> <span class="c1">// --&gt; 3341</span>
</code></pre>
<p>Two queries are performed by this method: the actual query and a query to get the <code class="prettyprint">total</code> count.</p>

<p>Mysql has the <code class="prettyprint">SQL_CALC_FOUND_ROWS</code> option and <code class="prettyprint">FOUND_ROWS()</code> function that can be used to calculate the result size,
but according to my tests and <a href="http://www.google.com/search?q=SQL_CALC_FOUND_ROWS+performance">the interwebs</a> the
performance is significantly worse than just executing a separate count query.</p>

<p>Postgresql has window functions that can be used to get the total count like this <code class="prettyprint">select count(*) over () as total</code>.
The problem with this is that if the result set is empty, we don&rsquo;t get the total count either.
(If someone can figure out a way around this, a PR is very welcome).</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>page</td>
<td>number</td>
<td>The index of the page to return. The index of the first page is 0.</td>
</tr>
<tr>
<td>pageSize</td>
<td>number</td>
<td>The page size</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining</td>
</tr>
</tbody></table>

<h4 id="range">range</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// --&gt; 101</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">total</span><span class="p">);</span> <span class="c1">// --&gt; 3341</span>
</code></pre>
<blockquote>
<p><code class="prettyprint">range</code> can be called without arguments if you want to specify the limit and offset explicitly:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">range</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="c1">// --&gt; 101</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">total</span><span class="p">);</span> <span class="c1">// --&gt; 3341</span>
</code></pre>
<p>Only returns the given range of results.</p>

<p>Two queries are performed by this method: the actual query and a query to get the <code class="prettyprint">total</code> count.</p>

<p>Mysql has the <code class="prettyprint">SQL_CALC_FOUND_ROWS</code> option and <code class="prettyprint">FOUND_ROWS()</code> function that can be used to calculate the result size,
but according to my tests and <a href="http://www.google.com/search?q=SQL_CALC_FOUND_ROWS+performance">the interwebs</a> the
performance is significantly worse than just executing a separate count query.</p>

<p>Postgresql has window functions that can be used to get the total count like this <code class="prettyprint">select count(*) over () as total</code>.
The problem with this is that if the result set is empty, we don&rsquo;t get the total count either.
(If someone can figure out a way around this, a PR is very welcome).</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>start</td>
<td>number</td>
<td>The index of the first result (inclusive)</td>
</tr>
<tr>
<td>end</td>
<td>number</td>
<td>The index of the last result (inclusive)</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining</td>
</tr>
</tbody></table>

<h4 id="pluck">pluck</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">pluck</span><span class="p">(</span><span class="nx">propertyName</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">firstNames</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">pluck</span><span class="p">(</span><span class="s1">'firstName'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">firstNames</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// --&gt; string</span>
</code></pre>
<p>If the result is an array, plucks a property from each object.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>propertyName</td>
<td>string</td>
<td>The name of the property to pluck</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining</td>
</tr>
</tbody></table>

<h4 id="first">first</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">first</span><span class="p">();</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">firstPerson</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">first</span><span class="p">()</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">firstPerson</span><span class="p">.</span><span class="nx">age</span><span class="p">);</span>
</code></pre>
<p>If the result is an array, selects the first item.</p>

<p>NOTE: This doesn&rsquo;t add <code class="prettyprint">limit 1</code> to the query by default. You can override
the <a href="#uselimitinfirst"><code class="prettyprint">Model.useLimitInFirst</code></a> property to change this
behaviour.</p>

<p>Also see <a href="#findbyid"><code class="prettyprint">findById</code></a> and <a href="#findone"><code class="prettyprint">findOne</code></a> shorthand methods.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining</td>
</tr>
</tbody></table>

<h4 id="throwifnotfound">throwIfNotFound</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">throwIfNotFound</span><span class="p">();</span>
</code></pre><pre class="highlight javascript"><code><span class="k">try</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="nx">Language</span>
    <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'Java'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">andWhere</span><span class="p">(</span><span class="s1">'isModern'</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">throwIfNotFound</span><span class="p">()</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// No results found.</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span> <span class="k">instanceof</span> <span class="nx">Language</span><span class="p">.</span><span class="nx">NotFoundError</span><span class="p">);</span> <span class="c1">// --&gt; true</span>
<span class="p">}</span>
</code></pre>
<p>Causes a <a href="#notfounderror"><code class="prettyprint">Model.NotFoundError</code></a> to be thrown if the query result is empty.</p>

<p>You can replace <code class="prettyprint">Model.NotFoundError</code> with your own error by implementing the static
<a href="#createnotfounderror"><code class="prettyprint">Model.createNotFoundError(ctx)</code></a> method.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining</td>
</tr>
</tbody></table>

<h4 id="traverse">traverse</h4>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">traverse</span><span class="p">(</span><span class="nx">modelClass</span><span class="p">,</span> <span class="nx">traverser</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">traverse</span><span class="p">((</span><span class="nx">model</span><span class="p">,</span> <span class="nx">parentModel</span><span class="p">,</span> <span class="nx">relationName</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">delete</span> <span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
  <span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">);</span> <span class="c1">// --&gt; undefined</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">pets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">);</span> <span class="c1">// --&gt; undefined</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">traverse</span><span class="p">(</span><span class="nx">Animal</span><span class="p">,</span> <span class="p">(</span><span class="nx">animal</span><span class="p">,</span> <span class="nx">parentModel</span><span class="p">,</span> <span class="nx">relationName</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">delete</span> <span class="nx">animal</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
  <span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">persons</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">);</span> <span class="c1">// --&gt; 1</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">persons</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">pets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">);</span> <span class="c1">// --&gt; undefined</span>
</code></pre>
<p>Traverses through all models in the result, including the eagerly loaded relations.</p>

<p>The optional first parameter can be a constructor. If given, the traverser
function is only called for the models of that class.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>modelClass</td>
<td><a href="#model"><code class="prettyprint">Model</code></a></td>
<td>The optional model class filter. If given, the traverser function is only called for models of this class.</td>
</tr>
<tr>
<td>traverser</td>
<td>function(<a href="#model"><code class="prettyprint">Model</code></a>, <a href="#model"><code class="prettyprint">Model</code></a>, string)</td>
<td>The traverser function that is called for each model. The first argument is the model itself. If the model is in a relation of some other model the second argument is the parent model and the third argument is the name of the relation.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining</td>
</tr>
</tbody></table>

<h4 id="pick">pick</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">pick</span><span class="p">(</span><span class="nx">modelClass</span><span class="p">,</span> <span class="nx">properties</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>There are two ways to call this methods:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">).</span>
  <span class="p">.</span><span class="nx">pick</span><span class="p">([</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">]);</span>
</code></pre>
<blockquote>
<p>and</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">pick</span><span class="p">(</span><span class="nx">Person</span><span class="p">,</span> <span class="p">[</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'firstName'</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">pick</span><span class="p">(</span><span class="nx">Animal</span><span class="p">,</span> <span class="p">[</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">]);</span>
</code></pre>
<p>Pick properties from result models.</p>

<p>The first example goes through all models (including relations) and discards all
properties but <code class="prettyprint">id</code> and <code class="prettyprint">name</code>. The second example also traverses the whole model
tree and discards all but <code class="prettyprint">id</code> and <code class="prettyprint">firstName</code> properties of all <code class="prettyprint">Person</code>
instances and <code class="prettyprint">id</code> and <code class="prettyprint">name</code> properties of all <code class="prettyprint">Animal</code> instances.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>modelClass</td>
<td><a href="#model"><code class="prettyprint">Model</code></a></td>
<td>The optional model class filter</td>
</tr>
<tr>
<td>properties</td>
<td>string[]</td>
<td>The properties to pick</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining</td>
</tr>
</tbody></table>

<h4 id="omit">omit</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">queryBuilder</span><span class="p">.</span><span class="nx">omit</span><span class="p">(</span><span class="nx">modelClass</span><span class="p">,</span> <span class="nx">properties</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>There are two ways to call this methods:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">).</span>
  <span class="p">.</span><span class="nx">omit</span><span class="p">([</span><span class="s1">'parentId'</span><span class="p">,</span> <span class="s1">'ownerId'</span><span class="p">]);</span>
</code></pre>
<blockquote>
<p>and</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">omit</span><span class="p">(</span><span class="nx">Person</span><span class="p">,</span> <span class="p">[</span><span class="s1">'parentId'</span><span class="p">,</span> <span class="s1">'age'</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">omit</span><span class="p">(</span><span class="nx">Animal</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ownerId'</span><span class="p">,</span> <span class="s1">'species'</span><span class="p">]);</span>
</code></pre>
<p>Omit properties of result models.</p>

<p>The first example goes through all models (including relations) and omits the properties
<code class="prettyprint">parentId</code> and <code class="prettyprint">ownerId</code>. The second example also traverses the whole model tree and
omits the properties <code class="prettyprint">parentId</code> and <code class="prettyprint">age</code> from all <code class="prettyprint">Person</code> instances and <code class="prettyprint">ownerId</code>
and <code class="prettyprint">species</code> properties of all <code class="prettyprint">Animal</code> instances.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>modelClass</td>
<td><a href="#model"><code class="prettyprint">Model</code></a></td>
<td>The optional model class filter</td>
</tr>
<tr>
<td>properties</td>
<td>string[]</td>
<td>The properties to omit</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td><code class="prettyprint">this</code> query builder for chaining</td>
</tr>
</tbody></table>

<h2 id="model">Model</h2>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="c1">// Table name is the only required property.</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">tableName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'persons'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Optional JSON schema. This is not the database schema!</span>
  <span class="c1">// Nothing is generated based on this. This is only used</span>
  <span class="c1">// for validation. Whenever a model instance is created</span>
  <span class="c1">// it is checked against this schema.</span>
  <span class="c1">// http://json-schema.org/.</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">jsonSchema</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">type</span><span class="p">:</span> <span class="s1">'object'</span><span class="p">,</span>
      <span class="na">required</span><span class="p">:</span> <span class="p">[</span><span class="s1">'firstName'</span><span class="p">,</span> <span class="s1">'lastName'</span><span class="p">],</span>

      <span class="na">properties</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">id</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'integer'</span><span class="p">},</span>
        <span class="na">parentId</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="p">[</span><span class="s1">'integer'</span><span class="p">,</span> <span class="s1">'null'</span><span class="p">]},</span>
        <span class="na">firstName</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">,</span> <span class="na">minLength</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">maxLength</span><span class="p">:</span> <span class="mi">255</span><span class="p">},</span>
        <span class="na">lastName</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">,</span> <span class="na">minLength</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">maxLength</span><span class="p">:</span> <span class="mi">255</span><span class="p">},</span>
        <span class="na">age</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'number'</span><span class="p">},</span>

        <span class="c1">// Properties defined as objects or arrays are</span>
        <span class="c1">// automatically converted to JSON strings when</span>
        <span class="c1">// writing to database and back to objects and arrays</span>
        <span class="c1">// when reading from database. To override this</span>
        <span class="c1">// behaviour, you can override the</span>
        <span class="c1">// Person.jsonAttributes property.</span>
        <span class="na">address</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">type</span><span class="p">:</span> <span class="s1">'object'</span><span class="p">,</span>
          <span class="na">properties</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">street</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">},</span>
            <span class="na">city</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">},</span>
            <span class="na">zipCode</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// This object defines the relations to other models.</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">relationMappings</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">pets</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">relation</span><span class="p">:</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">HasManyRelation</span><span class="p">,</span>
        <span class="c1">// The related model. This can be either a Model</span>
        <span class="c1">// subclass constructor or an absolute file path</span>
        <span class="c1">// to a module that exports one. We use the file</span>
        <span class="c1">// path version here to prevent require loops.</span>
        <span class="na">modelClass</span><span class="p">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">'/Animal'</span><span class="p">,</span>
        <span class="na">join</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">from</span><span class="p">:</span> <span class="s1">'persons.id'</span><span class="p">,</span>
          <span class="na">to</span><span class="p">:</span> <span class="s1">'animals.ownerId'</span>
        <span class="p">}</span>
      <span class="p">},</span>

      <span class="na">movies</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">relation</span><span class="p">:</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">ManyToManyRelation</span><span class="p">,</span>
        <span class="na">modelClass</span><span class="p">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">'/Movie'</span><span class="p">,</span>
        <span class="na">join</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">from</span><span class="p">:</span> <span class="s1">'persons.id'</span><span class="p">,</span>
          <span class="c1">// ManyToMany relation needs the `through` object</span>
          <span class="c1">// to describe the join table.</span>
          <span class="na">through</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">from</span><span class="p">:</span> <span class="s1">'persons_movies.actorId'</span><span class="p">,</span>
            <span class="na">to</span><span class="p">:</span> <span class="s1">'persons_movies.movieId'</span>

            <span class="c1">// If you have a model class for the join table</span>
            <span class="c1">// you can specify it like this:</span>
            <span class="c1">//</span>
            <span class="c1">// modelClass: PersonMovie,</span>

            <span class="c1">// Columns listed here are automatically joined</span>
            <span class="c1">// to the related models on read and written to</span>
            <span class="c1">// the join table instead of the related table</span>
            <span class="c1">// on insert.</span>
            <span class="c1">//</span>
            <span class="c1">// extra: ['someExtra']</span>
          <span class="p">},</span>
          <span class="na">to</span><span class="p">:</span> <span class="s1">'movies.id'</span>
        <span class="p">}</span>
      <span class="p">},</span>

      <span class="na">children</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">relation</span><span class="p">:</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">HasManyRelation</span><span class="p">,</span>
        <span class="na">modelClass</span><span class="p">:</span> <span class="nx">Person</span><span class="p">,</span>
        <span class="na">join</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">from</span><span class="p">:</span> <span class="s1">'persons.id'</span><span class="p">,</span>
          <span class="na">to</span><span class="p">:</span> <span class="s1">'persons.parentId'</span>
        <span class="p">}</span>
      <span class="p">},</span>

      <span class="na">parent</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">relation</span><span class="p">:</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">BelongsToOneRelation</span><span class="p">,</span>
        <span class="na">modelClass</span><span class="p">:</span> <span class="nx">Person</span><span class="p">,</span>
        <span class="na">join</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">from</span><span class="p">:</span> <span class="s1">'persons.parentId'</span><span class="p">,</span>
          <span class="na">to</span><span class="p">:</span> <span class="s1">'persons.id'</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Subclasses of this class represent database tables.</p>

<h5 id="model-lifecycle">Model lifecycle</h5>

<p>For the purposes of this explanation, let&rsquo;s define three data layouts:</p>

<ol>
<li><code class="prettyprint">database</code>: The data layout returned by the database.</li>
<li><code class="prettyprint">internal</code>: The data layout of a model instance.</li>
<li><code class="prettyprint">external</code>: The data layout after calling <code class="prettyprint">model.toJSON()</code>.</li>
</ol>

<p>Whenever data is converted from one layout to another, converter methods are called:</p>

<ol>
<li><code class="prettyprint">database</code> -&gt; <a href="#_s_parsedatabasejson"><code class="prettyprint">$parseDatabaseJson</code></a> -&gt; <code class="prettyprint">internal</code></li>
<li><code class="prettyprint">internal</code> -&gt; <a href="#_s_formatdatabasejson"><code class="prettyprint">$formatDatabaseJson</code></a> -&gt; <code class="prettyprint">database</code></li>
<li><code class="prettyprint">external</code> -&gt; <a href="#_s_parsejson"><code class="prettyprint">$parseJson</code></a> -&gt; <code class="prettyprint">internal</code></li>
<li><code class="prettyprint">internal</code> -&gt; <a href="#_s_formatjson"><code class="prettyprint">$formatJson</code></a> -&gt; <code class="prettyprint">external</code></li>
</ol>

<p>So for example when the results of a query are read from the database the data goes through the
<a href="#_s_parsedatabasejson"><code class="prettyprint">$parseDatabaseJson</code></a> method. When data is written to database it goes through
the <a href="#_s_formatdatabasejson"><code class="prettyprint">$formatDatabaseJson</code></a> method.</p>

<p>Similarly when you give data for a query (for example <a href="#insert"><code class="prettyprint">query().insert(req.body)</code></a>) or create a model
explicitly using <a href="#fromjson"><code class="prettyprint">Model.fromJson(obj)</code></a> the <a href="#_s_parsejson"><code class="prettyprint">$parseJson</code></a> method is invoked. When you call
<a href="#tojson"><code class="prettyprint">model.toJSON()</code></a> or <a href="#_s_tojson"><code class="prettyprint">model.$toJson()</code></a> the <a href="#_s_formatjson"><code class="prettyprint">$formatJson</code></a> is called.</p>

<p>Note: Most libraries like <a href="http://expressjs.com/en/index.html">express</a> automatically call the <a href="#tojson"><code class="prettyprint">toJSON</code></a>
method when you pass the model to methods like <code class="prettyprint">response.json(model)</code>. You rarely need to call
<a href="#tojson"><code class="prettyprint">toJSON()</code></a>  or <a href="#_s_tojson"><code class="prettyprint">$toJson()</code></a> explicitly.</p>

<p>By overriding the lifecycle methods, you can have different layouts for the data in database and when exposed to the
outside world. See <a href="#map-column-names-to-different-property-names">this recipe</a> for an example usage of the lifecycle
methods.</p>

<p>All instance methods of models are prefixed with <code class="prettyprint">$</code> letter so that they won&rsquo;t overlap with database
properties. All properties that start with <code class="prettyprint">$</code> are also removed from <code class="prettyprint">database</code> and <code class="prettyprint">external</code> layouts.</p>

<h3 id="static-properties">Static properties</h3>

<h4 id="tablename">tableName</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">tableName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'persons'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>ESNext:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">tableName</span> <span class="o">=</span> <span class="s1">'persons'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Name of the database table for this model.</p>

<p>Each model must set this.</p>

<h4 id="jsonschema">jsonSchema</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">jsonSchema</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">type</span><span class="p">:</span> <span class="s1">'object'</span><span class="p">,</span>
      <span class="na">required</span><span class="p">:</span> <span class="p">[</span><span class="s1">'firstName'</span><span class="p">,</span> <span class="s1">'lastName'</span><span class="p">],</span>

      <span class="na">properties</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">id</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'integer'</span><span class="p">},</span>
        <span class="na">parentId</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="p">[</span><span class="s1">'integer'</span><span class="p">,</span> <span class="s1">'null'</span><span class="p">]},</span>
        <span class="na">firstName</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">,</span> <span class="na">minLength</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">maxLength</span><span class="p">:</span> <span class="mi">255</span><span class="p">},</span>
        <span class="na">lastName</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">,</span> <span class="na">minLength</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">maxLength</span><span class="p">:</span> <span class="mi">255</span><span class="p">},</span>
        <span class="na">age</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'number'</span><span class="p">},</span>

        <span class="c1">// Properties defined as objects or arrays are</span>
        <span class="c1">// automatically converted to JSON strings when</span>
        <span class="c1">// writing to database and back to objects and arrays</span>
        <span class="c1">// when reading from database. To override this</span>
        <span class="c1">// behaviour, you can override the</span>
        <span class="c1">// Person.jsonAttributes property.</span>
        <span class="na">address</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">type</span><span class="p">:</span> <span class="s1">'object'</span><span class="p">,</span>
          <span class="na">properties</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">street</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">},</span>
            <span class="na">city</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">},</span>
            <span class="na">zipCode</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>ESNext:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">jsonSchema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'object'</span><span class="p">,</span>
    <span class="na">required</span><span class="p">:</span> <span class="p">[</span><span class="s1">'firstName'</span><span class="p">,</span> <span class="s1">'lastName'</span><span class="p">],</span>

    <span class="na">properties</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">id</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'integer'</span><span class="p">},</span>
      <span class="na">parentId</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="p">[</span><span class="s1">'integer'</span><span class="p">,</span> <span class="s1">'null'</span><span class="p">]},</span>
      <span class="na">firstName</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">,</span> <span class="na">minLength</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">maxLength</span><span class="p">:</span> <span class="mi">255</span><span class="p">},</span>
      <span class="na">lastName</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">,</span> <span class="na">minLength</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">maxLength</span><span class="p">:</span> <span class="mi">255</span><span class="p">},</span>
      <span class="na">age</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'number'</span><span class="p">},</span>

      <span class="c1">// Properties defined as objects or arrays are</span>
      <span class="c1">// automatically converted to JSON strings when</span>
      <span class="c1">// writing to database and back to objects and arrays</span>
      <span class="c1">// when reading from database. To override this</span>
      <span class="c1">// behaviour, you can override the</span>
      <span class="c1">// Person.jsonAttributes property.</span>
      <span class="na">address</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">type</span><span class="p">:</span> <span class="s1">'object'</span><span class="p">,</span>
        <span class="na">properties</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">street</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">},</span>
          <span class="na">city</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">},</span>
          <span class="na">zipCode</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre>
<p>The optional schema against which the JSON is validated.</p>

<p>The jsonSchema can be dynamically modified in the <a href="#_s_beforevalidate"><code class="prettyprint">$beforeValidate</code></a> method.</p>

<p>Must follow http://json-schema.org specification. If null no validation is done.</p>

<p>Read more:</p>

<ul>
<li><a href="#_s_beforevalidate"><code class="prettyprint">$beforeValidate</code></a></li>
<li><a href="#_s_validate"><code class="prettyprint">$validate</code></a></li>
<li><a href="#_s_aftervalidate"><code class="prettyprint">$afterValidate</code></a></li>
<li><a href="#jsonattributes"><code class="prettyprint">jsonAttributes</code></a></li>
<li><a href="#custom-validation">custom validation recipe</a></li>
</ul>

<h4 id="idcolumn">idColumn</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">idColumn</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'some_column_name'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>ESNext:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">idColumn</span> <span class="o">=</span> <span class="s1">'some_column_name'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Name of the primary key column in the database table.</p>

<p>Composite id can be specified by giving an array of column names.</p>

<p>Defaults to &#39;id&rsquo;.</p>

<h4 id="modelpaths">modelPaths</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">modelPaths</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="nx">__dirname</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Using a shared <code class="prettyprint">BaseModel</code> superclass:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">Model</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>

<span class="c1">// models/BaseModel.js</span>
<span class="kr">class</span> <span class="nx">BaseModel</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">modelPaths</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="nx">__dirname</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">BaseModel</span>
<span class="p">};</span>

<span class="c1">// models/Person.js</span>
<span class="kr">const</span> <span class="p">{</span> <span class="nx">BaseModel</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./BaseModel'</span><span class="p">);</span>

<span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">BaseModel</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>ESNext:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">modelPaths</span> <span class="o">=</span> <span class="p">[</span><span class="nx">__dirname</span><span class="p">];</span>
<span class="p">}</span>
</code></pre>
<p>A list of paths from which to search for models for relations.</p>

<p>A model class can be defined for a relation in <a href="#relationmappings"><code class="prettyprint">relationMappings</code></a> as</p>

<ol>
<li>A model class constructor</li>
<li>An absolute path to a module that exports a model class</li>
<li>A path relative to one of the paths in <code class="prettyprint">modelPaths</code> array.</li>
</ol>

<p>You probably don&rsquo;t want to define <code class="prettyprint">modelPaths</code> property for each model. Once again we
recommend that you create a <code class="prettyprint">BaseModel</code> super class for all your models and define
shared configuration such as this there.</p>

<h4 id="relationmappings">relationMappings</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">Model</span><span class="p">,</span> <span class="nx">ref</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>

<span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">tableName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'persons'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">relationMappings</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">pets</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">relation</span><span class="p">:</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">HasManyRelation</span><span class="p">,</span>
        <span class="na">modelClass</span><span class="p">:</span> <span class="nx">Animal</span><span class="p">,</span>
        <span class="na">join</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">from</span><span class="p">:</span> <span class="s1">'persons.id'</span><span class="p">,</span>
          <span class="c1">// Any of the `to` and `from` fields can also be</span>
          <span class="c1">// references to nested fields (or arrays of references).</span>
          <span class="c1">// Here the relation is created between `persons.id` and</span>
          <span class="c1">// `animals.json.details.ownerId` properties. The reference</span>
          <span class="c1">// must be casted to the same type as the other key.</span>
          <span class="na">to</span><span class="p">:</span> <span class="nx">ref</span><span class="p">(</span><span class="s1">'animals.json:details.ownerId'</span><span class="p">).</span><span class="nx">castInt</span><span class="p">()</span>
        <span class="p">}</span>
      <span class="p">},</span>

      <span class="na">father</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">relation</span><span class="p">:</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">BelongsToOneRelation</span><span class="p">,</span>
        <span class="na">modelClass</span><span class="p">:</span> <span class="nx">Person</span><span class="p">,</span>
        <span class="na">join</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">from</span><span class="p">:</span> <span class="s1">'persons.fatherId'</span><span class="p">,</span>
          <span class="na">to</span><span class="p">:</span> <span class="s1">'persons.id'</span>
        <span class="p">}</span>
      <span class="p">},</span>

      <span class="na">movies</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">relation</span><span class="p">:</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">ManyToManyRelation</span><span class="p">,</span>
        <span class="na">modelClass</span><span class="p">:</span> <span class="nx">Movie</span><span class="p">,</span>
        <span class="na">join</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">from</span><span class="p">:</span> <span class="s1">'persons.id'</span><span class="p">,</span>
          <span class="na">through</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">from</span><span class="p">:</span> <span class="s1">'persons_movies.actorId'</span><span class="p">,</span>
            <span class="na">to</span><span class="p">:</span> <span class="s1">'persons_movies.movieId'</span>

            <span class="c1">// If you have a model class for the join table</span>
            <span class="c1">// you can specify it like this:</span>
            <span class="c1">//</span>
            <span class="c1">// modelClass: PersonMovie,</span>

            <span class="c1">// Columns listed here are automatically joined</span>
            <span class="c1">// to the related models on read and written to</span>
            <span class="c1">// the join table instead of the related table</span>
            <span class="c1">// on insert.</span>
            <span class="c1">//</span>
            <span class="c1">// extra: ['someExtra']</span>
          <span class="p">},</span>
          <span class="na">to</span><span class="p">:</span> <span class="s1">'movies.id'</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>ESNext:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">Model</span><span class="p">,</span> <span class="nx">ref</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'objection'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">tableName</span> <span class="o">=</span> <span class="s1">'persons'</span><span class="p">;</span>

  <span class="kr">static</span> <span class="nx">relationMappings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">pets</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">relation</span><span class="p">:</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">HasManyRelation</span><span class="p">,</span>
      <span class="na">modelClass</span><span class="p">:</span> <span class="nx">Animal</span><span class="p">,</span>
      <span class="na">join</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">from</span><span class="p">:</span> <span class="s1">'persons.id'</span><span class="p">,</span>
        <span class="c1">// Any of the `to` and `from` fields can also be</span>
        <span class="c1">// references to nested fields (or arrays of references).</span>
        <span class="c1">// Here the relation is created between `persons.id` and</span>
        <span class="c1">// `animals.json.details.ownerId` properties. The reference</span>
        <span class="c1">// must be casted to the same type as the other key.</span>
        <span class="na">to</span><span class="p">:</span> <span class="nx">ref</span><span class="p">(</span><span class="s1">'animals.json:details.ownerId'</span><span class="p">).</span><span class="nx">castInt</span><span class="p">()</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="na">father</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">relation</span><span class="p">:</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">BelongsToOneRelation</span><span class="p">,</span>
      <span class="na">modelClass</span><span class="p">:</span> <span class="nx">Person</span><span class="p">,</span>
      <span class="na">join</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">from</span><span class="p">:</span> <span class="s1">'persons.fatherId'</span><span class="p">,</span>
        <span class="na">to</span><span class="p">:</span> <span class="s1">'persons.id'</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="na">movies</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">relation</span><span class="p">:</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">ManyToManyRelation</span><span class="p">,</span>
      <span class="na">modelClass</span><span class="p">:</span> <span class="nx">Movie</span><span class="p">,</span>
      <span class="na">join</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">from</span><span class="p">:</span> <span class="s1">'persons.id'</span><span class="p">,</span>
        <span class="na">through</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">from</span><span class="p">:</span> <span class="s1">'persons_movies.actorId'</span><span class="p">,</span>
          <span class="na">to</span><span class="p">:</span> <span class="s1">'persons_movies.movieId'</span>

          <span class="c1">// If you have a model class for the join table</span>
          <span class="c1">// you can specify it like this:</span>
          <span class="c1">//</span>
          <span class="c1">// modelClass: PersonMovie,</span>

          <span class="c1">// Columns listed here are automatically joined</span>
          <span class="c1">// to the related models on read and written to</span>
          <span class="c1">// the join table instead of the related table</span>
          <span class="c1">// on insert.</span>
          <span class="c1">//</span>
          <span class="c1">// extra: ['someExtra']</span>
        <span class="p">},</span>
        <span class="na">to</span><span class="p">:</span> <span class="s1">'movies.id'</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre>
<p>This property defines the relations to other models.</p>

<p>relationMappings is an object (or a function that returns an object) whose keys are relation names and values are <a href="#relationmapping"><code class="prettyprint">RelationMapping</code></a> instances.
The <code class="prettyprint">join</code> property in addition to the relation type define how the models are related to one
another. The <code class="prettyprint">from</code> and <code class="prettyprint">to</code> properties of the <code class="prettyprint">join</code> object define the database columns through which the
models are associated. Note that neither of these columns need to be primary keys. They can be any
columns. In fact they can even be fields inside JSON columns (using the <a href="#ref"><code class="prettyprint">ref</code></a> helper). In the
case of ManyToManyRelation also the join table needs to be defined. This is done using the <code class="prettyprint">through</code> object.</p>

<p>The <code class="prettyprint">modelClass</code> passed to the relation mappings is the class of the related model. It can be one of the following:</p>

<ol>
<li>A model class constructor</li>
<li>An absolute path to a module that exports a model class</li>
<li>A path relative to one of the paths in <a href="#modelpaths"><code class="prettyprint">modelPaths</code></a> array.</li>
</ol>

<p>The file path versions are handy for avoiding require loops.</p>

<p>See <a href="#relationmapping"><code class="prettyprint">RelationMapping</code></a></p>

<h5 id="relationmapping">RelationMapping</h5>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>relation</td>
<td>function</td>
<td>The relation type. One of <code class="prettyprint">Model.BelongsToOneRelation</code>, <code class="prettyprint">Model.HasOneRelation</code>, <code class="prettyprint">Model.HasManyRelation</code> and <code class="prettyprint">Model.ManyToManyRelation</code>.</td>
</tr>
<tr>
<td>modelClass</td>
<td><a href="#model"><code class="prettyprint">Model</code></a>&#124;string</td>
<td>Constructor of the related model class, an absolute path to a module that exports one or a path relative to <a href="#modelpaths"><code class="prettyprint">modelPaths</code></a> that exports a model class.</td>
</tr>
<tr>
<td>join</td>
<td><a href="#relationjoin"><code class="prettyprint">RelationJoin</code></a></td>
<td>Describes how the models are related to each other. See <a href="#relationjoin"><code class="prettyprint">RelationJoin</code></a>.</td>
</tr>
<tr>
<td>modify</td>
<td>function(<a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a>)&#124;string&#124;object</td>
<td>Optional modifier for the relation query. If specified as a function, it will be called each time before fetching the relation. If specified as a string, named filter with specified name will be applied each time when fetching the relation. If specified as an object, it will be used as an additional query parameter - e. g. passing {name: &#39;Jenny&rsquo;} would additionally narrow fetched rows to the ones with the name &#39;Jenny&rsquo;.</td>
</tr>
<tr>
<td>filter</td>
<td>function(<a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a>)&#124;string&#124;object</td>
<td>Alias for modify.</td>
</tr>
<tr>
<td>beforeInsert</td>
<td>function(<a href="#model"><code class="prettyprint">Model</code></a>, <a href="#context"><code class="prettyprint">QueryContext</code></a>)</td>
<td>Optional insert hook that is called for each inserted model instance. This function can be async.</td>
</tr>
</tbody></table>

<h5 id="relationjoin">RelationJoin</h5>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>from</td>
<td>string&#124;<a href="#ref"><code class="prettyprint">ReferenceBuilder</code></a>&#124;Array</td>
<td>The relation column in the owner table. Must be given with the table name. For example <code class="prettyprint">persons.id</code>. Composite key can be specified using an array of columns e.g. <code class="prettyprint">[&#39;persons.a&#39;, &#39;persons.b&#39;]</code>. Note that neither this nor <code class="prettyprint">to</code> need to be foreign keys or primary keys. You can join any column to any column. You can even join nested json fields using the <a href="#ref"><code class="prettyprint">ref</code></a> helper.</td>
</tr>
<tr>
<td>to</td>
<td>string&#124;<a href="#ref"><code class="prettyprint">ReferenceBuilder</code></a>&#124;Array</td>
<td>The relation column in the related table. Must be given with the table name. For example <code class="prettyprint">movies.id</code>. Composite key can be specified using an array of columns e.g. <code class="prettyprint">[&#39;movies.a&#39;, &#39;movies.b&#39;]</code>. Note that neither this nor <code class="prettyprint">from</code> need to be foreign keys or primary keys. You can join any column to any column. You can even join nested json fields using the <a href="#ref"><code class="prettyprint">ref</code></a> helper.</td>
</tr>
<tr>
<td>through</td>
<td><a href="#relationthrough"><code class="prettyprint">RelationThrough</code></a></td>
<td>Describes the join table if the models are related through one.</td>
</tr>
</tbody></table>

<h5 id="relationthrough">RelationThrough</h5>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>from</td>
<td>string&#124;<a href="#ref"><code class="prettyprint">ReferenceBuilder</code></a>&#124;Array</td>
<td>The column that is joined to <code class="prettyprint">from</code> property of the <code class="prettyprint">RelationJoin</code>. For example <code class="prettyprint">Person_movies.actorId</code> where <code class="prettyprint">Person_movies</code> is the join table. Composite key can be specified using an array of columns e.g. <code class="prettyprint">[&#39;persons_movies.a&#39;, &#39;persons_movies.b&#39;]</code>. You can join nested json fields using the <a href="#ref"><code class="prettyprint">ref</code></a> helper.</td>
</tr>
<tr>
<td>to</td>
<td>string&#124;<a href="#ref"><code class="prettyprint">ReferenceBuilder</code></a>&#124;Array</td>
<td>The column that is joined to <code class="prettyprint">to</code> property of the <code class="prettyprint">RelationJoin</code>. For example <code class="prettyprint">Person_movies.movieId</code> where <code class="prettyprint">Person_movies</code> is the join table. Composite key can be specified using an array of columns e.g. <code class="prettyprint">[&#39;persons_movies.a&#39;, &#39;persons_movies.b&#39;]</code>. You can join nested json fields using the <a href="#ref"><code class="prettyprint">ref</code></a> helper.</td>
</tr>
<tr>
<td>modelClass</td>
<td>string&#124;ModelClass</td>
<td>If you have a model class for the join table, you should specify it here. This is optional so you don&rsquo;t need to create a model class if you don&rsquo;t want to.</td>
</tr>
<tr>
<td>extra</td>
<td>string[]&#124;Object</td>
<td>Columns listed here are automatically joined to the related objects when they are fetched and automatically written to the join table instead of the related table on insert. The values can be aliased by providing an object <code class="prettyprint">{propertyName: &#39;columnName&#39;, otherPropertyName: &#39;otherColumnName&#39;} instead of array</code></td>
</tr>
<tr>
<td>beforeInsert</td>
<td>function(<a href="#model"><code class="prettyprint">Model</code></a>, <a href="#context"><code class="prettyprint">QueryContext</code></a>)</td>
<td>Optional insert hook that is called for each inserted join table model instance. This function can be async.</td>
</tr>
</tbody></table>

<h4 id="jsonattributes">jsonAttributes</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">jsonAttributes</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">'someProp'</span><span class="p">,</span> <span class="s1">'someOtherProp'</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>ESNext:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">jsonAttributes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'someProp'</span><span class="p">,</span> <span class="s1">'someOtherProp'</span><span class="p">];</span>
<span class="p">}</span>
</code></pre>
<p>Properties that should be saved to database as JSON strings.</p>

<p>The properties listed here are serialized to JSON strings upon insertion/update to the database
and parsed back to objects when models are read from the database. Combined with the
postgresql&rsquo;s json or jsonb data type, this is a powerful way of representing documents
as single database rows.</p>

<p>If this property is left unset all properties declared as objects or arrays in the
<a href="#jsonschema"><code class="prettyprint">jsonSchema</code></a> are implicitly added to this list.</p>

<h4 id="columnnamemappers">columnNameMappers</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">Model</span><span class="p">,</span> <span class="nx">snakeCaseMappers</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>

<span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">columnNameMappers</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">snakeCaseMappers</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>ESNext</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">Model</span><span class="p">,</span> <span class="nx">snakeCaseMappers</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'objection'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">columnNameMappers</span> <span class="o">=</span> <span class="nx">snakeCaseMappers</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>The mapper signature:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">columnNameMappers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">parse</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// database --&gt; code</span>
    <span class="p">},</span>

    <span class="nx">format</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// code --&gt; database</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre>
<p>The mappers to use to convert column names to property names in code.</p>

<h4 id="relatedfindquerymutates">relatedFindQueryMutates</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">relatedFindQueryMutates</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>If this config is set to false, calling <code class="prettyprint">foo.$relatedQuery(&#39;bar&#39;)</code> doesn&rsquo;t assign the fetched related models to <code class="prettyprint">foo.bar</code>.
The default is true.</p>

<h4 id="relatedinsertquerymutates">relatedInsertQueryMutates</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">relatedInsertQueryMutates</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>If this config is set to false, calling <code class="prettyprint">foo.$relatedQuery(&#39;bar&#39;).insert(obj)</code> doesn&rsquo;t append the inserted related model to <code class="prettyprint">foo.bar</code>.
The default is true.</p>

<h4 id="virtualattributes">virtualAttributes</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">virtualAttributes</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">'fullName'</span><span class="p">,</span> <span class="s1">'isFemale'</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="nx">fullName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">firstName</span><span class="p">}</span><span class="s2"> </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">lastName</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">get</span> <span class="nx">isFemale</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">gender</span> <span class="o">===</span> <span class="s1">'female'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">fromJson</span><span class="p">({</span>
  <span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">,</span>
  <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Aniston'</span><span class="p">,</span>
  <span class="na">gender</span><span class="p">:</span> <span class="s1">'female'</span>
<span class="p">});</span>

<span class="c1">// Note that `toJSON` is always called automatically when an object is serialized</span>
<span class="c1">// to a JSON string using JSON.stringify. You very rarely need to call `toJSON`</span>
<span class="c1">// explicitly. koa, express and all other frameworks I'm aware of use JSON.stringify</span>
<span class="c1">// to serialize objects to JSON.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">person</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span>
<span class="c1">// --&gt; {"firstName": "Jennifer", "lastName": "Aniston", "isFemale": true, "fullName": "Jennifer Aniston"}</span>
</code></pre>
<blockquote>
<p>ESNext:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">virtualAttributes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'fullName'</span><span class="p">,</span> <span class="s1">'isFemale'</span><span class="p">];</span>

  <span class="nx">fullName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">firstName</span><span class="p">}</span><span class="s2"> </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">lastName</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">get</span> <span class="nx">isFemale</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">gender</span> <span class="o">===</span> <span class="s1">'female'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">fromJson</span><span class="p">({</span>
  <span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">,</span>
  <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Aniston'</span><span class="p">,</span>
  <span class="na">gender</span><span class="p">:</span> <span class="s1">'female'</span>
<span class="p">});</span>

<span class="c1">// Note that `toJSON` is always called automatically when an object is serialized</span>
<span class="c1">// to a JSON string using JSON.stringify. You very rarely need to call `toJSON`</span>
<span class="c1">// explicitly. koa, express and all other frameworks I'm aware of use JSON.stringify</span>
<span class="c1">// to serialize objects to JSON.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">person</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span>
<span class="c1">// --&gt; {"firstName": "Jennifer", "lastName": "Aniston", "isFemale": true, "fullName": "Jennifer Aniston"}</span>
</code></pre>
<p>Getters and methods listed here are serialized with real properties when <code class="prettyprint">toJSON</code> is called.</p>

<p>The virtual values are not written to database. Only the &ldquo;external&rdquo; JSON format will contain them.</p>

<h4 id="uidprop">uidProp</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">uidProp</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'#id'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>ESNext:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">uidProp</span> <span class="o">=</span> <span class="s1">'#id'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Name of the property used to store a temporary non-db identifier for the model.</p>

<p>NOTE: You cannot use any of the model&rsquo;s properties as <code class="prettyprint">uidProp</code>. For example if your
model has a property <code class="prettyprint">id</code>, you cannot set <code class="prettyprint">uidProp = &#39;id&#39;</code>.</p>

<p>Defaults to &rsquo;#id&rsquo;.</p>

<h4 id="uidrefprop">uidRefProp</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">uidRefProp</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'#ref'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>ESNext:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">uidRefProp</span> <span class="o">=</span> <span class="s1">'#ref'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Name of the property used to store a reference to a <a href="#uidprop"><code class="prettyprint">uidProp</code></a></p>

<p>NOTE: You cannot use any of the model&rsquo;s properties as <code class="prettyprint">uidRefProp</code>. For example if your
model has a property <code class="prettyprint">ref</code>, you cannot set <code class="prettyprint">uidRefProp = &#39;ref&#39;</code>.</p>

<p>Defaults to &rsquo;#ref&rsquo;.</p>

<h4 id="dbrefprop">dbRefProp</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">dbRefProp</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'#dbRef'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>ESNext:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">dbRefProp</span> <span class="o">=</span> <span class="s1">'#dbRef'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Name of the property used to point to an existing database row from an <code class="prettyprint">insertGraph</code> graph.</p>

<p>NOTE: You cannot use any of the model&rsquo;s properties as <code class="prettyprint">dbRefProp</code>. For example if your
model has a property <code class="prettyprint">id</code>, you cannot set <code class="prettyprint">dbRefProp = &#39;id&#39;</code>.</p>

<p>Defaults to &rsquo;#dbRef&rsquo;.</p>

<h4 id="proprefregex">propRefRegex</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">propRefRegex</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="sr">/#ref{</span><span class="se">([^\.]</span><span class="sr">+</span><span class="se">)\.([^</span><span class="sr">}</span><span class="se">]</span><span class="sr">+</span><span class="se">)</span><span class="sr">}/g</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>ESNext:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">propRefRegex</span> <span class="o">=</span> <span class="sr">/#ref{</span><span class="se">([^\.]</span><span class="sr">+</span><span class="se">)\.([^</span><span class="sr">}</span><span class="se">]</span><span class="sr">+</span><span class="se">)</span><span class="sr">}/g</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Regular expression for parsing a reference to a property.</p>

<p>Defaults to <code class="prettyprint">/#ref{([^\.]+)\.([^}]+)}/g</code>.</p>

<h4 id="pickjsonschemaproperties">pickJsonSchemaProperties</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">pickJsonSchemaProperties</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>ESNext:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">pickJsonSchemaProperties</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>If this is true only properties in <code class="prettyprint">jsonSchema</code> are picked when inserting or updating a row
in the database.</p>

<p>Defaults to false.</p>

<h4 id="defaulteageralgorithm">defaultEagerAlgorithm</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">defaultEagerAlgorithm</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">WhereInEagerAlgorithm</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>ESNext:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">defaultEagerAlgorithm</span> <span class="o">=</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">WhereInEagerAlgorithm</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Sets the default eager loading algorithm for this model. Must be either
<code class="prettyprint">Model.WhereInEagerAlgorithm</code> or <code class="prettyprint">Model.JoinEagerAlgorithm</code>.</p>

<p>Defaults to <code class="prettyprint">Model.WhereInEagerAlgorithm</code>.</p>

<h4 id="defaulteageroptions">defaultEagerOptions</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">defaultEagerOptions</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">minimize</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">separator</span><span class="p">:</span> <span class="s1">'-&gt;'</span><span class="p">,</span>
      <span class="na">aliases</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>ESNext:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">defaultEagerOptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">minimize</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">separator</span><span class="p">:</span> <span class="s1">'-&gt;'</span><span class="p">,</span>
    <span class="na">aliases</span><span class="p">:</span> <span class="p">{}</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre>
<p>Sets the default options for eager loading algorithm. See the possible
fields <a href="#eageroptions">here</a>.</p>

<p>Defaults to <code class="prettyprint">{minimize: false, separator: &#39;:&#39;, aliases: {}}</code>.</p>

<h4 id="namedfilters">namedFilters</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Movie</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">namedFilters</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">goodMovies</span><span class="p">:</span> <span class="p">(</span><span class="nx">builder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'stars'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
      <span class="na">orderByName</span><span class="p">:</span> <span class="p">(</span><span class="nx">builder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Animal</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">namedFilters</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">dogs</span><span class="p">:</span> <span class="p">(</span><span class="nx">builder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'species'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">)</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>The named filters can be used in any eager query:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'[movies(goodMovies, orderByName).actors, pets(dogs)]'</span><span class="p">)</span>
</code></pre>
<p>Named filters that can be used in any eager query and by the <a href="#applyfilter"><code class="prettyprint">applyFilter</code></a> method.</p>

<h4 id="uselimitinfirst">useLimitInFirst</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Animal</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">useLimitInFirst</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>If true, <code class="prettyprint">limit(1)</code> is added to the query when <code class="prettyprint">first()</code> is called. Defaults to <code class="prettyprint">false</code>.</p>

<h4 id="querybuilder">QueryBuilder</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">QueryBuilder</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">MyCustomQueryBuilder</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>ESNext:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">QueryBuilder</span> <span class="o">=</span> <span class="nx">MyCustomQueryBuilder</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a> subclass to use in <a href="#query"><code class="prettyprint">query</code></a> or <a href="#_s_query"><code class="prettyprint">$query</code></a> methods.</p>

<p>This constructor is used whenever a query builder is created using <a href="#query"><code class="prettyprint">query</code></a> or <a href="#_s_query"><code class="prettyprint">$query</code></a> methods.
You can override this to use your own <a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a> subclass.</p>

<p><a href="#custom-query-builder">Usage example</a>.</p>

<h3 id="static-methods">Static methods</h3>

<h4 id="query">query</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">queryBuilder</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">transactionOrKnex</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Read models from the database:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="c1">// Get all rows.</span>
<span class="kr">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'there are'</span><span class="p">,</span> <span class="nx">people</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="s1">'people in the database'</span><span class="p">);</span>

<span class="c1">// Example of a more complex WHERE clause. This generates:</span>
<span class="c1">// SELECT "persons".*</span>
<span class="c1">// FROM "persons"</span>
<span class="c1">// WHERE ("firstName" = 'Jennifer' AND "age" &lt; 30)</span>
<span class="c1">// OR ("firstName" = 'Mark' AND "age" &gt; 30)</span>
<span class="kr">const</span> <span class="nx">marksAndJennifers</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">builder</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">builder</span>
      <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'firstName'</span><span class="p">,</span> <span class="s1">'Jennifer'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'&lt;'</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">orWhere</span><span class="p">(</span><span class="nx">builder</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">builder</span>
      <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'firstName'</span><span class="p">,</span> <span class="s1">'Mark'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
  <span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">marksAndJennifers</span><span class="p">);</span>


<span class="c1">// Get a subset of rows and fetch related models</span>
<span class="c1">// for each row.</span>
<span class="kr">const</span> <span class="nx">oldPeople</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'children.children.movies'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'some old person\'s grand child has appeared in'</span><span class="p">,</span>
  <span class="nx">oldPeople</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">movies</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
  <span class="s1">'movies'</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Insert models to the database:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">sylvester</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Sylvester'</span><span class="p">,</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Stallone'</span><span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">sylvester</span><span class="p">.</span><span class="nx">fullName</span><span class="p">());</span>
<span class="c1">// --&gt; 'Sylvester Stallone'.</span>

<span class="c1">// Batch insert. This only works on Postgresql as it is</span>
<span class="c1">// the only database that returns the identifiers of</span>
<span class="c1">// _all_ inserted rows. If you need to do batch inserts</span>
<span class="c1">// on other databases useknex* directly.</span>
<span class="c1">// (See .knexQuery() method).</span>
<span class="kr">const</span> <span class="nx">inserted</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">insert</span><span class="p">([</span>
    <span class="p">{</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Arnold'</span><span class="p">,</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Schwarzenegger'</span><span class="p">},</span>
    <span class="p">{</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Sylvester'</span><span class="p">,</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Stallone'</span><span class="p">}</span>
  <span class="p">]);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">inserted</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">fullName</span><span class="p">());</span> <span class="c1">// --&gt; 'Arnold Schwarzenegger'</span>
</code></pre>
<blockquote>
<p><code class="prettyprint">update</code> and <code class="prettyprint">patch</code> can be used to update models. Only difference between the mentioned methods
is that <code class="prettyprint">update</code> validates the input objects using the model class&rsquo;s full jsonSchema and <code class="prettyprint">patch</code>
ignores the <code class="prettyprint">required</code> property of the schema. Use <code class="prettyprint">update</code> when you want to update <em>all</em> properties
of a model and <code class="prettyprint">patch</code> when only a subset should be updated.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">numUpdatedRows</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">,</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">35</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="nx">jennifer</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">numUpdatedRows</span><span class="p">);</span>

<span class="c1">// This will throw assuming that `firstName` or `lastName`</span>
<span class="c1">// is a required property for a Person.</span>
<span class="nx">await</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">update</span><span class="p">({</span><span class="na">age</span><span class="p">:</span> <span class="mi">100</span><span class="p">});</span>

<span class="c1">// This will _not_ throw.</span>
<span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">patch</span><span class="p">({</span><span class="na">age</span><span class="p">:</span> <span class="mi">100</span><span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Everyone is now 100 years old'</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Models can be deleted using the delete method. Naturally the delete query can be chained with
any knex* methods:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="k">delete</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="mi">90</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'anyone over 90 is now removed from the database'</span><span class="p">);</span>
</code></pre>
<p>Creates a query builder for the model&rsquo;s table.</p>

<p>All query builders are created using this function, including $query, $relatedQuery and relatedQuery.
That means you can modify each query by overriding this method for your model class. This is especially
useful when combined with the use of <a href="#onbuild"><code class="prettyprint">onBuild</code></a>.</p>

<p>See the <a href="#query-examples">query examples</a> section for more examples.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>transactionOrKnex</td>
<td>object</td>
<td>Optional transaction or knex instance for the query. This can be used to specify a transaction or even a different database. for a query. Falsy values are ignored.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td>The created query builder</td>
</tr>
</tbody></table>

<h4 id="relatedquery">relatedQuery</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">queryBuilder</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">relatedQuery</span><span class="p">(</span><span class="nx">relationName</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Select count of a relation and the maximum value of another one:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">select</span><span class="p">([</span>
    <span class="s1">'persons.*'</span><span class="p">,</span>

    <span class="nx">Person</span><span class="p">.</span><span class="nx">relatedQuery</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">count</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'species'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">as</span><span class="p">(</span><span class="s1">'dogCount'</span><span class="p">),</span>

    <span class="nx">Person</span><span class="p">.</span><span class="nx">relatedQuery</span><span class="p">(</span><span class="s1">'movies'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="s1">'createdAt'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">as</span><span class="p">(</span><span class="s1">'mostRecentMovieDate'</span><span class="p">)</span>
  <span class="p">]);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">dogCount</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">mostRecentMovieDate</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Find models that have at least one item in a relation:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">peopleThatHavePets</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">whereExists</span><span class="p">(</span><span class="nx">Person</span><span class="p">.</span><span class="nx">relatedQuery</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">));</span>
</code></pre>
<blockquote>
<p>Generates something like this:</p>
</blockquote>
<pre class="highlight sql"><code><span class="k">select</span> <span class="nv">"persons"</span><span class="p">.</span><span class="o">*</span> <span class="k">from</span> <span class="nv">"persons"</span> <span class="k">where</span> <span class="k">exists</span> <span class="p">(</span><span class="k">select</span> <span class="nv">"pets"</span><span class="p">.</span><span class="o">*</span> <span class="k">from</span> <span class="nv">"animals"</span> <span class="k">as</span> <span class="nv">"pets"</span> <span class="k">where</span> <span class="nv">"pets"</span><span class="p">.</span><span class="nv">"ownerId"</span> <span class="o">=</span> <span class="nv">"persons"</span><span class="p">.</span><span class="nv">"id"</span><span class="p">)</span>
</code></pre>
<p>Creates a subquery to a relation.</p>

<p>This query can only be used as a subquery and therefore there is no need to ever pass
a transaction or a knex instance to it. It will always inherit its parent query&rsquo;s
transaction because it is compiled and executed as a part of the parent query.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>relationName</td>
<td>string</td>
<td>The name of the relation to create subquery for.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td>The created query builder</td>
</tr>
</tbody></table>

<h4 id="knex">knex</h4>

<blockquote>
<p>Get:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">knex</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">knex</span><span class="p">();</span>
</code></pre>
<blockquote>
<p>Set:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kd">let</span> <span class="nx">knex</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'knex'</span><span class="p">)({</span>
  <span class="na">client</span><span class="p">:</span> <span class="s1">'sqlite3'</span><span class="p">,</span>
  <span class="na">connection</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">filename</span><span class="p">:</span> <span class="s1">'database.db'</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">Model</span><span class="p">.</span><span class="nx">knex</span><span class="p">(</span><span class="nx">knex</span><span class="p">);</span>
<span class="nx">knex</span> <span class="o">=</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">knex</span><span class="p">();</span>
</code></pre>
<p>Get/Set the knex instance for this model class.</p>

<p>Subclasses inherit the connection. A system-wide knex instance can thus be set by calling
<code class="prettyprint">objection.Model.knex(knex)</code>. This works even after subclasses have been created.</p>

<p>See <a href="#bindknex"><code class="prettyprint">bindKnex</code></a> method if you want to use multiple databases in the same
application.</p>

<h4 id="raw">raw</h4>

<p>Shortcut for <code class="prettyprint">Person.knex().raw(...args)</code></p>

<h4 id="fn">fn</h4>

<p>Shortcut for <code class="prettyprint">Person.knex().fn</code></p>

<h4 id="knexquery">knexQuery</h4>

<p>Shortcut for <code class="prettyprint">Person.knex().table(Person.tableName)</code></p>

<h4 id="bindknex">bindKnex</h4>

<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">knex1</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'knex'</span><span class="p">)({</span>
  <span class="na">client</span><span class="p">:</span> <span class="s1">'sqlite3'</span><span class="p">,</span>
  <span class="na">connection</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">filename</span><span class="p">:</span> <span class="s1">'database1.db'</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kr">const</span> <span class="nx">knex2</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'knex'</span><span class="p">)({</span>
  <span class="na">client</span><span class="p">:</span> <span class="s1">'sqlite3'</span><span class="p">,</span>
  <span class="na">connection</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">filename</span><span class="p">:</span> <span class="s1">'database2.db'</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">SomeModel</span><span class="p">.</span><span class="nx">knex</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">BoundModel1</span> <span class="o">=</span> <span class="nx">SomeModel</span><span class="p">.</span><span class="nx">bindKnex</span><span class="p">(</span><span class="nx">knex1</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">BoundModel2</span> <span class="o">=</span> <span class="nx">SomeModel</span><span class="p">.</span><span class="nx">bindKnex</span><span class="p">(</span><span class="nx">knex2</span><span class="p">);</span>

<span class="c1">// Throws since the knex instance is null.</span>
<span class="nx">await</span> <span class="nx">SomeModel</span><span class="p">.</span><span class="nx">query</span><span class="p">();</span>

<span class="c1">// Works.</span>
<span class="kr">const</span> <span class="nx">models</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">BoundModel1</span><span class="p">.</span><span class="nx">query</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nx">SomeModel</span><span class="p">);</span> <span class="c1">// --&gt; true</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nx">BoundModel1</span><span class="p">);</span> <span class="c1">// --&gt; true</span>

<span class="c1">// Works.</span>
<span class="kr">const</span> <span class="nx">models</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">BoundModel2</span><span class="p">.</span><span class="nx">query</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nx">SomeModel</span><span class="p">);</span> <span class="c1">// --&gt; true</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nx">BoundModel2</span><span class="p">);</span> <span class="c1">// --&gt; true</span>
</code></pre>
<p>Creates an anonymous subclass of this class that is bound to the given knex.</p>

<p>This method can be used to bind a Model subclass to multiple databases for example in
a multi-tenant system. See the <a href="#multi-tenancy">multi tenancy recipe</a> for more info.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>knex</td>
<td>Knex</td>
<td>knex connection to bind to</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>function</td>
<td>The create model subclass constructor</td>
</tr>
</tbody></table>

<h4 id="bindtransaction">bindTransaction</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">transaction</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">Person</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./models/Person'</span><span class="p">);</span>

<span class="nx">await</span> <span class="nx">transaction</span><span class="p">(</span><span class="nx">Person</span><span class="p">.</span><span class="nx">knex</span><span class="p">(),</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">trx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">TransactingPerson</span> <span class="o">=</span>  <span class="nx">Person</span><span class="p">.</span><span class="nx">bindTransaction</span><span class="p">(</span><span class="nx">trx</span><span class="p">);</span>

  <span class="nx">await</span> <span class="nx">TransactingPerson</span>
    <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">});</span>

  <span class="k">return</span> <span class="nx">TransactingPerson</span>
    <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">patch</span><span class="p">({</span><span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="nx">jennifer</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
<p>Alias for <a href="#bindknex"><code class="prettyprint">bindKnex</code></a>.</p>

<h4 id="fromjson">fromJson</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">fromJson</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">opt</span><span class="p">);</span>
</code></pre>
<p>Creates a model instance from a JSON object.</p>

<p>The object is checked against <a href="#jsonschema"><code class="prettyprint">jsonSchema</code></a> and an exception is thrown on failure.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>json</td>
<td>Object</td>
<td>The JSON object from which to create the model.</td>
</tr>
<tr>
<td>opt</td>
<td><a href="#modeloptions">ModelOptions</a></td>
<td>Update options.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#model"><code class="prettyprint">Model</code></a></td>
<td>The created model instance</td>
</tr>
</tbody></table>

<h4 id="fromdatabasejson">fromDatabaseJson</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">fromDatabaseJson</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
</code></pre>
<p>Creates a model instance from a JSON object in database format.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>row</td>
<td>Object</td>
<td>A database row.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#model"><code class="prettyprint">Model</code></a></td>
<td>The created model instance</td>
</tr>
</tbody></table>

<h4 id="createvalidator">createValidator</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">BaseModel</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">createValidator</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">MyCustomValidator</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Sharing the same validator between model classes is also possible:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">validator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCustomValidator</span><span class="p">();</span>

<span class="kr">class</span> <span class="nx">BaseModel</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">createValidator</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">validator</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>The default implementation:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">AjvValidator</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">).</span><span class="nx">AjvValidator</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">createValidator</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">AjvValidator</span><span class="p">({</span>
      <span class="na">onCreateAjv</span><span class="p">:</span> <span class="p">(</span><span class="nx">ajv</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// Here you can modify the `Ajv` instance.</span>
      <span class="p">},</span>
      <span class="na">options</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">allErrors</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">validateSchema</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">ownProperties</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">v5</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Creates an instance of a <a href="#validator"><code class="prettyprint">Validator</code></a> that is used to do
all validation related stuff. This method is called only once per
model class.</p>

<p>You can override this method to return an instance of your custom
validator. The custom validator doesn&rsquo;t need to be based on the
<code class="prettyprint">jsonSchema</code>. It can be anything at all as long as it implements the
<a href="#validator"><code class="prettyprint">Validator</code></a> interface.</p>

<p>If you want to use the default json schema based <a href="#ajvvalidator"><code class="prettyprint">AjvValidator</code></a> but
want to modify it, you can use the <code class="prettyprint">objection.AjvValidator</code> constructor. See
the default implementation example.</p>

<p>If you want to share the same validator instance between multiple models, that&rsquo;s
completely fine too. Simply implement <code class="prettyprint">createValidator</code> so that it always returns
the same object instead of creating a new one.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#validator"><code class="prettyprint">Validator</code></a></td>
<td>The created validator instance</td>
</tr>
</tbody></table>

<h4 id="createnotfounderror">createNotFoundError</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">BaseModel</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">createNotFoundError</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">MyCustomNotFoundError</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>The default implementation:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">createNotFoundError</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">NotFoundError</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Creates an error thrown by <a href="#throwifnotfound"><code class="prettyprint">throwIfNotFound()</code></a> method. You can override this
to throw any error you want.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>queryContext</td>
<td>Object</td>
<td>The context object of query that produced the empty result. See <a href="#context"><code class="prettyprint">context</code></a>.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">Error</code></td>
<td>The created error. <a href="#notfounderror"><code class="prettyprint">Model.NotFoundError</code></a> by default.</td>
</tr>
</tbody></table>

<h4 id="createvalidationerror">createValidationError</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">BaseModel</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">createValidationError</span><span class="p">({</span><span class="nx">type</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">data</span><span class="p">})</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">MyCustomValidationError</span><span class="p">({</span><span class="nx">type</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">data</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>The default implementation:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">ValidationError</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">);</span>

<span class="kr">class</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">createValidationError</span><span class="p">({</span><span class="nx">type</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">data</span><span class="p">})</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">ValidationError</span><span class="p">({</span><span class="nx">type</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">data</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Creates an error thrown when validation fails for a model. You can override this
to throw any error you want. The errors created by this function don&rsquo;t have to
implement any interface or have the same properties as <code class="prettyprint">ValidationError</code>. Objection
only throws errors created by this function an never catches them.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">Error</code></td>
<td>The created error. <a href="#validationerror"><code class="prettyprint">ValidationError</code></a> by default.</td>
</tr>
</tbody></table>

<h4 id="omitimpl">omitImpl</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">omitImpl</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">delete</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Omit implementation to use.</p>

<p>The default implementation <code class="prettyprint">delete</code>s the property.</p>

<h4 id="loadrelated">loadRelated</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">loadRelated</span><span class="p">(</span><span class="nx">models</span><span class="p">,</span> <span class="nx">expression</span><span class="p">,</span> <span class="nx">filters</span><span class="p">,</span> <span class="nx">transactionOrKnex</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Examples:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">loadRelated</span><span class="p">([</span><span class="nx">person1</span><span class="p">,</span> <span class="nx">person2</span><span class="p">],</span> <span class="s1">'children.pets'</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">person1</span> <span class="o">=</span> <span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="kr">const</span> <span class="nx">person2</span> <span class="o">=</span> <span class="nx">people</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</code></pre>
<blockquote>
<p>Relations can be filtered by giving named filter functions as arguments to the relations:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">loadRelated</span><span class="p">([</span><span class="nx">person1</span><span class="p">,</span> <span class="nx">person2</span><span class="p">],</span> <span class="s1">'children(orderByAge).[pets(onlyDogs, orderByName), movies]'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">orderByAge</span><span class="p">:</span> <span class="p">(</span><span class="nx">builder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">builder</span><span class="p">.</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">'age'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">orderByName</span><span class="p">:</span> <span class="p">(</span><span class="nx">builder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">builder</span><span class="p">.</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">onlyDogs</span><span class="p">:</span> <span class="p">(</span><span class="nx">builder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">builder</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'species'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">children</span><span class="p">.</span><span class="nx">pets</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</code></pre>
<p>Load related models for a set of models using a <a href="#relationexpression"><code class="prettyprint">RelationExpression</code></a>.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>models</td>
<td>Array.&lt;<a href="#model"><code class="prettyprint">Model</code></a>&#124;Object&gt;</td>
<td></td>
</tr>
<tr>
<td>expression</td>
<td>string&#124;<a href="#relationexpression"><code class="prettyprint">RelationExpression</code></a></td>
<td>The relation expression</td>
</tr>
<tr>
<td>filters</td>
<td>Object.&lt;string, function(<a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a>)&gt;</td>
<td>Optional named filters</td>
</tr>
<tr>
<td>transactionOrKnex</td>
<td>object</td>
<td>Optional transaction or knex instance for the query. This can be used to specify a transaction or even a different database.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td>The created query builder</td>
</tr>
</tbody></table>

<h4 id="traverse">traverse</h4>

<blockquote>
<p>There are two ways to call this method:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Model</span><span class="p">.</span><span class="nx">traverse</span><span class="p">(</span><span class="nx">models</span><span class="p">,</span> <span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">parentModel</span><span class="p">,</span> <span class="nx">relationName</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">doSomething</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
<p>and</p>
<pre class="highlight javascript"><code><span class="nx">Model</span><span class="p">.</span><span class="nx">traverse</span><span class="p">(</span><span class="nx">Person</span><span class="p">,</span> <span class="nx">models</span><span class="p">,</span> <span class="p">(</span><span class="nx">person</span><span class="p">,</span> <span class="nx">parentModel</span><span class="p">,</span> <span class="nx">relationName</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">doSomethingForPerson</span><span class="p">(</span><span class="nx">person</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
<p>Traverses the relation tree of a list of models.</p>

<p>Calls the callback for each related model recursively. The callback is called
also for the input models themselves.</p>

<p>In the second example the traverser function is only called for <code class="prettyprint">Person</code> instances.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>filterConstructor</td>
<td>function</td>
<td>If this optional constructor is given, the <code class="prettyprint">traverser</code> is only called for models for which <code class="prettyprint">model instanceof filterConstructor</code> returns true.</td>
</tr>
<tr>
<td>models</td>
<td><a href="#model"><code class="prettyprint">Model</code></a>&#124;<a href="#model"><code class="prettyprint">Model</code></a>[]</td>
<td>The model(s) whose relation trees to traverse.</td>
</tr>
<tr>
<td>traverser</td>
<td>function(<a href="#model"><code class="prettyprint">Model</code></a>, string, string)</td>
<td>The traverser function that is called for each model. The first argument is the model itself. If the model is in a relation of some other model the second argument is the parent model and the third argument is the name of the relation.</td>
</tr>
</tbody></table>

<h4 id="getrelations">getRelations</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">relations</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">getRelations</span><span class="p">();</span>
</code></pre>
<p>Returns a <a href="#relation"><code class="prettyprint">Relation</code></a> object for each relation defined in <a href="#relationmappings"><code class="prettyprint">relationMappings</code></a>.</p>

<p>This method is mainly useful for plugin developers and for other generic usages.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Object.&lt;string, <a href="#relation"><code class="prettyprint">Relation</code></a>&gt;</td>
<td>Object whose keys are relation names and values are <a href="#relation"><code class="prettyprint">Relation</code></a> instances.</td>
</tr>
</tbody></table>

<h4 id="columnnametopropertyname">columnNameToPropertyName</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">propertyName</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">columnNameToPropertyName</span><span class="p">(</span><span class="nx">columnName</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>For example, if you have defined <code class="prettyprint">columnNameMappers = snakeCaseMappers()</code> for your model:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">propName</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">columnNameToPropertyName</span><span class="p">(</span><span class="s1">'foo_bar'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">propName</span><span class="p">);</span> <span class="c1">// --&gt; 'fooBar'</span>
</code></pre>
<p>Runs the property through possible <code class="prettyprint">columnNameMappers</code> and <code class="prettyprint">$parseDatabaseJson</code> hooks to apply
any possible conversion for the column name.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>columnName</td>
<td>string</td>
<td>A column name</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>string</td>
<td>The property name</td>
</tr>
</tbody></table>

<h4 id="propertynametocolumnname">propertyNameToColumnName</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">columnName</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">propertyNameToColumnName</span><span class="p">(</span><span class="nx">propertyName</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>For example, if you have defined <code class="prettyprint">columnNameMappers = snakeCaseMappers()</code> for your model:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">columnName</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">propertyNameToColumnName</span><span class="p">(</span><span class="s1">'fooBar'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">columnName</span><span class="p">);</span> <span class="c1">// --&gt; 'foo_bar'</span>
</code></pre>
<p>Runs the property through possible <code class="prettyprint">columnNameMappers</code> and <code class="prettyprint">$formatDatabaseJson</code> hooks to apply
any possible conversion for the property name.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>propertyName</td>
<td>string</td>
<td>A property name</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>string</td>
<td>The column name</td>
</tr>
</tbody></table>

<h4 id="fetchtablemetadata">fetchTableMetadata</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">metadata</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">fetchTableMetadata</span><span class="p">(</span><span class="nx">opt</span><span class="p">);</span>
</code></pre>
<p>Fetches and caches the table metadata.</p>

<p>Most of the time objection doesn&rsquo;t need this metadata, but some methods like <code class="prettyprint">joinEager</code> do. This
method is called by objection when the metadata is needed. The result is cached and after the first
call the cached promise is returned and no queries are executed.</p>

<p>Because objection uses this on demand, the first query that needs this information can have
unpredicable performance. If that&rsquo;s a problem, you can call this method for each of your models
during your app&rsquo;s startup.</p>

<p>If you&rsquo;ve implemented <a href="#tablemetadata"><code class="prettyprint">tableMetadata</code></a> method to return a custom metadata object,
this method doesn&rsquo;t execute database queries, but returns <code class="prettyprint">Promise.resolve(this.tableMetadata())</code>
instead.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>opt</td>
<td><a href="#tablemetadatafetchoptions"><code class="prettyprint">TableMetadataFetchOptions</code></a></td>
<td>Optional options</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Promise&lt;<a href="#tablemetadata-prop"><code class="prettyprint">TableMetadata</code></a>&gt;</td>
<td>The table metadata object</td>
</tr>
</tbody></table>

<h4 id="tablemetadata">tableMetadata</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">metadata</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">tableMetadata</span><span class="p">(</span><span class="nx">opt</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>A custom override that uses the property information in <code class="prettyprint">jsonSchema</code>.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">tableMetadata</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">columns</span><span class="p">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">jsonSchema</span><span class="p">.</span><span class="nx">properties</span><span class="p">)</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Synchronously returns the table metadata object from the cache.</p>

<p>You can override this method to return a custom object if you don&rsquo;t want objection to use
<a href="#fetchtablemetadata"><code class="prettyprint">fetchTableMetadata</code></a>.</p>

<p>See <a href="#fetchtablemetadata"><code class="prettyprint">fetchTableMetadata</code></a> for more information.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>opt</td>
<td><a href="#tablemetadataoptions"><code class="prettyprint">TableMetadataOptions</code></a></td>
<td>Optional options</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#tablemetadata-prop"><code class="prettyprint">TableMetadata</code></a></td>
<td>The table metadata object</td>
</tr>
</tbody></table>

<h3 id="instance-methods">Instance methods</h3>

<h4 id="id">$id</h4>
<pre class="highlight javascript"><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">$id</span><span class="p">());</span> <span class="c1">// -&gt; 100</span>
<span class="c1">// Sets the id.</span>
<span class="nx">model</span><span class="p">.</span><span class="nx">$id</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Composite key</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">$id</span><span class="p">());</span> <span class="c1">// -&gt; [100, 20, 30]</span>
<span class="c1">// Sets the id.</span>
<span class="nx">model</span><span class="p">.</span><span class="nx">$id</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]);</span>
</code></pre>
<p>Returns or sets the identifier of a model instance.</p>

<p>The identifier property does not have to be accessed or set using this method.
If the identifier property is known it can be accessed or set just like any
other property.</p>

<h4 id="beforevalidate">$beforeValidate</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">$beforeValidate</span><span class="p">(</span><span class="nx">jsonSchema</span><span class="p">,</span> <span class="nx">json</span><span class="p">,</span> <span class="nx">opt</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">jsonSchema</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>This is called before validation.</p>

<p>You can add any additional validation to this method. If validation fails, simply throw an exception and
the query will be rejected. If you modify the <code class="prettyprint">jsonSchema</code> argument and return it, that one will be used
to validate the model.</p>

<p><code class="prettyprint">opt.old</code> object contains the old values while <code class="prettyprint">json</code> contains the new values if validation is being done
for an existing object.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>jsonSchema</td>
<td>Object</td>
<td>A deep clone of this class&rsquo;s jsonSchema</td>
</tr>
<tr>
<td>json</td>
<td>Object</td>
<td>The JSON object to be validated</td>
</tr>
<tr>
<td>opt</td>
<td><a href="#modeloptions"><code class="prettyprint">ModelOptions</code></a></td>
<td>Optional options</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Object</td>
<td>The modified jsonSchema or the input jsonSchema.</td>
</tr>
</tbody></table>

<h4 id="validate">$validate</h4>
<pre class="highlight javascript"><code><span class="nx">modelInstance</span><span class="p">.</span><span class="nx">$validate</span><span class="p">();</span>
</code></pre>
<p>Validates the model instance.</p>

<p>Calls <a href="#_s_beforevalidate"><code class="prettyprint">$beforeValidate</code></a> and <a href="#_s_aftervalidate"><code class="prettyprint">$afterValidate</code></a> methods. This method is called
automatically from <a href="#fromjson"><code class="prettyprint">fromJson</code></a> and <a href="#_s_setjson"><code class="prettyprint">$setJson</code></a> methods. This method can also be
called explicitly when needed.</p>

<h5 id="throws">Throws</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#validationerror"><code class="prettyprint">ValidationError</code></a></td>
<td>If validation fails.</td>
</tr>
</tbody></table>

<h4 id="todatabasejson">$toDatabaseJson</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">row</span> <span class="o">=</span> <span class="nx">modelInstance</span><span class="p">.</span><span class="nx">$toDatabaseJson</span><span class="p">();</span>
</code></pre>
<p>Exports this model as a database JSON object.</p>

<p>This method is called internally to convert a model into a database row.</p>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Object</td>
<td>Database row.</td>
</tr>
</tbody></table>

<h4 id="tojson">$toJson</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">jsonObj</span> <span class="o">=</span> <span class="nx">modelInstance</span><span class="p">.</span><span class="nx">$toJson</span><span class="p">(</span><span class="nx">opt</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">shallowObj</span> <span class="o">=</span> <span class="nx">modelInstance</span><span class="p">.</span><span class="nx">$toJson</span><span class="p">({</span><span class="na">shallow</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">virtuals</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
</code></pre>
<p>Exports this model as a JSON object.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>opt</td>
<td><a href="#tojsonoptions"><code class="prettyprint">ToJsonOptions</code></a></td>
<td>Optional options</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Object</td>
<td>Model as a JSON object.</td>
</tr>
</tbody></table>

<h4 id="tojson">toJSON</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">jsonObj</span> <span class="o">=</span> <span class="nx">modelInstance</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">(</span><span class="nx">opt</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">shallowObj</span> <span class="o">=</span> <span class="nx">modelInstance</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">({</span><span class="na">shallow</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">virtuals</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
</code></pre>
<p>Exports this model as a JSON object.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>opt</td>
<td><a href="#tojsonoptions"><code class="prettyprint">ToJsonOptions</code></a></td>
<td>Optional options</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Object</td>
<td>Model as a JSON object.</td>
</tr>
</tbody></table>

<h4 id="aftervalidate">$afterValidate</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">$afterValidate</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">opt</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>This is called after successful validation.</p>

<p>You can do further validation here and throw a <a href="#validationerror"><code class="prettyprint">ValidationError</code></a> if something goes wrong.</p>

<p><code class="prettyprint">opt.old</code> object contains the old values while <code class="prettyprint">json</code> contains the new values if validation is being done
for an existing object.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>json</td>
<td>Object</td>
<td>The JSON object to be validated</td>
</tr>
<tr>
<td>opt</td>
<td><a href="#modeloptions"><code class="prettyprint">ModelOptions</code></a></td>
<td>Optional options</td>
</tr>
</tbody></table>

<h4 id="parsedatabasejson">$parseDatabaseJson</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">$parseDatabaseJson</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Remember to call the super class's implementation.</span>
    <span class="nx">json</span> <span class="o">=</span> <span class="kr">super</span><span class="p">.</span><span class="nx">$parseDatabaseJson</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
    <span class="c1">// Do your conversion here.</span>
    <span class="k">return</span> <span class="nx">json</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>This is called when a <a href="#model"><code class="prettyprint">Model</code></a> is created from a database JSON object.</p>

<p>Converts the JSON object from the database format to the internal format.</p>

<p>There are a couple of requirements for the implementation:</p>

<p>1. This function must be pure. It should&rsquo;t have any side effects because it is called
       from &ldquo;unexpected&rdquo; places (for example to determine if your model somehow transforms
       column names between db and code).</p>

<p>2. This function must be able to handle any subset of model&rsquo;s properties coming in.
       You cannot assume that some column is present in the <code class="prettyprint">json</code> object as it depends
       on the select statement. There can also be additional columns because of joins,
       aliases etc. This method must also be prepared for null values in <em>any</em> property
       of the <code class="prettyprint">json</code> object.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>json</td>
<td>Object</td>
<td>The JSON object in database format</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Object</td>
<td>The JSON object in internal format</td>
</tr>
</tbody></table>

<h4 id="formatdatabasejson">$formatDatabaseJson</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">$formatDatabaseJson</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Remember to call the super class's implementation.</span>
    <span class="nx">json</span> <span class="o">=</span> <span class="kr">super</span><span class="p">.</span><span class="nx">$formatDatabaseJson</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
    <span class="c1">// Do your conversion here.</span>
    <span class="k">return</span> <span class="nx">json</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>This is called when a <a href="#model"><code class="prettyprint">Model</code></a> is converted to database format.</p>

<p>Converts the JSON object from the internal format to the database format.</p>

<p>There are a couple of requirements for the implementation:</p>

<p>1. This function must be pure. It should&rsquo;t have any side effects because it is called
       from &ldquo;unexpected&rdquo; places (for example to determine if your model somehow transforms
       column names between db and code).</p>

<p>2. This function must be able to handle any subset of model&rsquo;s properties coming in.
       You cannot assume that some property is present in the <code class="prettyprint">json</code> object. There can
       also be additional properties. This method must also be prepared for null values
       in <em>any</em> property of the <code class="prettyprint">json</code> object.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>json</td>
<td>Object</td>
<td>The JSON object in internal format</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Object</td>
<td>The JSON object in database format</td>
</tr>
</tbody></table>

<h4 id="parsejson">$parseJson</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">$parseJson</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">opt</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Remember to call the super class's implementation.</span>
    <span class="nx">json</span> <span class="o">=</span> <span class="kr">super</span><span class="p">.</span><span class="nx">$parseJson</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">opt</span><span class="p">);</span>
    <span class="c1">// Do your conversion here.</span>
    <span class="k">return</span> <span class="nx">json</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>This is called when a <a href="#model"><code class="prettyprint">Model</code></a> is created from a JSON object.</p>

<p>Converts the JSON object from the external format to the internal format.</p>

<p>There are a couple of requirements for the implementation:</p>

<p>1. This function must be pure. It should&rsquo;t have any side effects because it is called
       from &ldquo;unexpected&rdquo; places (for example to determine if your model somehow transforms
       column names between db and code).</p>

<p>2. This function must be able to handle any subset of model&rsquo;s properties coming in.
       You cannot assume that some property is present in the <code class="prettyprint">json</code> object. There can
       also be additional properties. This method must also be prepared for null values
       in <em>any</em> property of the <code class="prettyprint">json</code> object.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>json</td>
<td>Object</td>
<td>The JSON object in external format</td>
</tr>
<tr>
<td>opt</td>
<td><a href="#modeloptions"><code class="prettyprint">ModelOptions</code></a></td>
<td>Optional options</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Object</td>
<td>The JSON object in internal format</td>
</tr>
</tbody></table>

<h4 id="formatjson">$formatJson</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">$formatJson</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Remember to call the super class's implementation.</span>
    <span class="nx">json</span> <span class="o">=</span> <span class="kr">super</span><span class="p">.</span><span class="nx">$formatJson</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
    <span class="c1">// Do your conversion here.</span>
    <span class="k">return</span> <span class="nx">json</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>This is called when a <a href="#model"><code class="prettyprint">Model</code></a> is converted to JSON.</p>

<p>Converts the JSON object from the internal format to the external format.</p>

<p>There are a couple of requirements for the implementation:</p>

<p>1. This function must be pure. It should&rsquo;t have any side effects because it is called
       from &ldquo;unexpected&rdquo; places (for example to determine if your model somehow transforms
       column names between db and code).</p>

<p>2. This function must be able to handle any subset of model&rsquo;s properties coming in.
       You cannot assume that some column is present in the <code class="prettyprint">json</code> object as it depends
       on the select statement. There can also be additional columns because of joins,
       aliases etc. This method must also be prepared for null values in <em>any</em> property
       of the <code class="prettyprint">json</code> object.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>json</td>
<td>Object</td>
<td>The JSON object in internal format</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Object</td>
<td>The JSON object in external format</td>
</tr>
</tbody></table>

<h4 id="setjson">$setJson</h4>
<pre class="highlight javascript"><code><span class="nx">modelInstance</span><span class="p">.</span><span class="nx">$setJson</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">opt</span><span class="p">);</span>
</code></pre>
<p>Sets the values from a JSON object.</p>

<p>Validates the JSON before setting values.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>json</td>
<td>Object</td>
<td>The JSON object to set</td>
</tr>
<tr>
<td>opt</td>
<td><a href="#modeloptions"><code class="prettyprint">ModelOptions</code></a></td>
<td>Optional options</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#model"><code class="prettyprint">Model</code></a></td>
<td><code class="prettyprint">this</code> for chaining</td>
</tr>
</tbody></table>

<h4 id="setdatabasejson">$setDatabaseJson</h4>
<pre class="highlight javascript"><code><span class="nx">modelInstance</span><span class="p">.</span><span class="nx">$setDatabaseJson</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
</code></pre>
<p>Sets the values from a JSON object in database format.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>json</td>
<td>Object</td>
<td>The JSON object in database format</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#model"><code class="prettyprint">Model</code></a></td>
<td><code class="prettyprint">this</code> for chaining</td>
</tr>
</tbody></table>

<h4 id="set">$set</h4>
<pre class="highlight javascript"><code><span class="nx">modelInstance</span><span class="p">.</span><span class="nx">$set</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
</code></pre>
<p>Sets the values from another model or object.</p>

<p>Unlike <a href="#_s_setjson"><code class="prettyprint">$setJson</code></a>, this doesn&rsquo;t call any <a href="#_s_parsejson"><code class="prettyprint">$parseJson</code></a> methods or validate the input.
This simply sets each value in the object to this object.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>obj</td>
<td>Object</td>
<td></td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#model"><code class="prettyprint">Model</code></a></td>
<td><code class="prettyprint">this</code> for chaining</td>
</tr>
</tbody></table>

<h4 id="setrelated">$setRelated</h4>
<pre class="highlight javascript"><code><span class="nx">modelInstance</span><span class="p">.</span><span class="nx">$setRelated</span><span class="p">(</span><span class="nx">relation</span><span class="p">,</span> <span class="nx">relatedModels</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">person</span><span class="p">.</span><span class="nx">$setRelated</span><span class="p">(</span><span class="s1">'parent'</span><span class="p">,</span> <span class="nx">parent</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">person</span><span class="p">.</span><span class="nx">parent</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">person</span><span class="p">.</span><span class="nx">$setRelated</span><span class="p">(</span><span class="s1">'children'</span><span class="p">,</span> <span class="nx">children</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">person</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</code></pre>
<p>Sets related models to a corresponding property in the object.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>relation</td>
<td>string&#124;<a href="#relation"><code class="prettyprint">Relation</code></a></td>
<td>Relation name or a relation instance to set.</td>
</tr>
<tr>
<td>relatedModels</td>
<td><a href="#model"><code class="prettyprint">Model</code></a>&#124;<a href="#model"><code class="prettyprint">Model[]</code></a></td>
<td>Models to set.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#model"><code class="prettyprint">Model</code></a></td>
<td><code class="prettyprint">this</code> for chaining</td>
</tr>
</tbody></table>

<h4 id="appendrelated">$appendRelated</h4>
<pre class="highlight javascript"><code><span class="nx">modelInstance</span><span class="p">.</span><span class="nx">$appendRelated</span><span class="p">(</span><span class="nx">relation</span><span class="p">,</span> <span class="nx">relatedModels</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">person</span><span class="p">.</span><span class="nx">$appendRelated</span><span class="p">(</span><span class="s1">'parent'</span><span class="p">,</span> <span class="nx">parent</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">person</span><span class="p">.</span><span class="nx">parent</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="nx">person</span><span class="p">.</span><span class="nx">$appendRelated</span><span class="p">(</span><span class="s1">'children'</span><span class="p">,</span> <span class="nx">child1</span><span class="p">);</span>
<span class="nx">person</span><span class="p">.</span><span class="nx">$appendRelated</span><span class="p">(</span><span class="s1">'children'</span><span class="p">,</span> <span class="nx">child2</span><span class="p">);</span>

<span class="nx">child1</span> <span class="o">=</span> <span class="nx">person</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="nx">person</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
<span class="nx">child2</span> <span class="o">=</span> <span class="nx">person</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="nx">person</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">2</span><span class="p">];</span>
</code></pre>
<p>Appends related models to a corresponding property in the object.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>relation</td>
<td>string&#124;<a href="#relation"><code class="prettyprint">Relation</code></a></td>
<td>Relation name or a relation instance to set.</td>
</tr>
<tr>
<td>relatedModels</td>
<td><a href="#model"><code class="prettyprint">Model</code></a>&#124;<a href="#model"><code class="prettyprint">Model[]</code></a></td>
<td>Models to append.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#model"><code class="prettyprint">Model</code></a></td>
<td><code class="prettyprint">this</code> for chaining</td>
</tr>
</tbody></table>

<h4 id="omit">$omit</h4>
<pre class="highlight javascript"><code><span class="nx">modelInstance</span><span class="p">.</span><span class="nx">$omit</span><span class="p">(</span><span class="nx">keys</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Omits a set of properties.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">person</span>
  <span class="p">.</span><span class="nx">fromJson</span><span class="p">({</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">,</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">24</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">$omit</span><span class="p">(</span><span class="s1">'lastName'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="s1">'lastName'</span><span class="p">));</span> <span class="c1">// --&gt; false</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">person</span>
  <span class="p">.</span><span class="nx">fromJson</span><span class="p">({</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">,</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">24</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">$omit</span><span class="p">([</span><span class="s1">'lastName'</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="s1">'lastName'</span><span class="p">));</span> <span class="c1">// --&gt; false</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">person</span>
  <span class="p">.</span><span class="nx">fromJson</span><span class="p">({</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">,</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">24</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">$omit</span><span class="p">({</span><span class="na">lastName</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="s1">'lastName'</span><span class="p">));</span> <span class="c1">// --&gt; false</span>
</code></pre>
<p>Omits a set of properties.</p>

<p>The selected properties are set to <code class="prettyprint">undefined</code>. Note that this is done in-place.
Properties are set to undefined instead of deleting them for performance reasons
(V8 doesn&rsquo;t like delete).</p>

<p>If you want to use <code class="prettyprint">delete</code> instead of undefining, you can override the
<a href="#omitimpl"><code class="prettyprint">omitImpl</code></a> method.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>keys</td>
<td>string&#124;string[]&#124;Object.&lt;string, boolean&gt;</td>
<td>keys to omit</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#model"><code class="prettyprint">Model</code></a></td>
<td><code class="prettyprint">this</code> for chaining</td>
</tr>
</tbody></table>

<h4 id="pick">$pick</h4>
<pre class="highlight javascript"><code><span class="nx">modelInstance</span><span class="p">.</span><span class="nx">$pick</span><span class="p">(</span><span class="nx">keys</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Omits a set of properties.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">person</span>
  <span class="p">.</span><span class="nx">fromJson</span><span class="p">({</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">,</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">24</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">$pick</span><span class="p">(</span><span class="s1">'firstName'</span><span class="p">,</span> <span class="s1">'age'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="s1">'lastName'</span><span class="p">));</span> <span class="c1">// --&gt; false</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">person</span>
  <span class="p">.</span><span class="nx">fromJson</span><span class="p">({</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">,</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">24</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">$pick</span><span class="p">([</span><span class="s1">'firstName'</span><span class="p">,</span> <span class="s1">'age'</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="s1">'lastName'</span><span class="p">));</span> <span class="c1">// --&gt; false</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">person</span>
  <span class="p">.</span><span class="nx">fromJson</span><span class="p">({</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">,</span> <span class="na">lastName</span><span class="p">:</span> <span class="s1">'Lawrence'</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">24</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">$pick</span><span class="p">({</span><span class="na">firstName</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="s1">'lastName'</span><span class="p">));</span> <span class="c1">// --&gt; false</span>
</code></pre>
<p>Picks a set of properties.</p>

<p>All other properties but the selected ones are set to <code class="prettyprint">undefined</code>. Note that
this is done in-place. Properties are set to undefined instead of deleting
them for performance reasons (V8 doesn&rsquo;t like delete).</p>

<p>If you want to use <code class="prettyprint">delete</code> instead of undefining, you can override the
<a href="#omitimpl"><code class="prettyprint">omitImpl</code></a> method.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>keys</td>
<td>string&#124;string[]&#124;Object.&lt;string, boolean&gt;</td>
<td>keys to pick</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#model"><code class="prettyprint">Model</code></a></td>
<td><code class="prettyprint">this</code> for chaining</td>
</tr>
</tbody></table>

<h4 id="clone">$clone</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">clone</span> <span class="o">=</span> <span class="nx">modelInstance</span><span class="p">.</span><span class="nx">$clone</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">shallowClone</span> <span class="o">=</span> <span class="nx">modelInstance</span><span class="p">.</span><span class="nx">$clone</span><span class="p">({</span><span class="na">shallow</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
</code></pre>
<p>Returns a (deep) copy of this model.</p>

<p>If this object has instances of <a href="#model"><code class="prettyprint">Model</code></a> as properties (or arrays of them)
they are cloned using their <code class="prettyprint">$clone()</code> method. A shallow copy without relations
can be created by passing the <code class="prettyprint">shallow: true</code> option.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>opt</td>
<td><a href="#cloneoptions"><code class="prettyprint">CloneOptions</code></a></td>
<td>Optional options</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#model"><code class="prettyprint">Model</code></a></td>
<td>Deep clone of <code class="prettyprint">this</code></td>
</tr>
</tbody></table>

<h4 id="query">$query</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">queryBuilder</span> <span class="o">=</span> <span class="nx">person</span><span class="p">.</span><span class="nx">$query</span><span class="p">(</span><span class="nx">transactionOrKnex</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Re-fetch the instance from the database:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="c1">// If you need to refresh the same instance you can do this:</span>
<span class="kr">const</span> <span class="nx">reFetchedPerson</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">person</span><span class="p">.</span><span class="nx">$query</span><span class="p">();</span>

<span class="c1">// Note that `person` did not get modified by the fetch.</span>
<span class="nx">person</span><span class="p">.</span><span class="nx">$set</span><span class="p">(</span><span class="nx">reFetchedPerson</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Insert a new model to database:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">jennifer</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">fromJson</span><span class="p">({</span><span class="na">firstName</span><span class="p">:</span> <span class="s1">'Jennifer'</span><span class="p">}).</span><span class="nx">$query</span><span class="p">().</span><span class="nx">insert</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">jennifer</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Patch a model:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">await</span> <span class="nx">person</span><span class="p">.</span><span class="nx">$query</span><span class="p">().</span><span class="nx">patch</span><span class="p">({</span><span class="na">lastName</span><span class="p">:</span> <span class="s1">'Cooper'</span><span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'person updated'</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Delete a model.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">await</span> <span class="nx">person</span><span class="p">.</span><span class="nx">$query</span><span class="p">().</span><span class="k">delete</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'person deleted'</span><span class="p">);</span>
</code></pre>
<p>Creates a query builder for this model instance.</p>

<p>All queries built using the returned builder only affect this instance.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>transactionOrKnex</td>
<td>object</td>
<td>Optional transaction or knex instance for the query. This can be used to specify a transaction or even a different database for a query. Falsy values are ignored.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td>query builder</td>
</tr>
</tbody></table>

<h4 id="relatedquery">$relatedQuery</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="nx">$relatedQuery</span><span class="p">(</span><span class="nx">relationName</span><span class="p">,</span> <span class="nx">transactionOrKnex</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Fetch all models related to a model through a relation. The fetched models are
also stored to the owner model&rsquo;s property named after the relation (by default):</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">pets</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">jennifer</span><span class="p">.</span><span class="nx">$relatedQuery</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'jennifer has'</span><span class="p">,</span> <span class="nx">pets</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="s1">'pets'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">jennifer</span><span class="p">.</span><span class="nx">pets</span> <span class="o">===</span> <span class="nx">pets</span><span class="p">);</span> <span class="c1">// --&gt; true</span>
</code></pre>
<blockquote>
<p>The related query is just like any other query. All knex methods are available:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">dogsAndCats</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">jennifer</span>
  <span class="p">.</span><span class="nx">$relatedQuery</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">'animals.*'</span><span class="p">,</span> <span class="s1">'persons.name as ownerName'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'species'</span><span class="p">,</span> <span class="s1">'='</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">orWhere</span><span class="p">(</span><span class="s1">'breed'</span><span class="p">,</span> <span class="s1">'='</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">innerJoin</span><span class="p">(</span><span class="s1">'persons'</span><span class="p">,</span> <span class="s1">'persons.id'</span><span class="p">,</span> <span class="s1">'animals.ownerId'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">'animals.name'</span><span class="p">);</span>

<span class="c1">// All the dogs and cats have the owner's name "Jennifer"</span>
<span class="c1">// joined as the `ownerName` property.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dogsAndCats</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>This inserts a new model to the database and binds it to the owner model as defined
by the relation (by default):</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">waldo</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">jennifer</span>
  <span class="p">.</span><span class="nx">$relatedQuery</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="na">species</span><span class="p">:</span> <span class="s1">'dog'</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'Fluffy'</span><span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">waldo</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>To add an existing model to a relation the <code class="prettyprint">relate</code> method can be used. In this example
the dog <code class="prettyprint">fluffy</code> already exists in the database but it isn&rsquo;t related to <code class="prettyprint">jennifer</code> through
the <code class="prettyprint">pets</code> relation. We can make the connection like this:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">await</span> <span class="nx">jennifer</span>
  <span class="p">.</span><span class="nx">$relatedQuery</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">relate</span><span class="p">(</span><span class="nx">fluffy</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'fluffy is now related to jennifer through pets relation'</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>The connection can be removed using the <code class="prettyprint">unrelate</code> method. Again, this doesn&rsquo;t delete the
related model. Only the connection is removed. For example in the case of ManyToMany relation
the join table entries are deleted.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">await</span> <span class="nx">jennifer</span>
  <span class="p">.</span><span class="nx">$relatedQuery</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">unrelate</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="nx">fluffy</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'jennifer no longer has fluffy as a pet'</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Related models can be deleted using the delete method. Note that in the case of ManyToManyRelation
the join table entries are not deleted. Naturally the delete query can be chained with anyknex*
methods.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">await</span> <span class="nx">jennifer</span>
  <span class="p">.</span><span class="nx">$relatedQuery</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="k">delete</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'species'</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'jennifer no longer has any cats'</span><span class="p">);</span>
</code></pre>
<blockquote>
<p><code class="prettyprint">update</code> and <code class="prettyprint">patch</code> can be used to update related models. Only difference between the mentioned
methods is that <code class="prettyprint">update</code> validates the input objects using the related model class&rsquo;s full schema
and <code class="prettyprint">patch</code> ignores the <code class="prettyprint">required</code> property of the schema. Use <code class="prettyprint">update</code> when you want to update
<em>all</em> properties of a model and <code class="prettyprint">patch</code> when only a subset should be updated.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">updatedFluffy</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">jennifer</span>
  <span class="p">.</span><span class="nx">$relatedQuery</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="na">species</span><span class="p">:</span> <span class="s1">'dog'</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'Fluffy the great'</span><span class="p">,</span> <span class="na">vaccinated</span><span class="p">:</span> <span class="kc">false</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="nx">fluffy</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'fluffy\'s new name is'</span><span class="p">,</span> <span class="nx">updatedFluffy</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>

<span class="c1">// This query will be rejected assuming that `name` or `species`</span>
<span class="c1">// is a required property for an Animal.</span>
<span class="nx">await</span> <span class="nx">jennifer</span>
  <span class="p">.</span><span class="nx">$relatedQuery</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="na">vaccinated</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'species'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">);</span>

<span class="c1">// This query will succeed.</span>
<span class="nx">await</span> <span class="nx">jennifer</span>
  <span class="p">.</span><span class="nx">$relatedQuery</span><span class="p">(</span><span class="s1">'pets'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">patch</span><span class="p">({</span><span class="na">vaccinated</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'species'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'jennifer just got all her dogs vaccinated'</span><span class="p">);</span>
</code></pre>
<p>Use this to build a query that only affects the models related to this instance through a relation. By default, any fetched or inserted models are also stored to the owner models property named after the relation. See <a href="#relatedfindquerymutates">relatedFindQueryMutates</a> or <a href="#relatedinsertquerymutates">relatedInsertQueryMutates</a> to change this behaviour.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>relationName</td>
<td>string</td>
<td>The name of the relation to query.</td>
</tr>
<tr>
<td>transactionOrKnex</td>
<td>object</td>
<td>Optional transaction or knex instance for the query. This can be used to specify a transaction or even a different database for a query. Falsy values are ignored.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td>A query builder</td>
</tr>
</tbody></table>

<h4 id="loadrelated">$loadRelated</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">modelInstance</span><span class="p">.</span><span class="nx">$loadRelated</span><span class="p">(</span><span class="nx">expression</span><span class="p">,</span> <span class="nx">filters</span><span class="p">,</span> <span class="nx">transactionOrKnex</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Examples:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">await</span> <span class="nx">jennifer</span><span class="p">.</span><span class="nx">$loadRelated</span><span class="p">(</span><span class="s1">'[pets, children.[pets, father]]'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Jennifer has'</span><span class="p">,</span> <span class="nx">jennifer</span><span class="p">.</span><span class="nx">pets</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="s1">'pets'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Jennifer has'</span><span class="p">,</span> <span class="nx">jennifer</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="s1">'children'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Jennifer\'s first child has'</span><span class="p">,</span> <span class="nx">jennifer</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">pets</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="s1">'pets'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Jennifer had her first child with'</span><span class="p">,</span> <span class="nx">jennifer</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">father</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Relations can be filtered by giving named filter functions as arguments
to the relations:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">await</span> <span class="nx">jennifer</span>
  <span class="p">.</span><span class="nx">$loadRelated</span><span class="p">(</span><span class="s1">'children(orderByAge).[pets(onlyDogs, orderByName), movies]'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">orderByAge</span><span class="p">:</span> <span class="p">(</span><span class="nx">builder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">builder</span><span class="p">.</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">'age'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">orderByName</span><span class="p">:</span> <span class="p">(</span><span class="nx">builder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">builder</span><span class="p">.</span><span class="nx">orderBy</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">onlyDogs</span><span class="p">:</span> <span class="p">(</span><span class="nx">builder</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">builder</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'species'</span><span class="p">,</span> <span class="s1">'dog'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">jennifer</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">pets</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</code></pre>
<p>Loads related models using a <a href="#relationexpression"><code class="prettyprint">RelationExpression</code></a> and assigns them to the target model instances.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>expression</td>
<td>string&#124;<a href="#relationexpression"><code class="prettyprint">RelationExpression</code></a></td>
<td>The relation expression</td>
</tr>
<tr>
<td>filters</td>
<td>Object.&lt;string, function(<a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a>)&gt;</td>
<td>Optional named filters</td>
</tr>
<tr>
<td>transactionOrKnex</td>
<td>object</td>
<td>Optional transaction or knex instance for the query. This can be used to specify a transaction or even a different database.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a></td>
<td>The created query builder</td>
</tr>
</tbody></table>

<h4 id="traverse">$traverse</h4>

<p>Shortcut for <a href="#traverse-2212"><code class="prettyprint">Model.traverse(filterConstructor, this, callback)</code></a>.</p>

<h4 id="knex">$knex</h4>

<p>Shortcut for <a href="#knex"><code class="prettyprint">return this.constructor.knex()</code></a>.</p>

<h4 id="transaction">$transaction</h4>

<p>Shortcut for <a href="#knex"><code class="prettyprint">return this.constructor.knex()</code></a>.</p>

<h4 id="beforeinsert">$beforeInsert</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="nx">$beforeInsert</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="kr">super</span><span class="p">.</span><span class="nx">$beforeInsert</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">);</span>
    <span class="nx">await</span> <span class="nx">doPossiblyAsyncStuff</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>The current query&rsquo;s transaction/knex instance can always be accessed through <code class="prettyprint">queryContext.transaction</code>.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="nx">$beforeInsert</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="kr">super</span><span class="p">.</span><span class="nx">$beforeInsert</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">);</span>
    <span class="c1">// This can always be done even if there is no running transaction. In that</span>
    <span class="c1">// case `queryContext.transaction` returns the normal knex instance. This</span>
    <span class="c1">// makes sure that the query is not executed outside the original query's</span>
    <span class="c1">// transaction.</span>
    <span class="nx">await</span> <span class="nx">SomeModel</span>
      <span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">.</span><span class="nx">transaction</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">whatever</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Called before a model is inserted into the database.</p>

<p>You can return a promise from this function if you need to do asynchronous stuff. You can
also throw an exception to abort the insert and reject the query. This can be useful if
you need to do insert specific validation.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>queryContext</td>
<td>Object</td>
<td>The context object of the insert query. See <a href="#context"><code class="prettyprint">context</code></a>.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://bluebirdjs.com/docs/getting-started.html"><code class="prettyprint">Promise</code></a>&#124;*</td>
<td></td>
</tr>
</tbody></table>

<h4 id="afterinsert">$afterInsert</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="nx">$afterInsert</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="kr">super</span><span class="p">.</span><span class="nx">$afterInsert</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">);</span>
    <span class="nx">await</span> <span class="nx">doPossiblyAsyncStuff</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>The current query&rsquo;s transaction/knex instance can always be accessed through <code class="prettyprint">queryContext.transaction</code>.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="nx">$afterInsert</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="kr">super</span><span class="p">.</span><span class="nx">$afterInsert</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">);</span>
    <span class="c1">// This can always be done even if there is no running transaction. In that</span>
    <span class="c1">// case `queryContext.transaction` returns the normal knex instance. This</span>
    <span class="c1">// makes sure that the query is not executed outside the original query's</span>
    <span class="c1">// transaction.</span>
    <span class="nx">await</span> <span class="nx">SomeModel</span>
      <span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">.</span><span class="nx">transaction</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">whatever</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Called after a model has been inserted into the database.</p>

<p>You can return a promise from this function if you need to do asynchronous stuff.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>queryContext</td>
<td>Object</td>
<td>The context object of the insert query. See <a href="#context"><code class="prettyprint">context</code></a>.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://bluebirdjs.com/docs/getting-started.html"><code class="prettyprint">Promise</code></a>&#124;*</td>
<td></td>
</tr>
</tbody></table>

<h4 id="beforeupdate">$beforeUpdate</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="nx">$beforeUpdate</span><span class="p">(</span><span class="nx">opt</span><span class="p">,</span> <span class="nx">queryContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="kr">super</span><span class="p">.</span><span class="nx">$beforeUpdate</span><span class="p">(</span><span class="nx">opt</span><span class="p">,</span> <span class="nx">queryContext</span><span class="p">);</span>
    <span class="nx">await</span> <span class="nx">doPossiblyAsyncStuff</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>The current query&rsquo;s transaction/knex instance can always be accessed through <code class="prettyprint">queryContext.transaction</code>.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="nx">$beforeUpdate</span><span class="p">(</span><span class="nx">opt</span><span class="p">,</span> <span class="nx">queryContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="kr">super</span><span class="p">.</span><span class="nx">$beforeUpdate</span><span class="p">(</span><span class="nx">opt</span><span class="p">,</span> <span class="nx">queryContext</span><span class="p">);</span>
    <span class="c1">// This can always be done even if there is no running transaction. In that</span>
    <span class="c1">// case `queryContext.transaction` returns the normal knex instance. This</span>
    <span class="c1">// makes sure that the query is not executed outside the original query's</span>
    <span class="c1">// transaction.</span>
    <span class="nx">await</span> <span class="nx">SomeModel</span>
      <span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">.</span><span class="nx">transaction</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">whatever</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Note that the <code class="prettyprint">opt.old</code> object is only populated for instance queries started with <code class="prettyprint">$query</code>:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">somePerson</span>
  <span class="p">.</span><span class="nx">$query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">newValues</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>For the following query <code class="prettyprint">opt.old</code> is <code class="prettyprint">undefined</code> because there is no old object in the javascript
side. objection.js doesn&rsquo;t fetch the old values even if they existed in the database
for performance and simplicity reasons.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">newValues</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">);</span>
</code></pre>
<p>Called before a model is updated.</p>

<p>You can return a promise from this function if you need to do asynchronous stuff. You can
also throw an exception to abort the update and reject the query. This can be useful if
you need to do update specific validation.</p>

<p>This method is also called before a model is patched. Therefore all the model&rsquo;s properties
may not exist. You can check if the update operation is a patch by checking the <code class="prettyprint">opt.patch</code>
boolean.</p>

<p><code class="prettyprint">opt.old</code> object contains the old values while <code class="prettyprint">this</code> contains the updated values. The old
values are never fetched from the database implicitly. For non-instance queries the <code class="prettyprint">opt.old</code>
object is <code class="prettyprint">undefined</code>. See the examples &ndash;&gt;.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>opt</td>
<td>ModelOptions</td>
<td>Update options.</td>
</tr>
<tr>
<td>queryContext</td>
<td>Object</td>
<td>The context object of the update query. See <a href="#context"><code class="prettyprint">context</code></a>.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://bluebirdjs.com/docs/getting-started.html"><code class="prettyprint">Promise</code></a>&#124;*</td>
<td></td>
</tr>
</tbody></table>

<h4 id="afterupdate">$afterUpdate</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="nx">$afterUpdate</span><span class="p">(</span><span class="nx">opt</span><span class="p">,</span> <span class="nx">queryContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="kr">super</span><span class="p">.</span><span class="nx">$afterUpdate</span><span class="p">(</span><span class="nx">opt</span><span class="p">,</span> <span class="nx">queryContext</span><span class="p">);</span>
    <span class="nx">await</span> <span class="nx">doPossiblyAsyncStuff</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>The current query&rsquo;s transaction/knex instance can always be accessed through <code class="prettyprint">queryContext.transaction</code>.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="nx">$afterUpdate</span><span class="p">(</span><span class="nx">opt</span><span class="p">,</span> <span class="nx">queryContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="kr">super</span><span class="p">.</span><span class="nx">$afterUpdate</span><span class="p">(</span><span class="nx">opt</span><span class="p">,</span> <span class="nx">queryContext</span><span class="p">);</span>
    <span class="c1">// This can always be done even if there is no running transaction. In that</span>
    <span class="c1">// case `queryContext.transaction` returns the normal knex instance. This</span>
    <span class="c1">// makes sure that the query is not executed outside the original query's</span>
    <span class="c1">// transaction.</span>
    <span class="nx">await</span> <span class="nx">SomeModel</span>
      <span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">.</span><span class="nx">transaction</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">whatever</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Note that the <code class="prettyprint">opt.old</code> object is only populated for instance queries started with <code class="prettyprint">$query</code>:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">somePerson</span>
  <span class="p">.</span><span class="nx">$query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">newValues</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>For the following query <code class="prettyprint">opt.old</code> is <code class="prettyprint">undefined</code> because there is no old object in the javascript
side. objection.js doesn&rsquo;t fetch the old values even if they existed in the database
for performance and simplicity reasons.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">newValues</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">);</span>
</code></pre>
<p>Called after a model is updated.</p>

<p>You can return a promise from this function if you need to do asynchronous stuff.</p>

<p>This method is also called after a model is patched. Therefore all the model&rsquo;s properties
may not exist. You can check if the update operation is a patch by checking the <code class="prettyprint">opt.patch</code>
boolean.</p>

<p><code class="prettyprint">opt.old</code> object contains the old values while <code class="prettyprint">this</code> contains the updated values. The old
values are never fetched from the database implicitly. For non-instance queries the <code class="prettyprint">opt.old</code>
object is <code class="prettyprint">undefined</code>. See the examples &ndash;&gt;.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>opt</td>
<td>ModelOptions</td>
<td>Update options.</td>
</tr>
<tr>
<td>queryContext</td>
<td>Object</td>
<td>The context object of the update query. See <a href="#context"><code class="prettyprint">context</code></a>.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://bluebirdjs.com/docs/getting-started.html"><code class="prettyprint">Promise</code></a>&#124;*</td>
<td></td>
</tr>
</tbody></table>

<h4 id="beforedelete">$beforeDelete</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="nx">$beforeDelete</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="kr">super</span><span class="p">.</span><span class="nx">$beforeDelete</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">);</span>
    <span class="nx">await</span> <span class="nx">doPossiblyAsyncStuff</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>The current query&rsquo;s transaction/knex instance can always be accessed through <code class="prettyprint">queryContext.transaction</code>.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="nx">$beforeDelete</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="kr">super</span><span class="p">.</span><span class="nx">$beforeDelete</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">);</span>
    <span class="c1">// This can always be done even if there is no running transaction. In that</span>
    <span class="c1">// case `queryContext.transaction` returns the normal knex instance. This</span>
    <span class="c1">// makes sure that the query is not executed outside the original query's</span>
    <span class="c1">// transaction.</span>
    <span class="nx">await</span> <span class="nx">SomeModel</span>
      <span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">.</span><span class="nx">transaction</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">whatever</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Called before a model is deleted.</p>

<p>You can return a promise from this function if you need to do asynchronous stuff.</p>

<p>Note that this method is only called for instance deletes started with <code class="prettyprint">$query()</code> method.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>queryContext</td>
<td>Object</td>
<td>The context object of the delete query. See <a href="#context"><code class="prettyprint">context</code></a>.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://bluebirdjs.com/docs/getting-started.html"><code class="prettyprint">Promise</code></a>&#124;*</td>
<td></td>
</tr>
</tbody></table>

<h4 id="afterdelete">$afterDelete</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="nx">$afterDelete</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="kr">super</span><span class="p">.</span><span class="nx">$afterDelete</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">);</span>
    <span class="nx">await</span> <span class="nx">doPossiblyAsyncStuff</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>The current query&rsquo;s transaction/knex instance can always be accessed through <code class="prettyprint">queryContext.transaction</code>.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="nx">$afterDelete</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">await</span> <span class="kr">super</span><span class="p">.</span><span class="nx">$afterDelete</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">);</span>
    <span class="c1">// This can always be done even if there is no running transaction. In that</span>
    <span class="c1">// case `queryContext.transaction` returns the normal knex instance. This</span>
    <span class="c1">// makes sure that the query is not executed outside the original query's</span>
    <span class="c1">// transaction.</span>
    <span class="nx">await</span> <span class="nx">SomeModel</span>
      <span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">.</span><span class="nx">transaction</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">whatever</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Called after a model is deleted.</p>

<p>You can return a promise from this function if you need to do asynchronous stuff.</p>

<p>Note that this method is only called for instance deletes started with <code class="prettyprint">$query()</code> method.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>queryContext</td>
<td>Object</td>
<td>The context object of the delete query. See <a href="#context"><code class="prettyprint">context</code></a>.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://bluebirdjs.com/docs/getting-started.html"><code class="prettyprint">Promise</code></a>&#124;*</td>
<td></td>
</tr>
</tbody></table>

<h4 id="afterget">$afterGet</h4>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">$afterGet</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">doPossiblyAsyncStuff</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>The current query&rsquo;s transaction/knex instance can always be accessed through <code class="prettyprint">queryContext.transaction</code>.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="nx">$afterGet</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This can always be done even if there is no running transaction. In that</span>
    <span class="c1">// case `queryContext.transaction` returns the normal knex instance. This</span>
    <span class="c1">// makes sure that the query is not executed outside the original query's</span>
    <span class="c1">// transaction.</span>
    <span class="k">return</span> <span class="nx">SomeModel</span>
      <span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">queryContext</span><span class="p">.</span><span class="nx">transaction</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">whatever</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Called after a model is fetched.</p>

<p>This method is <em>not</em> called for insert, update or delete operations.</p>

<p>You can return a promise from this function if you need to do asynchronous stuff.</p>

<h5 id="arguments">Arguments</h5>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>queryContext</td>
<td>Object</td>
<td>The context object of the get query. See <a href="#context"><code class="prettyprint">context</code></a>.</td>
</tr>
</tbody></table>

<h5 id="return-value">Return value</h5>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="http://bluebirdjs.com/docs/getting-started.html"><code class="prettyprint">Promise</code></a>&#124;*</td>
<td></td>
</tr>
</tbody></table>

<h2 id="transaction">transaction</h2>

<p>See the section about <a href="#passing-around-a-transaction-object">transactions</a></p>

<h3 id="methods">Methods</h3>

<h4 id="start">start</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">trx</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="nx">Model</span><span class="p">.</span><span class="nx">knex</span><span class="p">());</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="nx">doStuff</span><span class="p">(</span><span class="nx">trx</span><span class="p">);</span>
  <span class="nx">await</span> <span class="nx">trx</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="nx">trx</span><span class="p">.</span><span class="nx">rollback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
<p>Starts a transaction and returns a <a href="#transactionobject">transaction object</a>. If you use this method, you must
explicitly remember to call <code class="prettyprint">trx.commit()</code> or <code class="prettyprint">trx.rollback(err)</code>.</p>

<h2 id="transactionobject">TransactionObject</h2>

<p>This is nothing more than a knex transaction object. It can be used as a knex query builder, it can be
<a href="#passing-around-a-transaction-object">passed to objection queries</a> and <a href="#binding-models-to-a-transaction">models can be bound to it</a></p>

<p>See the section about <a href="#passing-around-a-transaction-object">transactions</a> for more info and examples.</p>

<h3 id="instance-methods">Instance methods</h3>

<h4 id="commit">commit</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">trx</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</code></pre>
<p>Call this method to commit the transaction. This only needs to be called if you use <code class="prettyprint">transaction.start()</code> method.</p>

<h4 id="rollback">rollback</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">trx</span><span class="p">.</span><span class="nx">rollback</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</code></pre>
<p>Call this method to rollback the transaction. This only needs to be called if you use <code class="prettyprint">transaction.start()</code> method.
You need to pass the error to the method as the only argument.</p>

<h2 id="fieldexpression">FieldExpression</h2>

<p>Field expressions allow one to refer to JSONB fields inside columns.</p>

<p>Syntax: <code class="prettyprint">&lt;column reference&gt;[:&lt;json field reference&gt;]</code></p>

<p>e.g. <code class="prettyprint">persons.jsonColumnName:details.names[1]</code> would refer to value <code class="prettyprint">&#39;Second&#39;</code>
in column <code class="prettyprint">persons.jsonColumnName</code> which has
<code class="prettyprint">{ details: { names: [&#39;First&#39;, &#39;Second&#39;, &#39;Last&#39;] } }</code> object stored in it.</p>

<p>First part <code class="prettyprint">&lt;column reference&gt;</code> is compatible with column references used in
knex e.g. <code class="prettyprint">MyFancyTable.tributeToThBestColumnNameEver</code>.</p>

<p>Second part describes a path to an attribute inside the referred column.
It is optional and it always starts with colon which follows directly with
first path element. e.g. <code class="prettyprint">Table.jsonObjectColumnName:jsonFieldName</code> or
<code class="prettyprint">Table.jsonArrayColumn:[321]</code>.</p>

<p>Syntax supports <code class="prettyprint">[&lt;key or index&gt;]</code> and <code class="prettyprint">.&lt;key or index&gt;</code> flavors of reference
to json keys / array indexes:</p>

<p>e.g. both <code class="prettyprint">Table.myColumn:[1][3]</code> and <code class="prettyprint">Table.myColumn:1.3</code> would access correctly
both of the following objects <code class="prettyprint">[null, [null,null,null, &quot;I was accessed&quot;]]</code> and
<code class="prettyprint">{ &quot;1&quot;: { &quot;3&quot; : &quot;I was accessed&quot; } }</code></p>

<p>Caveats when using special characters in keys:</p>

<ol>
<li><code class="prettyprint">objectColumn.key</code> This is the most common syntax, good if you are not using dots or square brackets <code class="prettyprint">[]</code> in your json object key name.</li>
<li>Keys containing dots <code class="prettyprint">objectColumn:[keywith.dots]</code> Column <code class="prettyprint">{ &quot;keywith.dots&quot; : &quot;I was referred&quot; }</code></li>
<li>Keys containing square brackets <code class="prettyprint">column[&#39;[]&#39;]</code> <code class="prettyprint">{ &quot;[]&quot; : &quot;This is getting ridiculous...&quot; }</code></li>
<li>Keys containing square brackets and quotes <code class="prettyprint">objectColumn:[&#39;Double.&quot;Quote&quot;.[]&#39;]</code> and <code class="prettyprint">objectColumn:[&quot;Sinlge.&#39;Quote&#39;.[]&quot;]</code> Column <code class="prettyprint">{ &quot;Double.\&quot;Quote\&quot;.[]&quot; : &quot;I was referred&quot;,  &quot;Sinlge.&#39;Quote&#39;.[]&quot; : &quot;Mee too!&quot; }</code></li>
<li>Keys containing dots, square brackets, single quotes and double quotes in one json key is not currently supported</li>
</ol>

<h2 id="relationexpression">RelationExpression</h2>

<blockquote>
<p>For example an expression <code class="prettyprint">children.[movies.actors.[pets, children], pets]</code> represents a tree:</p>
</blockquote>
<pre class="highlight plaintext"><code>              children
              (Person)
                 |
         -----------------
         |               |
       movies           pets
      (Movie)         (Animal)
         |
       actors
      (Person)
         |
    -----------
    |         |
   pets    children
 (Animal)  (Person)

</code></pre>
<blockquote>
<p>The model classes are shown in parenthesis.</p>

<p>This class rarely needs to be used directly. The relation expression can be given to a bunch
of functions in objection.js. For example:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s1">'children.[movies.actors.[pets, children], pets]'</span><span class="p">);</span>

<span class="c1">// All persons have the given relation tree fetched.</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">people</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">movies</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">actors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">pets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">name</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Relation expressions can have arguments. Arguments are listed in parenthesis after the relation names
like this:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s2">`children(arg1, arg2).[movies.actors(arg3), pets]`</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>You can spread eager expressions to multiple lines and add whitespace:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s2">`[
    children.[
      pets,
      movies.actors.[
        pets,
        children
      ]
    ]
  ]`</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>Eager expressions can be aliased using <code class="prettyprint">as</code> keyword:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">Person</span>
  <span class="p">.</span><span class="nx">query</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">eager</span><span class="p">(</span><span class="s2">`[
    children as kids.[
      pets(filterDogs) as dogs,
      pets(filterCats) as cats,

      movies.actors.[
        pets,
        children as kids
      ]
    ]
  ]`</span><span class="p">)</span>
</code></pre>
<p>Relation expression is a simple DSL for expressing relation trees.</p>

<p>These are all valid relation expressions:</p>

<ul>
<li><code class="prettyprint">children</code></li>
<li><code class="prettyprint">children.movies</code></li>
<li><code class="prettyprint">[children, pets]</code></li>
<li><code class="prettyprint">[children.movies, pets]</code></li>
<li><code class="prettyprint">[children.[movies, pets], pets]</code></li>
<li><code class="prettyprint">[children.[movies.actors.[children, pets], pets], pets]</code></li>
<li><code class="prettyprint">[children as kids, pets(filterDogs) as dogs]</code></li>
</ul>

<p>There are two tokens that have special meaning: <code class="prettyprint">*</code> and <code class="prettyprint">^</code>. <code class="prettyprint">*</code> means &ldquo;all relations recursively&rdquo; and
<code class="prettyprint">^</code> means &ldquo;this relation recursively&rdquo;.</p>

<p>For example <code class="prettyprint">children.*</code> means &ldquo;relation <code class="prettyprint">children</code> and all its relations, and all their relations and &hellip;&rdquo;.
The <code class="prettyprint">*</code> token must be used with caution or you will end up fetching your entire database.</p>

<p>Expression <code class="prettyprint">parent.^</code> is equivalent to <code class="prettyprint">parent.parent.parent.parent...</code> up to the point a relation no longer
has results for the <code class="prettyprint">parent</code> relation. The recursion can be limited to certain depth by giving the depth after
the <code class="prettyprint">^</code> character. For example <code class="prettyprint">parent.^3</code> is equal to <code class="prettyprint">parent.parent.parent</code>.</p>

<p>Relations can be aliased using the <code class="prettyprint">as</code> keyword.</p>

<h3 id="relationexpression-object-notation">RelationExpression object notation</h3>

<blockquote>
<p>The string expression in the comment is equivalent to the object expression below it:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="c1">// `children`</span>
<span class="p">{</span>
  <span class="nl">children</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre><pre class="highlight javascript"><code><span class="c1">// `children.movies`</span>
<span class="p">{</span>
  <span class="nl">children</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">movies</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight javascript"><code><span class="c1">// `[children, pets]`</span>
<span class="p">{</span>
  <span class="nl">children</span><span class="p">:</span> <span class="kc">true</span>
  <span class="nl">pets</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre><pre class="highlight javascript"><code><span class="c1">// `[children.[movies, pets], pets]`</span>
<span class="p">{</span>
  <span class="nl">children</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">movies</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">pets</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
  <span class="nl">pets</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre><pre class="highlight javascript"><code><span class="c1">// `parent.^`</span>
<span class="p">{</span>
  <span class="nl">parent</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">$recursive</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight javascript"><code><span class="c1">// `parent.^5`</span>
<span class="p">{</span>
  <span class="nl">parent</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">$recursive</span><span class="p">:</span> <span class="mi">5</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight javascript"><code><span class="c1">// `parent.*`</span>
<span class="p">{</span>
  <span class="nl">parent</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">$allRecursive</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight javascript"><code><span class="c1">// `[children as kids, pets(filterDogs) as dogs]`</span>
<span class="p">{</span>
  <span class="nl">kids</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">$relation</span><span class="p">:</span> <span class="s1">'children'</span>
  <span class="p">},</span>

  <span class="nx">dogs</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">$relation</span><span class="p">:</span> <span class="s1">'pets'</span><span class="p">,</span>
    <span class="nx">$modify</span><span class="p">:</span> <span class="p">[</span><span class="s1">'filterDogs'</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>In addition to the string expressions, a more verbose object notation can also be used.</p>

<h2 id="validator">Validator</h2>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">Validator</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">).</span><span class="nx">Validator</span><span class="p">;</span>
</code></pre>
<blockquote>
<p>Usage example:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">Validator</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">).</span><span class="nx">Validator</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">MyCustomValidator</span> <span class="kr">extends</span> <span class="nx">Validator</span> <span class="p">{</span>
  <span class="nx">validate</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// The model instance. May be empty at this point.</span>
    <span class="kr">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">model</span><span class="p">;</span>

    <span class="c1">// The properties to validate. After validation these values will</span>
    <span class="c1">// be merged into `model` by objection.</span>
    <span class="kr">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">json</span><span class="p">;</span>

    <span class="c1">// `ModelOptions` object. If your custom validator sets default</span>
    <span class="c1">// values, you need to check the `opt.patch` boolean. If it is true</span>
    <span class="c1">// we are validating a patch object and the defaults should not be set.</span>
    <span class="kr">const</span> <span class="nx">opt</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>

    <span class="c1">// A context object shared between the validation methods. A new</span>
    <span class="c1">// object is created for each validation operation. You can store</span>
    <span class="c1">// any data here.</span>
    <span class="kr">const</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">ctx</span><span class="p">;</span>

    <span class="c1">// Do your validation here and throw any exception if the</span>
    <span class="c1">// validation fails.</span>
    <span class="nx">doSomeValidationAndThrowIfFails</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>

    <span class="c1">// You need to return the (possibly modified) json.</span>
    <span class="k">return</span> <span class="nx">json</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">beforeValidate</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Takes the same arguments as `validate`. Usually there is no need</span>
    <span class="c1">// to override this.</span>
    <span class="k">return</span> <span class="kr">super</span><span class="p">.</span><span class="nx">beforeValidate</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">afterValidate</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Takes the same arguments as `validate`. Usually there is no need</span>
    <span class="c1">// to override this.</span>
    <span class="k">return</span> <span class="kr">super</span><span class="p">.</span><span class="nx">afterValidate</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">Model</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">).</span><span class="nx">Model</span><span class="p">;</span>

<span class="c1">// Override the `createValidator` method of a `Model` to use the</span>
<span class="c1">// custom validator.</span>
<span class="kr">class</span> <span class="nx">BaseModel</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">createValidator</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">MyCustomValidator</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Abstract class from which model validators must be inherited. See the
example for explanation. Also check out the <a href="#createvalidator"><code class="prettyprint">createValidator</code></a>
method.</p>

<h2 id="ajvvalidator">AjvValidator</h2>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">AjvValidator</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">).</span><span class="nx">AjvValidator</span><span class="p">;</span>
</code></pre>
<blockquote>
<p>Usage example:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">Model</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">).</span><span class="nx">Model</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">AjvValidator</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">).</span><span class="nx">AjvValidator</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">BaseModel</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">createValidator</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">AjvValidator</span><span class="p">({</span>
      <span class="na">onCreateAjv</span><span class="p">:</span> <span class="p">(</span><span class="nx">ajv</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// Here you can modify the `Ajv` instance.</span>
      <span class="p">},</span>
      <span class="na">options</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">allErrors</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">validateSchema</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">ownProperties</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">v5</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>The default <a href="https://github.com/epoberezkin/ajv">Ajv</a> based json schema
validator. You can override the <a href="#createvalidator"><code class="prettyprint">createValidator</code></a>
method of <a href="#model"><code class="prettyprint">Model</code></a> like in the example to modify the validator.</p>

<h2 id="validationerror">ValidationError</h2>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">ValidationError</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">).</span><span class="nx">ValidationError</span><span class="p">;</span>

<span class="k">throw</span> <span class="k">new</span> <span class="nx">ValidationError</span><span class="p">({</span><span class="nx">type</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">data</span><span class="p">});</span>
</code></pre>
<blockquote>
<p>Or</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">ValidationError</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">).</span><span class="nx">Model</span><span class="p">.</span><span class="nx">ValidationError</span><span class="p">;</span>

<span class="k">throw</span> <span class="k">new</span> <span class="nx">ValidationError</span><span class="p">({</span><span class="nx">type</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">data</span><span class="p">});</span>
</code></pre>
<blockquote>
<p>If <code class="prettyprint">type</code> is <code class="prettyprint">&quot;ModelValidation&quot;</code> then <code class="prettyprint">data</code> object should follow this pattern:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="p">{</span>
  <span class="nl">key1</span><span class="p">:</span> <span class="p">[{</span>
    <span class="na">message</span><span class="p">:</span> <span class="s1">'...'</span><span class="p">,</span>
    <span class="na">keyword</span><span class="p">:</span> <span class="s1">'required'</span><span class="p">,</span>
    <span class="na">params</span><span class="p">:</span> <span class="kc">null</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="na">message</span><span class="p">:</span> <span class="s1">'...'</span><span class="p">,</span>
    <span class="na">keyword</span><span class="p">:</span> <span class="s1">'...'</span><span class="p">,</span>
    <span class="na">params</span><span class="p">:</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="p">...],</span>

  <span class="na">key2</span><span class="p">:</span> <span class="p">[{</span>
    <span class="na">message</span><span class="p">:</span> <span class="s1">'...'</span><span class="p">,</span>
    <span class="na">keyword</span><span class="p">:</span> <span class="s1">'minLength'</span><span class="p">,</span>
    <span class="na">params</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">limit</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="p">...</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="p">...],</span>

  <span class="p">...</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>For each <code class="prettyprint">key</code>, a list of errors is given. Each error contains the default <code class="prettyprint">message</code> (as returned by the validator), an optional <code class="prettyprint">keyword</code>
string to identify the validation rule which didn&rsquo;t pass and a <code class="prettyprint">param</code> object which optionally contains more details about the context of the validation error.</p>

<p>If <code class="prettyprint">type</code> is anything else but <code class="prettyprint">&quot;ModelValidation&quot;</code>, <code class="prettyprint">data</code> can be any object that describes the error.</p>
</blockquote>

<p>Error of this class is thrown by default if validation of any input fails. By input we mean any data that can come
from the outside world, like model instances (or POJOs), relation expressions object graphs etc.</p>

<p>You can replace this error by overriding <a href="#createvalidationerror"><code class="prettyprint">Model.createValidationError()</code></a> method.</p>

<p>See the <a href="#error-handling">error handling recipe</a> for more info.</p>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>statusCode</td>
<td>number</td>
<td>HTTP status code for interop with express error handlers and other libraries that search for status code from errors.</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>One of &ldquo;ModelValidation&rdquo;, &ldquo;RelationExpression&rdquo;, &ldquo;UnallowedRelation&rdquo; and &ldquo;InvalidGraph&rdquo;. This can be any string for your own custom errors. The listed values are used internally by objection.</td>
</tr>
<tr>
<td>data</td>
<td>object</td>
<td>Any additional data. The content of this property is documented in the example in this section for &ldquo;ModelValidation&rdquo; errors.</td>
</tr>
</tbody></table>

<h2 id="notfounderror">NotFoundError</h2>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">NotFoundError</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">).</span><span class="nx">NotFoundError</span><span class="p">;</span>

<span class="k">throw</span> <span class="k">new</span> <span class="nx">NotFoundError</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Or</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">NotFoundError</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'objection'</span><span class="p">).</span><span class="nx">Model</span><span class="p">.</span><span class="nx">NotFoundError</span><span class="p">;</span>

<span class="k">throw</span> <span class="k">new</span> <span class="nx">NotFoundError</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</code></pre>
<p>Error of this class is thrown by default by <a href="#throwifnotfound"><code class="prettyprint">throwIfNotFound()</code></a></p>

<p>You can replace this error by overriding <a href="#createnotfounderror"><code class="prettyprint">Model.createNotFoundError()</code></a> method.</p>

<p>See the <a href="#error-handling">error handling recipe</a> for more info.</p>

<h2 id="modeloptions">ModelOptions</h2>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>patch</td>
<td>boolean</td>
<td>If true the json is treated as a patch and the <code class="prettyprint">required</code> field of the json schema is ignored in the validation. This allows us to create models with a subset of required properties for patch operations.</td>
</tr>
<tr>
<td>skipValidation</td>
<td>boolean</td>
<td>If true the json schema validation is skipped</td>
</tr>
<tr>
<td>old</td>
<td>object</td>
<td>The old values for methods like <code class="prettyprint">$beforeUpdate</code> and <code class="prettyprint">$beforeValidate</code>.</td>
</tr>
</tbody></table>

<h2 id="cloneoptions">CloneOptions</h2>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>shallow</td>
<td>boolean</td>
<td>If true, relations are ignored</td>
</tr>
</tbody></table>

<h2 id="tojsonoptions">ToJsonOptions</h2>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>shallow</td>
<td>boolean</td>
<td>If true, relations are ignored. Default is false.</td>
</tr>
<tr>
<td>virtuals</td>
<td>boolean</td>
<td>If false, virtual attributes are omitted from the output. Default is true.</td>
</tr>
</tbody></table>

<h2 id="eageroptions">EagerOptions</h2>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>minimize</td>
<td>boolean</td>
<td>If true the aliases of the joined tables and columns in a join based eager loading are minimized. This is sometimes needed because of identifier length limitations of some database engines. objection throws an exception when a query exceeds the length limit. You need to use this only in those cases.</td>
</tr>
<tr>
<td>separator</td>
<td>string</td>
<td>Separator between relations in nested join based eager query. Defaults to <code class="prettyprint">:</code>. Dot (<code class="prettyprint">.</code>) cannot be used at the moment because of the way knex parses the identifiers.</td>
</tr>
<tr>
<td>aliases</td>
<td>Object.&lt;string, string&gt;</td>
<td>Aliases for relations in a join based eager query. Defaults to an empty object.</td>
</tr>
<tr>
<td>joinOperation</td>
<td>string</td>
<td>Which join type to use <code class="prettyprint">[&#39;leftJoin&#39;, &#39;innerJoin&#39;, &#39;rightJoin&#39;, ...]</code> or any other knex join method name. Defaults to <code class="prettyprint">leftJoin</code>.</td>
</tr>
</tbody></table>

<h2 id="upsertgraphoptions">UpsertGraphOptions</h2>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>relate</td>
<td>boolean&#124;string[]</td>
<td>If true, relations are related instead of inserted. Relate functionality can be enabled for a subset of relations of the graph by providing a list of relation expressions. See the examples <a href="#graph-upserts">here</a>.</td>
</tr>
<tr>
<td>unrelate</td>
<td>boolean&#124;string[]</td>
<td>If true, relations are unrelated instead of deleted. Unrelate functionality can be enabled for a subset of relations of the graph by providing a list of relation expressions. See the examples <a href="#graph-upserts">here</a>.</td>
</tr>
<tr>
<td>insertMissing</td>
<td>boolean&#124;string[]</td>
<td>If true, models that have identifiers <em>and</em> are not found, are inserted. By default this is false and an error is thrown. This functionality can be enabled for a subset of relations of the graph by providing a list of relation expressions. See the examples <a href="#graph-upserts">here</a>.</td>
</tr>
<tr>
<td>update</td>
<td>boolean&#124;string[]</td>
<td>If true, update operations are performaed instead of patch when altering existing models, affecting the way the data is validated. With update operations, all required fields need to be present in the data provided. This functionality can be enabled for a subset of relations of the graph by providing a list of relation expressions. See the examples <a href="#graph-upserts">here</a>.</td>
</tr>
<tr>
<td>noInsert</td>
<td>boolean&#124;string[]</td>
<td>If true, no inserts are performed. Inserts can be disabled for a subset of relations of the graph by providing a list of relation expressions. See the examples <a href="#graph-upserts">here</a>.</td>
</tr>
<tr>
<td>noUpdate</td>
<td>boolean&#124;string[]</td>
<td>If true, no updates are performed. Updates can be disabled for a subset of relations of the graph by providing a list of relation expressions. See the examples <a href="#graph-upserts">here</a>.</td>
</tr>
<tr>
<td>noDelete</td>
<td>boolean&#124;string[]</td>
<td>If true, no deletes are performed. Deletes can be disabled for a subset of relations of the graph by providing a list of relation expressions. See the examples <a href="#graph-upserts">here</a>.</td>
</tr>
<tr>
<td>noRelate</td>
<td>boolean&#124;string[]</td>
<td>If true, no relates are performed. Relate operations can be disabled for a subset of relations of the graph by providing a list of relation expressions. See the examples <a href="#graph-upserts">here</a>.</td>
</tr>
<tr>
<td>noUnrelate</td>
<td>boolean&#124;string[]</td>
<td>If true, no unrelate operations are performed. Unrelate operations can be disabled for a subset of relations of the graph by providing a list of relation expressions. See the examples <a href="#graph-upserts">here</a>.</td>
</tr>
</tbody></table>

<h2 id="insertgraphoptions">InsertGraphOptions</h2>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>relate</td>
<td>boolean&#124;string[]</td>
<td>If true, models with an <code class="prettyprint">id</code> are related instead of inserted. Relate functionality can be enabled for a subset of relations of the graph by providing a list of relation expressions. See the examples <a href="#graph-inserts">here</a>.</td>
</tr>
</tbody></table>

<h2 id="tablemetadatafetchoptions">TableMetadataFetchOptions</h2>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>table</td>
<td>string</td>
<td>A custom table name. If not given, Model.tableName is used.</td>
</tr>
<tr>
<td>knex</td>
<td>knex&#124;Transaction</td>
<td>A knex instance or a transaction</td>
</tr>
</tbody></table>

<h2 id="tablemetadataoptions">TableMetadataOptions</h2>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>table</td>
<td>string</td>
<td>A custom table name. If not given, Model.tableName is used.</td>
</tr>
</tbody></table>

<h2 id="tablemetadata-prop">TableMetadata</h2>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>columns</td>
<td>string[]</td>
<td>Names of all the columns in a table.</td>
</tr>
</tbody></table>

<h2 id="relation">Relation</h2>

<blockquote>
<p>Note that <code class="prettyprint">Relation</code> instances are actually instances of the relation classes used in <code class="prettyprint">relationMappings</code>. For example:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">relationMappings</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">pets</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">relation</span><span class="p">:</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">HasManyRelation</span><span class="p">,</span>
        <span class="na">modelClass</span><span class="p">:</span> <span class="nx">Animal</span><span class="p">,</span>
        <span class="na">join</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">from</span><span class="p">:</span> <span class="s1">'persons.id'</span><span class="p">,</span>
          <span class="na">to</span><span class="p">:</span> <span class="s1">'animals.ownerId'</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">relations</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">getRelations</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">relations</span><span class="p">.</span><span class="nx">pets</span> <span class="k">instanceof</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">HasManyRelation</span><span class="p">);</span> <span class="c1">// --&gt; true</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">relations</span><span class="p">.</span><span class="nx">pets</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span> <span class="c1">// --&gt; pets</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">relations</span><span class="p">.</span><span class="nx">pets</span><span class="p">.</span><span class="nx">ownerProp</span><span class="p">.</span><span class="nx">cols</span><span class="p">);</span> <span class="c1">// --&gt; ['id']</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">relations</span><span class="p">.</span><span class="nx">pets</span><span class="p">.</span><span class="nx">relatedProp</span><span class="p">.</span><span class="nx">cols</span><span class="p">);</span> <span class="c1">// --&gt; ['ownerId']</span>
</code></pre>
<p><code class="prettyprint">Relation</code> is a parsed and normalized instance of a <a href="#relationmapping"><code class="prettyprint">RelationMapping</code></a>. <code class="prettyprint">Relation</code>s can be accessed using the <a href="#getrelations"><code class="prettyprint">getRelations</code></a> method.</p>

<p><code class="prettyprint">Relation</code> holds a <a href="#relationproperty"><code class="prettyprint">RelationProperty</code></a> instance for each property that is used to create the relationship between two tables.</p>

<p><code class="prettyprint">Relation</code> is actually a base class for all relation types <code class="prettyprint">BelongsToOneRelation</code>, <code class="prettyprint">HasManyRelation</code> etc. You can use <code class="prettyprint">instanceof</code> to determine
the type of the relations (see the example on the right). Note that <code class="prettyprint">HasOneRelation</code> is a subclass of <code class="prettyprint">HasManyRelation</code> and <code class="prettyprint">HasOneThroughRelation</code>
is a subclass of <code class="prettyprint">ManyToManyRelation</code>. Arrange your <code class="prettyprint">instanceof</code> checks accordingly.</p>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>string</td>
<td>Name of the relation. For example <code class="prettyprint">pets</code> or <code class="prettyprint">children</code>.</td>
</tr>
<tr>
<td>ownerModelClass</td>
<td>function</td>
<td>The model class that has defined the relation.</td>
</tr>
<tr>
<td>relatedModelClass</td>
<td>function</td>
<td>The model class of the related objects.</td>
</tr>
<tr>
<td>ownerProp</td>
<td><a href="#relationproperty"><code class="prettyprint">RelationProperty</code></a></td>
<td>The relation property in the <code class="prettyprint">ownerModelClass</code>.</td>
</tr>
<tr>
<td>relatedProp</td>
<td><a href="#relationproperty"><code class="prettyprint">RelationProperty</code></a></td>
<td>The relation property in the <code class="prettyprint">relatedModelClass</code>.</td>
</tr>
<tr>
<td>joinModelClass</td>
<td>function</td>
<td>The model class representing the join table. This class is automatically generated by Objection if none is provided in the <code class="prettyprint">join.through.modelClass</code> setting of the relation mapping, see <a href="#relationthrough"><code class="prettyprint">RelationThrough</code></a>.</td>
</tr>
<tr>
<td>joinTable</td>
<td>string</td>
<td>The name of the join table (only for <code class="prettyprint">ManyToMany</code> and <code class="prettyprint">HasOneThrough</code> relations).</td>
</tr>
<tr>
<td>joinTableOwnerProp</td>
<td><a href="#relationproperty"><code class="prettyprint">RelationProperty</code></a></td>
<td>The join table property pointing to <code class="prettyprint">ownerProp</code> (only for <code class="prettyprint">ManyToMany</code> and <code class="prettyprint">HasOneThrough</code> relations).</td>
</tr>
<tr>
<td>joinTableRelatedProp</td>
<td><a href="#relationproperty"><code class="prettyprint">RelationProperty</code></a></td>
<td>The join table property pointing to <code class="prettyprint">relatedProp</code> (only for <code class="prettyprint">ManyToMany</code> and <code class="prettyprint">HasOneThrough</code> relations).</td>
</tr>
</tbody></table>

<h2 id="relationproperty">RelationProperty</h2>

<p>Represents a property that is used to create relationship between two tables. A single <code class="prettyprint">RelationProperty</code> instance can represent
composite key. In addition to a table column, A <code class="prettyprint">RelationProperty</code> can represent a nested field inside a column (for example a jsonb column).</p>

<h3 id="properties">Properties</h3>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>size</td>
<td>number</td>
<td>The number of columns. In case of composite key, this is greater than one.</td>
</tr>
<tr>
<td>modelClass</td>
<td>function</td>
<td>The model class that owns the property.</td>
</tr>
<tr>
<td>props</td>
<td>Array&lt;string&gt;</td>
<td>The column names converted to &ldquo;external&rdquo; format. For example if <code class="prettyprint">modelClass</code> defines a snake_case to camelCase conversion, these names are in camelCase. Note that a <code class="prettyprint">RelationProperty</code> may actually point to a sub-properties of the columns in case they are of json or some other non-scalar type. This array always contains only the converted column names. Use <code class="prettyprint">getProp(obj, idx)</code> method to get the actual value from an object.</td>
</tr>
<tr>
<td>cols</td>
<td>Array&lt;string&gt;</td>
<td>The column names in the database format. For example if <code class="prettyprint">modelClass</code> defines a snake_case to camelCase conversion, these names are in snake_case. Note that a <code class="prettyprint">RelationProperty</code> may actually point to a sub-properties of the columns in case they are of json or some other non-scalar type. This array always contains only the column names.</td>
</tr>
</tbody></table>

<h3 id="methods">Methods</h3>

<h4 id="getprop">getProp</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">property</span><span class="p">.</span><span class="nx">getProp</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
</code></pre>
<p>Gets this property&rsquo;s index:th value from an object. For example if the property represents a composite key <code class="prettyprint">[a, b.d.e, c]</code>
and obj is <code class="prettyprint">{a: 1, b: {d: {e: 2}}, c: 3}</code> then <code class="prettyprint">getProp(obj, 1)</code> would return <code class="prettyprint">2</code>.</p>

<h4 id="setprop">setProp</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">property</span><span class="p">.</span><span class="nx">setProp</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
</code></pre>
<p>Sets this property&rsquo;s index:th value in an object. For example if the property represents a composite key <code class="prettyprint">[a, b.d.e, c]</code>
and obj is <code class="prettyprint">{a: 1, b: {d: {e: 2}}, c: 3}</code> then <code class="prettyprint">setProp(obj, 1, &#39;foo&#39;)</code> would mutate <code class="prettyprint">obj</code> into <code class="prettyprint">{a: 1, b: {d: {e: &#39;foo&#39;}}, c: 3}</code>.</p>

<h4 id="fullcol">fullCol</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">col</span> <span class="o">=</span> <span class="nx">property</span><span class="p">.</span><span class="nx">fullCol</span><span class="p">(</span><span class="nx">builder</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
</code></pre>
<p>Returns the property&rsquo;s index:th column name with the correct table reference. Something like <code class="prettyprint">&quot;Table.column&quot;</code>.
The first argument must be an objection <a href="#querybuilder"><code class="prettyprint">QueryBuilder</code></a> instance.</p>

<h4 id="relationproperty-ref">ref</h4>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">property</span><span class="p">.</span><span class="nx">ref</span><span class="p">(</span><span class="nx">builder</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Allows you to do things like this:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="nx">property</span><span class="p">.</span><span class="nx">ref</span><span class="p">(</span><span class="nx">builder</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="nx">builder</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">ref</span><span class="p">,</span> <span class="s1">'&gt;'</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</code></pre>
<p>Returns a <a href="#ref"><code class="prettyprint">ReferenceBuilder</code></a> instance that points to the index:th column.</p>

<h4 id="patch">patch</h4>
<pre class="highlight javascript"><code><span class="nx">property</span><span class="p">.</span><span class="nx">patch</span><span class="p">(</span><span class="nx">patchObj</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>Allows you to do things like this:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">query</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">patch</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">property</span><span class="p">.</span><span class="nx">patch</span><span class="p">(</span><span class="nx">patch</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">);</span>
<span class="nx">builder</span><span class="p">.</span><span class="nx">patch</span><span class="p">(</span><span class="nx">patch</span><span class="p">);</span>
</code></pre>
<p>Appends an update operation for the index:th column into <code class="prettyprint">patchObj</code> object.</p>

<h2 id="referencebuilder">ReferenceBuilder</h2>

<p>An instance of this is returned from the <a href="#ref"><code class="prettyprint">ref</code></a> helper function.</p>

<h3 id="methods">Methods</h3>

<h4 id="casttext">castText</h4>

<p>Cast reference to sql type <code class="prettyprint">text</code>.</p>

<h4 id="castint">castInt</h4>

<p>Cast reference to sql type <code class="prettyprint">integer</code>.</p>

<h4 id="castbigint">castBigInt</h4>

<p>Cast reference to sql type <code class="prettyprint">bigint</code>.</p>

<h4 id="castfloat">castFloat</h4>

<p>Cast reference to sql type <code class="prettyprint">float</code>.</p>

<h4 id="castdecimal">castDecimal</h4>

<p>Cast reference to sql type <code class="prettyprint">decimal</code>.</p>

<h4 id="castreal">castReal</h4>

<p>Cast reference to sql type <code class="prettyprint">real</code>.</p>

<h4 id="castbool">castBool</h4>

<p>Cast reference to sql type <code class="prettyprint">boolean</code>.</p>

<h4 id="casttype">castType</h4>

<p>Give custom type to which referenced value is casted to.</p>

<p><code class="prettyprint">.castType(&#39;mytype&#39;) --&gt; CAST(?? as mytype)</code></p>

<h4 id="castjson">castJson</h4>

<p>In addition to other casts wrap reference to_jsonb() function so that final value
reference will be json type.</p>

<h4 id="as">as</h4>

<p>Gives an alias for the reference <code class="prettyprint">.select(ref(&#39;age&#39;).as(&#39;yougness&#39;))</code></p>

<h2 id="literalbuilder">LiteralBuilder</h2>

<p>An instance of this is returned from the <a href="#lit"><code class="prettyprint">lit</code></a> helper function. If an object
is given as a value, it is casted to json by default.</p>

<h3 id="methods">Methods</h3>

<h4 id="casttext">castText</h4>

<p>Cast to sql type <code class="prettyprint">text</code>.</p>

<h4 id="castint">castInt</h4>

<p>Cast to sql type <code class="prettyprint">integer</code>.</p>

<h4 id="castbigint">castBigInt</h4>

<p>Cast to sql type <code class="prettyprint">bigint</code>.</p>

<h4 id="castfloat">castFloat</h4>

<p>Cast to sql type <code class="prettyprint">float</code>.</p>

<h4 id="castdecimal">castDecimal</h4>

<p>Cast to sql type <code class="prettyprint">decimal</code>.</p>

<h4 id="castreal">castReal</h4>

<p>Cast to sql type <code class="prettyprint">real</code>.</p>

<h4 id="castbool">castBool</h4>

<p>Cast to sql type <code class="prettyprint">boolean</code>.</p>

<h4 id="casttype">castType</h4>

<p>Cast to custom type</p>

<p><code class="prettyprint">.castType(&#39;mytype&#39;) --&gt; CAST(?? as mytype)</code></p>

<h4 id="castjson">castJson</h4>

<p>Converts the value to json (jsonb in case of postgresql). The default
cast type for object values.</p>

<h4 id="castarray">castArray</h4>

<p>Converts the value to an array literal.</p>

<h4 id="as">as</h4>

<p>Gives an alias for the reference <code class="prettyprint">.select(ref(&#39;age&#39;).as(&#39;yougness&#39;))</code></p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
