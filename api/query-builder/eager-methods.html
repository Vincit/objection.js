<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Eager Loading Methods | Objection.js</title>
    <meta name="description" content="An SQL friendly ORM for node.js">
    
    
    <link rel="preload" href="/objection.js/assets/css/0.styles.14bd6d1b.css" as="style"><link rel="preload" href="/objection.js/assets/js/app.52a11b61.js" as="script"><link rel="preload" href="/objection.js/assets/js/6.3e9cf472.js" as="script"><link rel="preload" href="/objection.js/assets/js/7.e000594e.js" as="script"><link rel="preload" href="/objection.js/assets/js/19.0732fc65.js" as="script"><link rel="prefetch" href="/objection.js/assets/js/1.77539860.js"><link rel="prefetch" href="/objection.js/assets/js/10.6bd32221.js"><link rel="prefetch" href="/objection.js/assets/js/11.b62ab2d3.js"><link rel="prefetch" href="/objection.js/assets/js/12.e99608b0.js"><link rel="prefetch" href="/objection.js/assets/js/13.2f56853f.js"><link rel="prefetch" href="/objection.js/assets/js/14.fea4755c.js"><link rel="prefetch" href="/objection.js/assets/js/15.009d7473.js"><link rel="prefetch" href="/objection.js/assets/js/16.5d72ff22.js"><link rel="prefetch" href="/objection.js/assets/js/17.7b3fa86f.js"><link rel="prefetch" href="/objection.js/assets/js/18.bde9cb3a.js"><link rel="prefetch" href="/objection.js/assets/js/2.71fc8cd2.js"><link rel="prefetch" href="/objection.js/assets/js/20.dcce9c31.js"><link rel="prefetch" href="/objection.js/assets/js/21.2aa5d892.js"><link rel="prefetch" href="/objection.js/assets/js/22.de9861cc.js"><link rel="prefetch" href="/objection.js/assets/js/23.ce534ccd.js"><link rel="prefetch" href="/objection.js/assets/js/24.38455624.js"><link rel="prefetch" href="/objection.js/assets/js/25.82911696.js"><link rel="prefetch" href="/objection.js/assets/js/26.616534f8.js"><link rel="prefetch" href="/objection.js/assets/js/27.9334d9a8.js"><link rel="prefetch" href="/objection.js/assets/js/28.9f32c83b.js"><link rel="prefetch" href="/objection.js/assets/js/29.b5217d31.js"><link rel="prefetch" href="/objection.js/assets/js/3.d88e17ba.js"><link rel="prefetch" href="/objection.js/assets/js/30.52b6ca9a.js"><link rel="prefetch" href="/objection.js/assets/js/31.8e34ea4c.js"><link rel="prefetch" href="/objection.js/assets/js/32.e7b82111.js"><link rel="prefetch" href="/objection.js/assets/js/33.83e4ddb1.js"><link rel="prefetch" href="/objection.js/assets/js/34.259e6425.js"><link rel="prefetch" href="/objection.js/assets/js/35.f56032d5.js"><link rel="prefetch" href="/objection.js/assets/js/36.ff3371dc.js"><link rel="prefetch" href="/objection.js/assets/js/37.b4184eeb.js"><link rel="prefetch" href="/objection.js/assets/js/38.e569c42d.js"><link rel="prefetch" href="/objection.js/assets/js/39.209bbee9.js"><link rel="prefetch" href="/objection.js/assets/js/40.6b48af84.js"><link rel="prefetch" href="/objection.js/assets/js/41.b7ab71ad.js"><link rel="prefetch" href="/objection.js/assets/js/42.6365999f.js"><link rel="prefetch" href="/objection.js/assets/js/43.ec633093.js"><link rel="prefetch" href="/objection.js/assets/js/44.53a1a557.js"><link rel="prefetch" href="/objection.js/assets/js/45.756f06d4.js"><link rel="prefetch" href="/objection.js/assets/js/46.842228ab.js"><link rel="prefetch" href="/objection.js/assets/js/47.d3858bde.js"><link rel="prefetch" href="/objection.js/assets/js/48.8e08399c.js"><link rel="prefetch" href="/objection.js/assets/js/49.6ea3ead6.js"><link rel="prefetch" href="/objection.js/assets/js/50.dabaa7da.js"><link rel="prefetch" href="/objection.js/assets/js/51.1f104bae.js"><link rel="prefetch" href="/objection.js/assets/js/52.15054be8.js"><link rel="prefetch" href="/objection.js/assets/js/53.80daae2b.js"><link rel="prefetch" href="/objection.js/assets/js/54.26f4f98c.js"><link rel="prefetch" href="/objection.js/assets/js/55.5e3c2366.js"><link rel="prefetch" href="/objection.js/assets/js/56.2370af7d.js"><link rel="prefetch" href="/objection.js/assets/js/57.f4dcd123.js"><link rel="prefetch" href="/objection.js/assets/js/8.8580a3aa.js"><link rel="prefetch" href="/objection.js/assets/js/9.ddf8edc6.js"><link rel="prefetch" href="/objection.js/assets/js/vendors~docsearch.d4696827.js">
    <link rel="stylesheet" href="/objection.js/assets/css/0.styles.14bd6d1b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/objection.js/" class="home-link router-link-active"><!----> <span class="site-name">Objection.js</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/objection.js/guide/" class="nav-link">Guide</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="API Reference" class="dropdown-title"><span class="title">API Reference</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/objection.js/api/objection/" class="nav-link">Main Module</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/query-builder/" class="nav-link router-link-active">Query Builder</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/model/" class="nav-link">Model</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/types/" class="nav-link">Types</a></li></ul></div></div><div class="nav-item"><a href="/objection.js/recipes/" class="nav-link">Recipe Book</a></div><div class="nav-item"><a href="/objection.js/changelog/" class="nav-link">Changelog</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="v1.x" class="dropdown-title"><span class="title">v1.x</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/objection.js/1.x/migration.html" class="nav-link">Migration to 2.0</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Vincit/objection.js/tree/v1/doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  v1.x documentation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/vincit/objection.js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ⭐ Star
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/vincit/objection.js" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/objection.js/guide/" class="nav-link">Guide</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="API Reference" class="dropdown-title"><span class="title">API Reference</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/objection.js/api/objection/" class="nav-link">Main Module</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/query-builder/" class="nav-link router-link-active">Query Builder</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/model/" class="nav-link">Model</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/types/" class="nav-link">Types</a></li></ul></div></div><div class="nav-item"><a href="/objection.js/recipes/" class="nav-link">Recipe Book</a></div><div class="nav-item"><a href="/objection.js/changelog/" class="nav-link">Changelog</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="v1.x" class="dropdown-title"><span class="title">v1.x</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/objection.js/1.x/migration.html" class="nav-link">Migration to 2.0</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Vincit/objection.js/tree/v1/doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  v1.x documentation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/vincit/objection.js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ⭐ Star
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/vincit/objection.js" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Query Builder API Reference</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/objection.js/api/query-builder/find-methods.html" class="sidebar-link">Find Methods</a></li><li><a href="/objection.js/api/query-builder/mutate-methods.html" class="sidebar-link">Mutating Methods</a></li><li><a href="/objection.js/api/query-builder/eager-methods.html" class="active sidebar-link">Eager Loading Methods</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched" class="sidebar-link">withGraphFetched()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined" class="sidebar-link">withGraphJoined()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#eager" class="sidebar-link">eager()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#eageralgorithm" class="sidebar-link">eagerAlgorithm()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#eageroptions" class="sidebar-link">eagerOptions()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#joineager" class="sidebar-link">joinEager()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#naiveeager" class="sidebar-link">naiveEager()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#mergeeager" class="sidebar-link">mergeEager()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#mergejoineager" class="sidebar-link">mergeJoinEager()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#mergenaiveeager" class="sidebar-link">mergeNaiveEager()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#eagerobject" class="sidebar-link">eagerObject()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#graphexpressionobject" class="sidebar-link">graphExpressionObject()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#eagermodifiers" class="sidebar-link">eagerModifiers()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#allowgraph" class="sidebar-link">allowGraph()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#clearallowgraph" class="sidebar-link">clearAllowGraph()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#clearwithgraph" class="sidebar-link">clearWithGraph()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#alloweager" class="sidebar-link">allowEager()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#mergealloweager" class="sidebar-link">mergeAllowEager()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#modifyeager" class="sidebar-link">modifyEager()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#modifygraph" class="sidebar-link">modifyGraph()</a></li><li class="sidebar-sub-header"><a href="/objection.js/api/query-builder/eager-methods.html#filtereager" class="sidebar-link">filterEager()</a></li></ul></li><li><a href="/objection.js/api/query-builder/join-methods.html" class="sidebar-link">Join Methods</a></li><li><a href="/objection.js/api/query-builder/other-methods.html" class="sidebar-link">Other Methods</a></li><li><a href="/objection.js/api/query-builder/static-methods.html" class="sidebar-link">Static Methods</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="eager-loading-methods"><a href="#eager-loading-methods" class="header-anchor">#</a> Eager Loading Methods</h1> <h2 id="withgraphfetched"><a href="#withgraphfetched" class="header-anchor">#</a> withGraphFetched()</h2> <div class="language-js extra-class"><pre class="language-js"><code>queryBuilder <span class="token operator">=</span> queryBuilder<span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span>relationExpression<span class="token punctuation">,</span> graphOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Fetch a graph of related items for the result of any query (eager loading).</p> <p>There are two methods that can be used to load relations eagerly: <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a> and <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a>. The main difference is that <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a> uses multiple queries under the hood to fetch the result while <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a> uses a single query and joins to fetch the results. Both methods allow you to do different things which we will go through in detail in the examples below and in the examples of the <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a> method.</p> <p>As mentioned, this method uses multiple queries to fetch the related objects. Objection performs one query per level in the relation expression tree. For example only two additional queries will be created for the expression <code>children.children</code> no matter how many children the item has or how many children each of the children have. This algorithm is explained in detail in <a href="https://www.vincit.fi/en/blog/nested-eager-loading-and-inserts-with-objection-js/" target="_blank" rel="noopener noreferrer">this blog post<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (note that <code>withGraphFetched</code> method used to be called <code>eager</code>).</p> <p><strong>Limitations:</strong></p> <ul><li>Relations cannot be referenced in the root query because they are not joined.</li> <li><code>limit</code> and <code>page</code> methods will work incorrectly when applied to a relation using <code>modifyGraph</code> or <code>modifiers</code> because they will be applied on a query that fetches relations for multiple parents. You can use <code>limit</code> and <code>page</code> for the root query.</li></ul> <p>See the <a href="/objection.js/guide/query-examples.html#eager-loading">eager loading</a> section for more examples and <a href="/objection.js/api/types/#type-relationexpression">RelationExpression</a> for more info about the relation expression language.</p> <p>See the <a href="/objection.js/api/model/static-methods.html#static-fetchgraph">fetchGraph</a> and <a href="/objection.js/api/model/instance-methods.html#fetchgraph">$fetchGraph</a> methods if you want to load relations for items already loaded from the database.</p> <p><strong>About performance:</strong></p> <p>Note that while <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a> sounds more performant than <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a>, both methods have very similar performance in most cases and <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a> is actually much much faster in some cases where the <a href="/objection.js/api/types/#type-relationexpression">relationExpression</a> contains multiple many-to-many or has-many relations. The flat record list the db returns for joins can have an incredible amount of duplicate information in some cases. Transferring + parsing that data from the db to node can be very costly. You shouldn't select <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a> blindly just because it sounds more peformant. The three rules of optimization apply here too: 1. Don't optimize 2. Don't optimize yet 3. Profile before optimizing. When you don't actually need joins, use <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a>.</p> <h5 id="arguments"><a href="#arguments" class="header-anchor">#</a> Arguments</h5> <table><thead><tr><th>Argument</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>relationExpression</td> <td><a href="/objection.js/api/types/#type-relationexpression">RelationExpression</a></td> <td>The relation expression describing which relations to fetch.</td></tr> <tr><td>options</td> <td><a href="/objection.js/api/types/#type-graphoptions">GraphOptions</a></td> <td>Optional options.</td></tr></tbody></table> <h5 id="return-value"><a href="#return-value" class="header-anchor">#</a> Return value</h5> <table><thead><tr><th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td><a href="/objection.js/api/query-builder/" class="router-link-active">QueryBuilder</a></td> <td><code>this</code> query builder for chaining.</td></tr></tbody></table> <h5 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h5> <p>Fetches all <code>Persons</code> named Arnold with all their pets. <code>'pets'</code> is the name of the relation defined in <a href="/objection.js/api/model/static-properties.html#static-relationmappings">relationMappings</a>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> people <span class="token operator">=</span> <span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'firstName'</span><span class="token punctuation">,</span> <span class="token string">'Arnold'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span><span class="token string">'pets'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Fetch <code>children</code> relation for each result Person and <code>pets</code> and <code>movies</code>
relations for all the children.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> people <span class="token operator">=</span> <span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span><span class="token string">'children.[pets, movies]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>movies<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a href="/objection.js/api/types/#relationexpression-object-notation">Relation expressions</a> can also be objects. This is equivalent to the previous example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> people <span class="token operator">=</span> <span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  children<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    pets<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    movies<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>movies<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Relation results can be filtered and modified by giving modifier function names as arguments for the relations:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> people <span class="token operator">=</span> <span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span>
    <span class="token string">'children(selectNameAndId).[pets(onlyDogs, orderByName), movies]'</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">modifiers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">selectNameAndId</span><span class="token punctuation">(</span><span class="token parameter">builder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      builder<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function">orderByName</span><span class="token punctuation">(</span><span class="token parameter">builder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      builder<span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function">onlyDogs</span><span class="token punctuation">(</span><span class="token parameter">builder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      builder<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'species'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>movies<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Reusable modifiers can be defined for a model class using <a href="/objection.js/api/model/static-properties.html#static-modifiers">modifiers</a>. Also see the <a href="/objection.js/recipes/modifiers.html">modifiers recipe</a>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">modifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">// Note that this modifier takes an argument!</span>
      <span class="token function">filterGender</span><span class="token punctuation">(</span><span class="token parameter">builder<span class="token punctuation">,</span> gender</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'gender'</span><span class="token punctuation">,</span> gender<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token function">defaultSelects</span><span class="token punctuation">(</span><span class="token parameter">builder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'firstName'</span><span class="token punctuation">,</span> <span class="token string">'lastName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token function">orderByAge</span><span class="token punctuation">(</span><span class="token parameter">builder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">modifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token function">orderByName</span><span class="token punctuation">(</span><span class="token parameter">builder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token function">filterSpecies</span><span class="token punctuation">(</span><span class="token parameter">builder<span class="token punctuation">,</span> species</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'species'</span><span class="token punctuation">,</span> species<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> people <span class="token operator">=</span> <span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">modifiers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// You can bind arguments to Model modifiers like this</span>
  <span class="token function">filterFemale</span><span class="token punctuation">(</span><span class="token parameter">builder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    builder<span class="token punctuation">.</span><span class="token function">modify</span><span class="token punctuation">(</span><span class="token string">'filterGender'</span><span class="token punctuation">,</span> <span class="token string">'female'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">filterDogs</span><span class="token punctuation">(</span><span class="token parameter">builder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    builder<span class="token punctuation">.</span><span class="token function">modify</span><span class="token punctuation">(</span><span class="token string">'filterSpecies'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    children(defaultSelects, orderByAge, filterFemale).[
      pets(filterDogs, orderByName),
      movies
    ]
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>movies<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Filters can also be registered using the <a href="/objection.js/api/query-builder/other-methods.html#modifygraph">modifyGraph</a> method:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> people <span class="token operator">=</span> <span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span><span class="token string">'children.[pets, movies]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">modifyGraph</span><span class="token punctuation">(</span><span class="token string">'children'</span><span class="token punctuation">,</span> <span class="token parameter">builder</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Order children by age and only select id.</span>
    builder<span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">modifyGraph</span><span class="token punctuation">(</span><span class="token string">'children.[pets, movies]'</span><span class="token punctuation">,</span> <span class="token parameter">builder</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Only select `pets` and `movies` whose id &gt; 10 for the children.</span>
    builder<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>movies<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Relations can be given aliases using the <code>as</code> keyword:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> people <span class="token operator">=</span> <span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[
    children(orderByAge) as kids .[
      pets(filterDogs) as dogs,
      pets(filterCats) as cats

      movies.[
        actors
      ]
    ]
  ]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>kids<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dogs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>kids<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>movies<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Eager loading is optimized to avoid the N + 1 queries problem. Consider this query:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> people <span class="token operator">=</span> <span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span><span class="token string">'children.children'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// --&gt; 10</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// --&gt; 10</span>
</code></pre></div><p>The person has 10 children and they all have 10 children. The query above will return 100 database rows but will generate only three database queries when using <code>withGraphFetched</code> and only one query when using <code>withGraphJoined</code>.</p> <h2 id="withgraphjoined"><a href="#withgraphjoined" class="header-anchor">#</a> withGraphJoined()</h2> <div class="language-js extra-class"><pre class="language-js"><code>queryBuilder <span class="token operator">=</span> queryBuilder<span class="token punctuation">.</span><span class="token function">withGraphJoined</span><span class="token punctuation">(</span>relationExpression<span class="token punctuation">,</span> graphOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Join and fetch a graph of related items for the result of any query (eager loading).</p> <p>There are two methods that can be used to load relations eagerly: <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a> and <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a>. The main difference is that <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a> uses multiple queries under the hood to fetch the result while <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a> uses a single query and joins to fetch the results. Both methods allow you to do different things which we will go through in detail in the examples below and in the examples of the <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a> method.</p> <p>As mentioned, this method uses <a href="https://www.postgresql.org/docs/12/tutorial-join.html" target="_blank" rel="noopener noreferrer">SQL joins<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to join all the relations defined in the <code>relationExpression</code> and then parses the result into a graph of model instances equal to the one you get from <code>withGraphFetched</code>. The main benefit of this is that you can filter the query based on the relations. See the examples.</p> <p>By default left join is used but you can define the join type using the <a href="/objection.js/api/types/#type-eageroptions">joinOperation</a> option.</p> <p><strong>Limitations:</strong></p> <ul><li>limit and page methods will work incorrectly because they will limit the result set that contains all the result rows in a flattened format. For example the result set of the eager expression children.children will have 10 _ 10 _ 10 rows assuming the you fetched 10 models that all had 10 children that all had 10 children.</li></ul> <p><strong>About performance:</strong></p> <p>Note that while <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a> sounds more performant than <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a>, both methods have very similar performance in most cases and <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a> is actually much much faster in some cases where the <a href="/objection.js/api/types/#type-relationexpression">relationExpression</a> contains multiple many-to-many or has-many relations. The flat record list the db returns for joins can have an incredible amount of duplicate information in some cases. Transferring + parsing that data from the db to node can be very costly. You shouldn't select <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a> blindly just because it sounds more peformant. The three rules of optimization apply here too: 1. Don't optimize 2. Don't optimize yet 3. Profile before optimizing. When you don't actually need joins, use <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a>.</p> <h5 id="arguments-2"><a href="#arguments-2" class="header-anchor">#</a> Arguments</h5> <table><thead><tr><th>Argument</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>relationExpression</td> <td><a href="/objection.js/api/types/#type-relationexpression">RelationExpression</a></td> <td>The relation expression describing which relations to fetch.</td></tr> <tr><td>options</td> <td><a href="/objection.js/api/types/#type-graphoptions">GraphOptions</a></td> <td>Optional options.</td></tr></tbody></table> <h5 id="return-value-2"><a href="#return-value-2" class="header-anchor">#</a> Return value</h5> <table><thead><tr><th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td><a href="/objection.js/api/query-builder/" class="router-link-active">QueryBuilder</a></td> <td><code>this</code> query builder for chaining.</td></tr></tbody></table> <h5 id="examples-2"><a href="#examples-2" class="header-anchor">#</a> Examples</h5> <p>All examples in <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a> also work with <code>withGraphJoined</code>. Remember to also study those. The following examples are only about the cases that don't work with <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a></p> <p>Using <code>withGraphJoined</code> all the relations are joined to the main query and you can reference them in any query building method. Note that nested relations are named by concatenating relation names using <code>:</code> as a separator. See the next example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> people <span class="token operator">=</span> <span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withGraphJoined</span><span class="token punctuation">(</span><span class="token string">'children.[pets, movies]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">whereIn</span><span class="token punctuation">(</span><span class="token string">'children.firstName'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Arnold'</span><span class="token punctuation">,</span> <span class="token string">'Jennifer'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'children:pets.name'</span><span class="token punctuation">,</span> <span class="token string">'Fluffy'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'children:movies.name'</span><span class="token punctuation">,</span> <span class="token string">'like'</span><span class="token punctuation">,</span> <span class="token string">'Terminator%'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>movies<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Using <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a> you can refer to columns only by their name because the column names are unique in the query. With <code>withGraphJoined</code> you often need to also mention the table name. Consider the following example. We join the relation <code>pets</code> to a <code>persons</code> query. Both tables have the <code>id</code> column. We need to use <code>where('persons.id', '&gt;', 100)</code> instead of <code>where('id', '&gt;', 100)</code> so that objection knows which <code>id</code> you mean. If you don't do this, you get an <code>ambiguous column name</code> error.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> people <span class="token operator">=</span> <span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withGraphJoined</span><span class="token punctuation">(</span><span class="token string">'pets'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'persons.id'</span><span class="token punctuation">,</span> <span class="token string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="eager"><a href="#eager" class="header-anchor">#</a> eager()</h2> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Deprecated! Will be removed in version 3.0. Use <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a> or <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a> instead.</p> <p><a href="https://github.com/Vincit/objection.js/blob/v1/doc/api/query-builder/eager-methods.md#eager" target="_blank" rel="noopener noreferrer">v1 documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h2 id="eageralgorithm"><a href="#eageralgorithm" class="header-anchor">#</a> eagerAlgorithm()</h2> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Deprecated! Will be removed in version 3.0. Use <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a> or <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a> instead.</p> <p><a href="https://github.com/Vincit/objection.js/blob/v1/doc/api/query-builder/eager-methods.md#eageralgorithm" target="_blank" rel="noopener noreferrer">v1 documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h2 id="eageroptions"><a href="#eageroptions" class="header-anchor">#</a> eagerOptions()</h2> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Deprecated! Will be removed in version 3.0. Use <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a> or <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a> instead. You can pass options as the second argument for both methods.</p> <p><a href="https://github.com/Vincit/objection.js/blob/v1/doc/api/query-builder/eager-methods.md#eageroptions" target="_blank" rel="noopener noreferrer">v1 documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h2 id="joineager"><a href="#joineager" class="header-anchor">#</a> joinEager()</h2> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Deprecated! Will be removed in version 3.0. Use <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a> instead.</p> <p><a href="https://github.com/Vincit/objection.js/blob/v1/doc/api/query-builder/eager-methods.md#joineager" target="_blank" rel="noopener noreferrer">v1 documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h2 id="naiveeager"><a href="#naiveeager" class="header-anchor">#</a> naiveEager()</h2> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Deprecated! Will be removed in version 3.0. Use <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a> instead with <a href="/objection.js/api/types/#type-graphoptions">maxBatchSize: 1</a> option.</p> <p><a href="https://github.com/Vincit/objection.js/blob/v1/doc/api/query-builder/eager-methods.md#naiveeager" target="_blank" rel="noopener noreferrer">v1 documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h2 id="mergeeager"><a href="#mergeeager" class="header-anchor">#</a> mergeEager()</h2> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Deprecated! Will be removed in version 3.0. Use <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a> or <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a> instead. They merge the graphs by default.</p> <p><a href="https://github.com/Vincit/objection.js/blob/v1/doc/api/query-builder/eager-methods.md#mergeeager" target="_blank" rel="noopener noreferrer">v1 documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h2 id="mergejoineager"><a href="#mergejoineager" class="header-anchor">#</a> mergeJoinEager()</h2> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Deprecated! Will be removed in version 3.0. Use <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a> or <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a> instead. They merge the graphs by default.</p> <p><a href="https://github.com/Vincit/objection.js/blob/v1/doc/api/query-builder/eager-methods.md#mergejoineager" target="_blank" rel="noopener noreferrer">v1 documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h2 id="mergenaiveeager"><a href="#mergenaiveeager" class="header-anchor">#</a> mergeNaiveEager()</h2> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Deprecated! Will be removed in version 3.0. Use <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a> or <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a> instead. They merge the graphs by default.</p> <p><a href="https://github.com/Vincit/objection.js/blob/v1/doc/api/query-builder/eager-methods.md#mergenaiveeager" target="_blank" rel="noopener noreferrer">v1 documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h2 id="eagerobject"><a href="#eagerobject" class="header-anchor">#</a> eagerObject()</h2> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Deprecated! Will be removed in version 3.0. Use <a href="#graphexpressionobject">graphExpressionObject</a> without arguments instead.</p> <p><a href="https://github.com/Vincit/objection.js/blob/v1/doc/api/query-builder/eager-methods.md#eagerobject" target="_blank" rel="noopener noreferrer">v1 documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h2 id="graphexpressionobject"><a href="#graphexpressionobject" class="header-anchor">#</a> graphExpressionObject()</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> builder <span class="token operator">=</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span><span class="token string">'children.pets(onlyId)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> expr <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">graphExpressionObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>expr<span class="token punctuation">.</span>children<span class="token punctuation">.</span>pets<span class="token punctuation">.</span>$modify<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// prints [&quot;onlyId&quot;]</span>

expr<span class="token punctuation">.</span>children<span class="token punctuation">.</span>movies <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// You can modify the object and pass it back to the `withGraphFetched` method.</span>
builder<span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span>expr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Returns the object representation of the relation expression passed to either <code>withGraphFetched</code> or <code>withGraphJoined</code>.</p> <p>See <a href="/objection.js/api/types/#relationexpression-object-notation">this section</a> for more examples and information about the structure of the returned object.</p> <h5 id="return-value-3"><a href="#return-value-3" class="header-anchor">#</a> Return value</h5> <table><thead><tr><th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>object</td> <td>Object representation of the current relation expression passed to either <code>withGraphFetched</code> or <code>withGraphJoined</code>.</td></tr></tbody></table> <h2 id="eagermodifiers"><a href="#eagermodifiers" class="header-anchor">#</a> eagerModifiers()</h2> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Deprecated! Will be removed in version 3.0. Use <a href="/objection.js/api/query-builder/other-methods.html#modifiers">modifiers</a> without arguments instead.</p> <p><a href="https://github.com/Vincit/objection.js/blob/v1/doc/api/query-builder/eager-methods.md#eagermodifiers" target="_blank" rel="noopener noreferrer">v1 documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h5 id="return-value-4"><a href="#return-value-4" class="header-anchor">#</a> Return value</h5> <table><thead><tr><th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>object</td> <td>Eager modifiers of the query.</td></tr></tbody></table> <h2 id="allowgraph"><a href="#allowgraph" class="header-anchor">#</a> allowGraph()</h2> <div class="language-js extra-class"><pre class="language-js"><code>queryBuilder <span class="token operator">=</span> queryBuilder<span class="token punctuation">.</span><span class="token function">allowGraph</span><span class="token punctuation">(</span>relationExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Sets the allowed tree of relations to fetch, insert or upsert using <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a>, <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a>, <a href="/objection.js/api/query-builder/mutate-methods.html#insertgraph">insertGraph</a> or <a href="/objection.js/api/query-builder/mutate-methods.html#upsertgraph">upsertGraph</a> methods.</p> <p>When using <a href="/objection.js/api/query-builder/eager-methods.html#withgraphfetched">withGraphFetched</a> or <a href="/objection.js/api/query-builder/eager-methods.html#withgraphjoined">withGraphJoined</a> the query is rejected and an error is thrown if the <a href="/objection.js/api/types/#type-relationexpression">expression</a> passed to the methods is not a subset of the <a href="/objection.js/api/types/#type-relationexpression">expression</a> passed to <code>allowGraph</code>. This method is useful when the relation expression comes from an untrusted source like query parameters of a http request.</p> <p>If the model tree given to the <a href="/objection.js/api/query-builder/mutate-methods.html#insertgraph">insertGraph</a> or the <a href="/objection.js/api/query-builder/mutate-methods.html#upsertgraph">upsertGraph</a> method isn't a subtree of the given <a href="/objection.js/api/types/#type-relationexpression">expression</a>, the query is rejected and and error is thrown.</p> <p>See the examples.</p> <h5 id="arguments-3"><a href="#arguments-3" class="header-anchor">#</a> Arguments</h5> <table><thead><tr><th>Argument</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>relationExpression</td> <td><a href="/objection.js/api/types/#type-relationexpression">RelationExpression</a></td> <td>The allowed relation expression</td></tr></tbody></table> <h5 id="return-value-5"><a href="#return-value-5" class="header-anchor">#</a> Return value</h5> <table><thead><tr><th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td><a href="/objection.js/api/query-builder/" class="router-link-active">QueryBuilder</a></td> <td><code>this</code> query builder for chaining.</td></tr></tbody></table> <h5 id="examples-3"><a href="#examples-3" class="header-anchor">#</a> Examples</h5> <p>This will throw because <code>actors</code> is not allowed.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">allowGraph</span><span class="token punctuation">(</span><span class="token string">'[children.pets, movies]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span><span class="token string">'movies.actors'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This will not throw:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">allowGraph</span><span class="token punctuation">(</span><span class="token string">'[children.pets, movies]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span><span class="token string">'children.pets'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Calling <code>allowGraph</code> multiple times merges the expressions. The following is equivalent to the previous example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">allowGraph</span><span class="token punctuation">(</span><span class="token string">'children.pets'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">allowGraph</span><span class="token punctuation">(</span><span class="token string">'movies'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>eager<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Usage in <code>insertGraph</code> and <code>upsertGraph</code> works the same way. The following will not throw.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> insertedPerson <span class="token operator">=</span> <span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">allowGraph</span><span class="token punctuation">(</span><span class="token string">'[children.pets, movies]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">insertGraph</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">'Sylvester'</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        firstName<span class="token punctuation">:</span> <span class="token string">'Sage'</span><span class="token punctuation">,</span>
        pets<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">'Fluffy'</span><span class="token punctuation">,</span>
            species<span class="token punctuation">:</span> <span class="token string">'dog'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">'Scrappy'</span><span class="token punctuation">,</span>
            species<span class="token punctuation">:</span> <span class="token string">'dog'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This will throw because <code>cousins</code> is not allowed:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> insertedPerson <span class="token operator">=</span> <span class="token keyword">await</span> Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">allowGraph</span><span class="token punctuation">(</span><span class="token string">'[children.pets, movies]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">upsertGraph</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">'Sylvester'</span><span class="token punctuation">,</span>

    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        firstName<span class="token punctuation">:</span> <span class="token string">'Sage'</span><span class="token punctuation">,</span>
        pets<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">'Fluffy'</span><span class="token punctuation">,</span>
            species<span class="token punctuation">:</span> <span class="token string">'dog'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">'Scrappy'</span><span class="token punctuation">,</span>
            species<span class="token punctuation">:</span> <span class="token string">'dog'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>

    cousins<span class="token punctuation">:</span> <span class="token punctuation">[</span>sylvestersCousin<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can use <a href="/objection.js/api/query-builder/eager-methods.html#clearallowgraph">clearAllowGraph</a> to clear any previous calls to <code>allowGraph</code>.</p> <h2 id="clearallowgraph"><a href="#clearallowgraph" class="header-anchor">#</a> clearAllowGraph()</h2> <p>Clears all calls to <code>allowGraph</code>.</p> <h2 id="clearwithgraph"><a href="#clearwithgraph" class="header-anchor">#</a> clearWithGraph()</h2> <p>Clears all calls to <code>withGraphFetched</code> and <code>withGraphJoined</code>.</p> <h2 id="alloweager"><a href="#alloweager" class="header-anchor">#</a> allowEager()</h2> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Deprecated! Will be removed in version 3.0. Use <a href="/objection.js/api/query-builder/eager-methods.html#allowgraph">allowGraph</a> instead. Note that you may need to add <a href="/objection.js/api/query-builder/eager-methods.html#clearallowgraph">clearAllowGraph</a> call too. <code>allowEager</code> cleared any old expressions automatically, while <code>allowGraph</code> merges them.</p> <p><a href="https://github.com/Vincit/objection.js/blob/v1/doc/api/query-builder/eager-methods.md#alloweager" target="_blank" rel="noopener noreferrer">v1 documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h2 id="mergealloweager"><a href="#mergealloweager" class="header-anchor">#</a> mergeAllowEager()</h2> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Deprecated! Will be removed in version 3.0. Use <a href="/objection.js/api/query-builder/eager-methods.html#allowgraph">allowGraph</a> instead.</p> <p><a href="https://github.com/Vincit/objection.js/blob/v1/doc/api/query-builder/eager-methods.md#mergealloweager" target="_blank" rel="noopener noreferrer">v1 documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h2 id="modifyeager"><a href="#modifyeager" class="header-anchor">#</a> modifyEager()</h2> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Deprecated! Will be removed in version 3.0. Use <a href="#modifygraph">modifyGraph</a> instead.</p> <p><a href="https://github.com/Vincit/objection.js/blob/v1/doc/api/query-builder/eager-methods.md#modifyeager" target="_blank" rel="noopener noreferrer">v1 documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h2 id="modifygraph"><a href="#modifygraph" class="header-anchor">#</a> modifyGraph()</h2> <div class="language-js extra-class"><pre class="language-js"><code>queryBuilder <span class="token operator">=</span> queryBuilder<span class="token punctuation">.</span><span class="token function">modifyGraph</span><span class="token punctuation">(</span>pathExpression<span class="token punctuation">,</span> modifier<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Can be used to modify <code>withGraphFetched</code> and <code>withGraphJoined</code> queries.</p> <p>The <code>pathExpression</code> is a relation expression that specifies the queries for which the modifier is given.</p> <p>The following query would filter out the children's pets that are &lt;= 10 years old:</p> <h5 id="arguments-4"><a href="#arguments-4" class="header-anchor">#</a> Arguments</h5> <table><thead><tr><th>Argument</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>pathExpression</td> <td><a href="/objection.js/api/types/#type-relationexpression">RelationExpression</a></td> <td>Expression that specifies the queries for which to give the filter.</td></tr> <tr><td>modifier</td> <td>function(<a href="/objection.js/api/query-builder/" class="router-link-active">QueryBuilder</a> | string | string[]</td> <td>A modifier function, <a href="/objection.js/api/model/static-properties.html#static-modifiers">model modifier</a> name or an array of model modifier names.</td></tr></tbody></table> <h5 id="return-value-6"><a href="#return-value-6" class="header-anchor">#</a> Return value</h5> <table><thead><tr><th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td><a href="/objection.js/api/query-builder/" class="router-link-active">QueryBuilder</a></td> <td><code>this</code> query builder for chaining.</td></tr></tbody></table> <h5 id="examples-4"><a href="#examples-4" class="header-anchor">#</a> Examples</h5> <div class="language-js extra-class"><pre class="language-js"><code>Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span><span class="token string">'[children.[pets, movies], movies]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">modifyGraph</span><span class="token punctuation">(</span><span class="token string">'children.pets'</span><span class="token punctuation">,</span> <span class="token parameter">builder</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    builder<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The path expression can have multiple targets. The next example sorts both the pets and movies of the children by id:</p> <div class="language-js extra-class"><pre class="language-js"><code>Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span><span class="token string">'[children.[pets, movies], movies]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">modifyGraph</span><span class="token punctuation">(</span><span class="token string">'children.[pets, movies]'</span><span class="token punctuation">,</span> <span class="token parameter">builder</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    builder<span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This example only selects movies whose name contains the word 'Predator':</p> <div class="language-js extra-class"><pre class="language-js"><code>Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span><span class="token string">'[children.[pets, movies], movies]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">modifyGraph</span><span class="token punctuation">(</span><span class="token string">'[children.movies, movies]'</span><span class="token punctuation">,</span> <span class="token parameter">builder</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    builder<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'like'</span><span class="token punctuation">,</span> <span class="token string">'%Predator%'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The modifier can also be a <a href="/objection.js/api/model/static-properties.html#static-modifiers">Model modifier</a> name, or an array of them:</p> <div class="language-js extra-class"><pre class="language-js"><code>Person<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withGraphFetched</span><span class="token punctuation">(</span><span class="token string">'[children.[pets, movies], movies]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">modifyGraph</span><span class="token punctuation">(</span><span class="token string">'children.movies'</span><span class="token punctuation">,</span> <span class="token string">'selectId'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="filtereager"><a href="#filtereager" class="header-anchor">#</a> filterEager()</h2> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Deprecated! Will be removed in version 3.0. Use <a href="#modifygraph">modifyGraph</a> instead.</p> <p><a href="https://github.com/Vincit/objection.js/blob/v1/doc/api/query-builder/eager-methods.md#filtereager" target="_blank" rel="noopener noreferrer">v1 documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <p>Alias for <a href="/objection.js/api/query-builder/other-methods.html#modifygraph">modifyGraph</a>.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/objection.js/api/query-builder/mutate-methods.html" class="prev">Mutating Methods</a></span> <span class="next"><a href="/objection.js/api/query-builder/join-methods.html">Join Methods</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/objection.js/assets/js/app.52a11b61.js" defer></script><script src="/objection.js/assets/js/6.3e9cf472.js" defer></script><script src="/objection.js/assets/js/7.e000594e.js" defer></script><script src="/objection.js/assets/js/19.0732fc65.js" defer></script>
  </body>
</html>
